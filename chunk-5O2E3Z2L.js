import{a as d}from"./chunk-MZ3EZVY4.js";import{Cc as w,Dc as R,L as m,N as r,R as c,W as u,a as h,b as g,ia as U,r as f}from"./chunk-NLC5TGVC.js";var $=class a{http=u(R);apiUrl=`${d.apiUrl}/iam/users`;users=U([]);totalElements=U(0);_currentRole="";constructor(){this.refreshUsers(0,10,"")}refreshUsers(e=0,s=10,o="",n,p){n!==void 0&&(this._currentRole=n);let t=new w().set("page",e.toString()).set("size",s.toString());this._currentRole&&(t=t.set("role",this._currentRole)),o&&(t=t.set("search",o)),p!==void 0&&(t=t.set("active",String(p))),this.http.get(this.apiUrl,{params:t}).pipe(r(i=>console.log("Raw users data:",i)),f(i=>g(h({},i),{content:i.content.map(l=>g(h({},l),{id:l.userId||l.id,fullName:l.fullName||l.name}))}))).subscribe({next:i=>{this.users.set(i.content),this.totalElements.set(i.totalElements)},error:i=>console.error("Error fetching users:",i)})}getUsers(){return this.users()}rolesUrl=`${d.apiUrl}/iam/roles`;getRoles(){return this.http.get(this.rolesUrl)}addUser(e){if(e.roleIds?.length){let s={fullName:e.fullName,email:e.email,password:e.password,roleIds:e.roleIds,phone:e.phone||"",photoUrl:e.photoUrl||""};return this.http.post(this.apiUrl,s).pipe(r(()=>this.refreshUsers()))}return this.getRoles().pipe(m(s=>{let o=e.roles.includes("ADMIN")?"ADMIN":e.roles[0],n=s.find(t=>t.roleKey===o||t.name.toUpperCase()===o);if(!n)throw new Error(`Role ${o} not found`);let p={fullName:e.fullName,email:e.email,password:e.password,roleIds:[n.roleId],phone:e.phone||"",photoUrl:e.photoUrl||""};return this.http.post(this.apiUrl,p)}),r(()=>this.refreshUsers()))}updateUser(e,s){return this.http.put(`${this.apiUrl}/${e}`,s).pipe(r(()=>this.refreshUsers()))}deleteUser(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(r(()=>this.refreshUsers()))}toggleAdminRole(e){return this.http.post(`${this.apiUrl}/${e}/toggle-admin`,{}).pipe(r(()=>this.refreshUsers()))}toggleSpecialistRole(e){return this.http.post(`${this.apiUrl}/${e}/toggle-specialist`,{}).pipe(r(()=>this.refreshUsers()))}toggleUserActive(e){return this.http.post(`${this.apiUrl}/${e}/toggle-active`,{}).pipe(r(()=>this.refreshUsers()))}updateProfile(e){return this.http.put(`${this.apiUrl}/profile`,e).pipe(r(()=>this.refreshUsers()))}changePassword(e){return this.http.put(`${this.apiUrl}/change-password`,e)}static \u0275fac=function(s){return new(s||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{$ as a};
