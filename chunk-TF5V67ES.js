import{a as de}from"./chunk-HDHEHOY6.js";import{a as ee}from"./chunk-BAEEHCHP.js";import{a as F}from"./chunk-QBDEFVGU.js";import"./chunk-QH3LZKOO.js";import{b as te,d as ie,g as re,l as ne,m as oe,n as le,s as se}from"./chunk-PDYZXUXT.js";import{a as ae}from"./chunk-WBX75YZ3.js";import"./chunk-MZ3EZVY4.js";import{$ as g,Ab as C,Ba as s,Bb as U,Cd as H,Ec as P,Ed as K,Gd as Y,Hb as N,Hd as Z,Qb as k,Ra as M,Va as x,W as b,a as E,aa as f,ab as a,bb as o,cb as l,db as m,eb as T,ed as j,fb as A,gc as L,hb as S,hc as V,hd as B,ia as v,ib as u,ic as R,jb as p,mc as O,md as $,od as W,pd as q,qb as D,rd as z,td as G,ub as d,ud as J,vb as w,wb as _,xa as I,xd as X,yd as Q,zb as y}from"./chunk-MMESFILH.js";var pe=(c,t)=>({"bg-purple-50 text-purple-700 border-purple-100":c,"bg-blue-50 text-blue-700 border-blue-100":t});function ue(c,t){if(c&1&&(o(0,"span",44),d(1),l()),c&2){let e=p().$implicit;a("ngClass",N(2,pe,e.toUpperCase()==="ADMIN",e.toUpperCase()==="DOCTOR")),s(),_(" ",e.toUpperCase()==="DOCTOR"?"Especialista":"Administrador"," ")}}function ge(c,t){if(c&1&&(T(0),x(1,ue,2,5,"span",43),A()),c&2){let e=t.$implicit;s(),a("ngIf",e.toUpperCase()!=="STAFF")}}function fe(c,t){c&1&&(o(0,"span",45),m(1,"div",46),d(2," Activo "),l())}function xe(c,t){c&1&&(o(0,"span",47),m(1,"div",48),d(2," Inactivo "),l())}function he(c,t){if(c&1){let e=S();o(0,"tr",26)(1,"td",27)(2,"div",28)(3,"div",29)(4,"img",30,0),u("error",function(){let i=g(e).$implicit,r=D(5);return f(r.src="https://ui-avatars.com/api/?name="+i.fullName+"&background=F3F4F6&color=6B7280")}),l()(),o(6,"div")(7,"div",31),d(8),l(),o(9,"div",32),d(10),l()()()(),o(11,"td",27)(12,"div",33),x(13,ge,2,1,"ng-container",34),l()(),o(14,"td",27),x(15,fe,3,0,"span",35)(16,xe,3,0,"span",36),l(),o(17,"td",37)(18,"div",38)(19,"button",39),u("click",function(){let i=g(e).$implicit,r=p();return f(r.toggleAdmin(i))}),m(20,"lucide-icon",6),l(),o(21,"button",40),u("click",function(){let i=g(e).$implicit,r=p();return f(r.toggleSpecialist(i))}),m(22,"lucide-icon",6),l(),o(23,"button",41),u("click",function(){let i=g(e).$implicit,r=p();return f(r.toggleActive(i))}),m(24,"lucide-icon",6),l(),o(25,"button",42),u("click",function(){let i=g(e).$implicit,r=p();return f(r.editUser(i))}),m(26,"lucide-icon",6),l()()()()}if(c&2){let e,n,i=t.$implicit,r=p();s(4),a("src",i.photoUrl||"https://ui-avatars.com/api/?name="+i.fullName+"&background=F3F4F6&color=6B7280",I),s(4),w(i.fullName),s(2),w(i.email),s(3),a("ngForOf",i.roles),s(2),a("ngIf",i.active),s(),a("ngIf",!i.active),s(3),a("disabled",i.id===((e=r.currentUser())==null?null:e.id))("ngClass",r.hasRoleInUser(i,"ADMIN")?"text-purple-600 bg-purple-50 hover:bg-purple-100":"text-gray-400 hover:text-purple-600 hover:bg-purple-50")("title",i.id===((n=r.currentUser())==null?null:n.id)?"No puedes quitarte el rol de administrador a ti mismo":"Alternar Administrador"),s(),a("img",r.Icons.Shield),s(),a("ngClass",r.hasRoleInUser(i,"DOCTOR")?"text-blue-600 bg-blue-50 hover:bg-blue-100":"text-gray-400 hover:text-blue-600 hover:bg-blue-50"),s(),a("img",r.Icons.Stethoscope),s(),a("ngClass",i.active?"text-emerald-600 bg-emerald-50 hover:bg-emerald-100":"text-red-500 bg-red-50 hover:bg-red-100")("title",i.active?"Desactivar Usuario":"Activar Usuario"),s(),a("img",r.Icons.Power),s(2),a("img",r.Icons.Pencil)}}function be(c,t){if(c&1&&(o(0,"div",67),m(1,"lucide-icon",68),o(2,"div")(3,"span",69),d(4,"Creando Administrador"),l(),d(5," Este usuario tendr\xE1 acceso completo al sistema. Para registrar doctores, usa el m\xF3dulo de Especialistas. "),l()()),c&2){let e=p(2);s(),a("img",e.Icons.ShieldCheck)}}function ve(c,t){c&1&&(o(0,"p",70),d(1,"* El correo electr\xF3nico no puede ser modificado."),l())}function _e(c,t){if(c&1){let e=S();o(0,"div",49)(1,"div",50)(2,"div",51)(3,"h2",52),d(4),l(),o(5,"button",53),u("click",function(){g(e);let i=p();return f(i.closeModal())}),m(6,"lucide-icon",54),l()(),o(7,"div",55),x(8,be,6,1,"div",56),o(9,"div",57)(10,"label",58),d(11,"Nombre Completo"),l(),o(12,"div",59)(13,"input",60),U("ngModelChange",function(i){g(e);let r=p();return C(r.formData.fullName,i)||(r.formData.fullName=i),f(i)}),l(),m(14,"lucide-icon",9),l()(),o(15,"div",57)(16,"label",58),d(17,"Correo Electr\xF3nico"),l(),o(18,"div",59)(19,"input",61),U("ngModelChange",function(i){g(e);let r=p();return C(r.formData.email,i)||(r.formData.email=i),f(i)}),l(),m(20,"lucide-icon",9),l(),x(21,ve,2,0,"p",62),l(),m(22,"div",63),l(),o(23,"div",64)(24,"button",65),u("click",function(){g(e);let i=p();return f(i.closeModal())}),d(25," Cancelar "),l(),o(26,"button",66),u("click",function(){g(e);let i=p();return f(i.saveUser())}),d(27),l()()()()}if(c&2){let e=p();s(4),_(" ",e.isEditing?"Editar Usuario":"Nuevo Usuario"," "),s(2),a("img",e.Icons.X),s(2),a("ngIf",!e.isEditing),s(5),y("ngModel",e.formData.fullName),s(),a("img",e.Icons.User),s(5),y("ngModel",e.formData.email),a("disabled",e.isEditing),s(),a("img",e.Icons.Mail),s(),a("ngIf",e.isEditing),s(5),a("disabled",!e.isValid()),s(),_(" ",e.isEditing?"Guardar Cambios":"Crear Usuario"," ")}}var ce=class c{usersService=b(de);authService=b(ee);confirmService=b(F);doctorsService=b(ae);Icons={Plus:W,Search:z,Trash2:Q,Pencil:$,Mail:B,BadgeCheck:P,X:K,User:H,Lock:j,ShieldCheck:G,Shield:J,Power:q,Stethoscope:X};users=this.usersService.users;searchTerm=v("");selectedRole=v("");selectedStatus=v("");isModalOpen=!1;isEditing=!1;editingId=null;formData={fullName:"",email:"",password:"123456",roles:["ADMIN"],cmp:"",clinicId:"",roleId:"",phone:"",photoUrl:""};currentUser=this.authService.currentUser;filteredUsers=k(()=>{let t=this.users(),e=this.searchTerm().toLowerCase(),n=this.selectedRole(),i=this.selectedStatus();if(e&&(t=t.filter(r=>r.fullName.toLowerCase().includes(e)||r.email.toLowerCase().includes(e)||r.cmp&&r.cmp.toLowerCase().includes(e))),n&&(t=t.filter(r=>r.roles.some(h=>h.toUpperCase()===n.toUpperCase()))),i){let r=i==="ACTIVE";t=t.filter(h=>h.active===r)}return t});hasRole(t){return this.formData.roles.some(e=>e.toUpperCase()===t.toUpperCase())}hasRoleInUser(t,e){return t.roles.some(n=>n.toUpperCase()===e.toUpperCase())}constructor(){}filterByRole(t){this.selectedRole.set(t)}filterByStatus(t){this.selectedStatus.set(t)}openModal(){this.isEditing=!1,this.editingId=null,this.formData={fullName:"",email:"",password:"123456",roles:["ADMIN"],cmp:"",clinicId:"",roleId:"",phone:"",photoUrl:""},this.isModalOpen=!0}editUser(t){this.isEditing=!0,this.editingId=t.id,this.formData={fullName:t.fullName,email:t.email,password:"",roles:[...t.roles],cmp:t.cmp||"",clinicId:t.clinicId,roleId:t.roleId,phone:t.phone||"",photoUrl:t.photoUrl||""},this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}saveUser(){if(this.isEditing&&this.editingId){let t={fullName:this.formData.fullName,phone:this.formData.phone,roleId:this.formData.roleId||void 0,photoUrl:this.formData.photoUrl};console.log("\u{1F504} Updating user:",this.editingId,"with payload:",t),this.usersService.updateUser(this.editingId,t).subscribe({next:()=>{console.log("\u2705 User updated successfully"),this.closeModal()},error:e=>{console.error("\u274C Error updating user:",e),alert("Error al actualizar usuario. Verifique los datos.")}})}else{let t=this.currentUser();t?.clinicId&&(this.formData.clinicId=t.clinicId);let e=E({},this.formData);e.roleId||delete e.roleId,e.cmp||delete e.cmp,this.usersService.addUser(e).subscribe({next:()=>this.closeModal(),error:n=>{console.error("Error adding user:",n);let i="Error al crear usuario.";n.error?.message?i=n.error.message:n.error?.errors?i=JSON.stringify(n.error.errors):n.message&&(i=n.message),alert(i)}})}}async toggleAdmin(t){await this.confirmService.confirm({title:"Cambiar Rol de Administrador",message:`\xBFEst\xE1s seguro de cambiar el rol de Administrador para ${t.fullName}?`,confirmText:"Confirmar",cancelText:"Cancelar"})&&this.usersService.toggleAdminRole(t.id).subscribe({next:()=>{},error:n=>{console.error("Error toggling admin role:",n),alert("Error al cambiar el rol. Por favor intente nuevamente.")}})}async toggleActive(t){let e=t.active?"desactivar":"activar";if(!await this.confirmService.confirm({title:`${e.charAt(0).toUpperCase()+e.slice(1)} Usuario`,message:`\xBFEst\xE1s seguro de ${e} a ${t.fullName}?`,confirmText:e.charAt(0).toUpperCase()+e.slice(1),cancelText:"Cancelar"}))return;let i=this.hasRoleInUser(t,"DOCTOR"),r=!t.active;(i?this.doctorsService.updateDoctor(t.id,{active:r}):this.usersService.toggleUserActive(t.id)).subscribe({next:()=>{i||this.usersService.refreshUsers()},error:me=>{console.error("Error toggling active status:",me),alert("Error al cambiar el estado. Por favor intente nuevamente.")}})}async toggleSpecialist(t){let e=this.hasRoleInUser(t,"DOCTOR"),n=e?"Quitar Rol de Especialista":"Asignar Rol de Especialista",i=e?`\xBFEst\xE1s seguro de quitar el rol de Especialista a ${t.fullName}?`:`\xBFEst\xE1s seguro de asignar el rol de Especialista a ${t.fullName}?`;await this.confirmService.confirm({title:n,message:i,confirmText:"Confirmar",cancelText:"Cancelar"})&&this.usersService.toggleSpecialistRole(t.id).subscribe({next:()=>{},error:h=>{console.error("Error toggling specialist role:",h),alert("Error al cambiar el rol. Por favor intente nuevamente.")}})}isValid(){return!(!this.formData.fullName||!this.formData.email||!this.isEditing&&!this.formData.password||this.formData.roles.length===0||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.formData.email))}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=M({type:c,selectors:[["app-users-list"]],decls:43,vars:7,consts:[["uImg",""],[1,"p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-500"],[1,"btn","btn-primary","flex","items-center","gap-2",3,"click"],[1,"w-4","h-4",3,"img"],[1,"bg-white","p-4","rounded-lg","shadow-sm","border","border-gray-100","mb-6","flex","gap-4"],[1,"relative","flex-1"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","w-5","h-5","text-gray-400",3,"img"],["type","text","placeholder","Buscar por nombre o email...",1,"w-full","pl-12","pr-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","transition-all",3,"ngModelChange","ngModel"],[1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","bg-white","min-w-[150px]",3,"ngModelChange","ngModel"],["value",""],["value","ACTIVE"],["value","INACTIVE"],[1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","bg-white","min-w-[200px]",3,"ngModelChange","ngModel"],["value","ADMIN"],["value","DOCTOR"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],[1,"w-full"],[1,"bg-gray-50","border-b","border-gray-100"],[1,"px-6","py-4","text-left","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider"],[1,"px-6","py-4","text-right","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider"],[1,"divide-y","divide-gray-100"],["class","hover:bg-gray-50 transition-colors group",4,"ngFor","ngForOf"],["class","fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm p-4",4,"ngIf"],[1,"hover:bg-gray-50","transition-colors","group"],[1,"px-6","py-4"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-full","bg-primary/10","flex","items-center","justify-center","text-primary","font-bold","shadow-sm","overflow-hidden","border","border-gray-100"],[1,"w-full","h-full","object-cover",3,"error","src"],[1,"font-medium","text-gray-900","group-hover:text-primary","transition-colors"],[1,"text-sm","text-gray-500"],[1,"flex","gap-1","flex-wrap"],[4,"ngFor","ngForOf"],["class","inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-100",4,"ngIf"],["class","inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-100",4,"ngIf"],[1,"px-6","py-4","text-right"],[1,"flex","justify-end","gap-2"],[1,"p-2","rounded-lg","transition-all","disabled:opacity-30","disabled:cursor-not-allowed",3,"click","disabled","ngClass","title"],["title","Alternar Especialista",1,"p-2","rounded-lg","transition-all",3,"click","ngClass"],[1,"p-2","rounded-lg","transition-all",3,"click","ngClass","title"],["title","Editar",1,"p-2","text-gray-400","hover:text-blue-600","hover:bg-blue-50","rounded-lg","transition-all",3,"click"],["class","px-2.5 py-0.5 rounded-full text-xs font-medium border shadow-sm",3,"ngClass",4,"ngIf"],[1,"px-2.5","py-0.5","rounded-full","text-xs","font-medium","border","shadow-sm",3,"ngClass"],[1,"inline-flex","items-center","gap-1.5","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-emerald-50","text-emerald-700","border","border-emerald-100"],[1,"w-1.5","h-1.5","rounded-full","bg-emerald-500"],[1,"inline-flex","items-center","gap-1.5","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-red-50","text-red-700","border","border-red-100"],[1,"w-1.5","h-1.5","rounded-full","bg-red-500"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center","backdrop-blur-sm","p-4"],[1,"bg-white","rounded-2xl","shadow-xl","w-full","max-w-lg","flex","flex-col","max-h-[90vh]"],[1,"px-6","py-4","border-b","border-gray-100","flex","justify-between","items-center","bg-gray-50","rounded-t-2xl","flex-shrink-0"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","hover:bg-gray-100","p-2","rounded-full","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],[1,"p-6","space-y-5","overflow-y-auto"],["class","bg-blue-50 text-blue-700 p-3 rounded-lg flex gap-3 text-sm items-start",4,"ngIf"],[1,"space-y-2"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"relative"],["type","text","autocomplete","off","placeholder","Ej: Juan P\xE9rez",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","transition-all","pl-12",3,"ngModelChange","ngModel"],["type","email","autocomplete","off","placeholder","correo@ejemplo.com",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","transition-all","pl-12","disabled:bg-gray-50","disabled:text-gray-500","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],["class","text-[10px] text-gray-400 mt-1 italic",4,"ngIf"],[1,"hidden"],[1,"px-6","py-4","border-t","border-gray-100","flex","justify-end","gap-3","bg-gray-50","rounded-b-2xl","flex-shrink-0"],[1,"px-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-all","font-medium",3,"click"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","shadow-sm","shadow-primary/20",3,"click","disabled"],[1,"bg-blue-50","text-blue-700","p-3","rounded-lg","flex","gap-3","text-sm","items-start"],[1,"w-5","h-5","flex-shrink-0","mt-0.5",3,"img"],[1,"font-bold","block"],[1,"text-[10px]","text-gray-400","mt-1","italic"]],template:function(e,n){e&1&&(o(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),d(4,"Gesti\xF3n de Usuarios"),l(),o(5,"p",4),d(6,"Administra el acceso y roles del sistema"),l()(),o(7,"button",5),u("click",function(){return n.openModal()}),m(8,"lucide-icon",6),d(9," Nuevo Usuario "),l()(),o(10,"div",7)(11,"div",8),m(12,"lucide-icon",9),o(13,"input",10),U("ngModelChange",function(r){return C(n.searchTerm,r)||(n.searchTerm=r),r}),l()(),o(14,"select",11),u("ngModelChange",function(r){return n.filterByStatus(r)}),o(15,"option",12),d(16,"Todos los estados"),l(),o(17,"option",13),d(18,"Activos"),l(),o(19,"option",14),d(20,"Inactivos"),l()(),o(21,"select",15),u("ngModelChange",function(r){return n.filterByRole(r)}),o(22,"option",12),d(23,"Todos los roles"),l(),o(24,"option",16),d(25,"Administradores"),l(),o(26,"option",17),d(27,"Especialistas"),l()()(),o(28,"div",18)(29,"table",19)(30,"thead",20)(31,"tr")(32,"th",21),d(33,"Usuario "),l(),o(34,"th",21),d(35,"Rol "),l(),o(36,"th",21),d(37,"Estado "),l(),o(38,"th",22),d(39," Acciones"),l()()(),o(40,"tbody",23),x(41,he,27,16,"tr",24),l()()()(),x(42,_e,28,11,"div",25)),e&2&&(s(8),a("img",n.Icons.Plus),s(4),a("img",n.Icons.Search),s(),y("ngModel",n.searchTerm),s(),a("ngModel",n.selectedStatus()),s(7),a("ngModel",n.selectedRole()),s(20),a("ngForOf",n.filteredUsers()),s(),a("ngIf",n.isModalOpen))},dependencies:[O,L,V,R,se,oe,le,te,ne,ie,re,Z,Y],encapsulation:2})};export{ce as UsersListComponent};
