import{a as Y}from"./chunk-C26W6QIR.js";import{a as X}from"./chunk-IQCUBMRG.js";import{a as U}from"./chunk-EZCPFMFM.js";import{a as H}from"./chunk-LZP63J3R.js";import{a as Q}from"./chunk-JUTIX74D.js";import{b as $,c as B,f as q,i as z,j as G,k as J,o as K}from"./chunk-DOKJHZWU.js";import{a as R}from"./chunk-LGBSUADE.js";import"./chunk-MZ3EZVY4.js";import{$a as m,Bb as I,Ia as k,Ma as h,S as x,Ta as c,Tb as F,Ua as r,Ub as N,Uc as j,Va as o,Wa as _,X as u,Xb as O,Y as p,Za as S,_a as g,cd as W,ea as T,hb as l,ib as b,jb as M,jd as L,kb as V,kd as P,mb as C,nb as w,ob as D,ta as a,zc as A}from"./chunk-A3GKMUNS.js";function ee(s,i){if(s&1&&(r(0,"span",20),l(1),o()),s&2){let e=m();a(),M(" ",e.currentSchedules().length," turnos asignados ")}}function te(s,i){if(s&1){let e=S();r(0,"li",21)(1,"div",22)(2,"div",23),l(3),o(),r(4,"div")(5,"span",24),l(6),o(),r(7,"span",25),l(8),o()()(),r(9,"button",26),g("click",function(){let n=u(e).$implicit,d=m();return p(d.remove(n))}),_(10,"lucide-icon",27),o()()}if(s&2){let e=i.$implicit,t=m();a(3),M(" ",t.getScheduleDisplay(e)," "),a(3),V("",e.startTime," - ",e.endTime),a(2),b(t.getSpecialtyName(e.specialtyId)),a(2),c("img",t.icons.Trash2)}}function ie(s,i){if(s&1&&(r(0,"li",28),_(1,"lucide-icon",29),r(2,"p"),l(3,"Selecciona un especialista para ver y configurar sus horarios de atenci\xF3n."),o()()),s&2){let e=m();a(),c("img",e.icons.Clock)}}function ne(s,i){if(s&1){let e=S();r(0,"li",28)(1,"p"),l(2,"No hay turnos asignados para este especialista."),o(),r(3,"button",30),g("click",function(){u(e);let n=m();return p(n.openAddModal())}),l(4,"Agregar el primer turno"),o()()}}function oe(s,i){if(s&1&&(r(0,"option",58),l(1),o()),s&2){let e=i.$implicit;c("value",e.specialtyId),a(),b(e.name)}}function re(s,i){if(s&1&&(r(0,"option",58),l(1),o()),s&2){let e=i.$implicit;c("value",e),a(),b(e)}}function le(s,i){if(s&1){let e=S();r(0,"div",31)(1,"div",32)(2,"div",33),g("click",function(){u(e);let n=m();return p(n.closeModal())}),o(),r(3,"span",34),l(4,"\u200B"),o(),r(5,"div",35)(6,"div",36)(7,"button",37),g("click",function(){u(e);let n=m();return p(n.closeModal())}),r(8,"span",38),l(9,"Cerrar"),o(),_(10,"lucide-icon",39),o()(),r(11,"div",40)(12,"div",41),_(13,"lucide-icon",42),o(),r(14,"div",43)(15,"h3",44),l(16,"Asignar turno de atenci\xF3n"),o(),r(17,"p",45),l(18),o(),r(19,"div",46)(20,"div")(21,"label",47),l(22,"Fecha del turno"),o(),r(23,"input",48),D("ngModelChange",function(n){u(e);let d=m();return w(d.modalData.date,n)||(d.modalData.date=n),p(n)}),g("ngModelChange",function(n){u(e);let d=m();return p(d.onDateChange(n))}),o()(),r(24,"div")(25,"label",47),l(26,"Especialidad"),o(),r(27,"select",49),g("ngModelChange",function(n){u(e);let d=m();return p(d.onSpecialtyChange(n))}),h(28,oe,2,2,"option",50),o()(),r(29,"div",51)(30,"div")(31,"label",47),l(32,"Hora inicio"),o(),r(33,"input",52),D("ngModelChange",function(n){u(e);let d=m();return w(d.modalData.startTime,n)||(d.modalData.startTime=n),p(n)}),g("ngModelChange",function(){u(e);let n=m();return p(n.onStartTimeChange())}),o()(),r(34,"div")(35,"label",47),l(36,"Hora fin"),o(),r(37,"select",53),D("ngModelChange",function(n){u(e);let d=m();return w(d.modalData.endTime,n)||(d.modalData.endTime=n),p(n)}),h(38,re,2,2,"option",50),o(),r(39,"p",54),l(40,"Seg\xFAn duraci\xF3n de cita"),o()()()()()(),r(41,"div",55)(42,"button",56),g("click",function(){u(e);let n=m();return p(n.saveSchedule())}),l(43," Guardar turno "),o(),r(44,"button",57),g("click",function(){u(e);let n=m();return p(n.closeModal())}),l(45," Cancelar "),o()()()()()}if(s&2){let e=m();a(10),c("img",e.icons.Plus),a(3),c("img",e.icons.Clock),a(5),b(e.selectedDoctorName()),a(5),C("ngModel",e.modalData.date),c("min",e.minDate),a(4),c("ngModel",e.modalData.specialtyId),a(),c("ngForOf",e.availableSpecialtiesForDoctor),a(5),C("ngModel",e.modalData.startTime),a(4),C("ngModel",e.modalData.endTime),a(),c("ngForOf",e.validEndTimes())}}var Z=class s{scheduleService=x(Y);doctorService=x(R);specialtyService=x(Q);associationService=x(U);confirmService=x(H);icons={Clock:A,Plus:j,Trash2:W};selectedDoctorId=T("");currentSchedules=I(()=>{let i=this.selectedDoctorId();return i?this.scheduleService.schedules().filter(t=>t.doctorId===i):[]});isModalOpen=!1;modalData={date:"",startTime:"09:00",endTime:"",specialtyId:""};viewMode="list";get availableSpecialtiesForDoctor(){let i=this.selectedDoctorId();return i?this.associationService.getSpecialtiesForDoctor(i).map(t=>this.specialtyService.specialties().find(n=>n.specialtyId===t.specialtyId)).filter(t=>!!t):[]}getDayName(i){return[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Mi\xE9rcoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"S\xE1bado"},{id:0,name:"Domingo"}].find(t=>t.id===i)?.name||"Desconocido"}getSpecialtyName(i){return this.specialtyService.specialties().find(e=>e.specialtyId===i)?.name||""}selectedDoctorName=I(()=>{let i=this.selectedDoctorId();if(!i)return"";let e=this.doctorService.doctors().find(t=>t.id===i||t.doctorId===i);return e?e.fullName:"Especialista"});minDate=new Date().toISOString().split("T")[0];onDateChange(i){}getScheduleDisplay(i){if(i.date){let[e,t,n]=i.date.split("-").map(Number),d=new Date(e,t-1,n);return`${this.getDayName(d.getDay())} ${n}/${t}/${e}`}return"Fecha no v\xE1lida"}validEndTimes=T([]);updateValidEndTimes(){let i=this.selectedDoctorId(),e=this.modalData.specialtyId,t=this.modalData.startTime;if(!i||!e||!t){this.validEndTimes.set([]);return}let d=this.associationService.associations().find(y=>y.doctorId===i&&y.specialtyId===e)?.durationMinutes||30,v=[],f=this.dateFromTime(t),E=new Date(f);E.setHours(23,59,0,0),f.setMinutes(f.getMinutes()+d);for(let y=0;y<16&&!(f>E);y++)v.push(this.timeFromDate(f)),f.setMinutes(f.getMinutes()+d);this.validEndTimes.set(v),v.includes(this.modalData.endTime)||(this.modalData.endTime=v[0])}dateFromTime(i){let[e,t]=i.split(":").map(Number),n=new Date;return n.setHours(e,t,0,0),n}timeFromDate(i){return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`}onStartTimeChange(){this.updateValidEndTimes()}onSpecialtyChange(i){this.modalData.specialtyId=i,this.updateValidEndTimes()}openAddModal(){if(!this.selectedDoctorId())return;let i=this.availableSpecialtiesForDoctor[0]?.specialtyId||"",e=new Date().toISOString().split("T")[0];this.modalData={date:e,startTime:"09:00",endTime:"",specialtyId:i},this.updateValidEndTimes(),this.isModalOpen=!0}saveSchedule(){let i=this.selectedDoctorId();if(i&&this.modalData.specialtyId&&this.modalData.endTime){let e=n=>n.length===5?`${n}:00`:n,t={specialtyId:this.modalData.specialtyId,date:this.modalData.date,startTime:e(this.modalData.startTime),endTime:e(this.modalData.endTime)};this.scheduleService.addSchedule(i,[t]).subscribe({next:()=>{this.closeModal()},error:n=>{console.error("Error saving schedule",n),alert("Error al guardar el turno. Verifique los datos.")}})}}closeModal(){this.isModalOpen=!1}async remove(i){await this.confirmService.confirm({title:"Eliminar Turno",message:"\xBFEst\xE1s seguro de que deseas eliminar este turno de atenci\xF3n?",confirmText:"Eliminar",cancelText:"Cancelar"})&&this.scheduleService.removeSchedule(i)}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=k({type:s,selectors:[["app-schedule-config"]],decls:26,vars:7,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-700"],[1,"flex","flex-col","gap-8","h-[calc(100vh-140px)]"],[1,"bg-white","shadow","rounded-lg","p-6","border","border-gray-100","flex","flex-col","sm:flex-row","sm:items-center","gap-6"],[1,"flex-1","w-full"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"selectionChanged"],[1,"flex-none","pt-0","sm:pt-6","w-full","sm:w-auto"],[1,"inline-flex","w-full","sm:w-auto","items-center","justify-center","px-4","py-2","border","border-transparent","text-sm","font-medium","rounded-md","shadow-sm","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-4","h-4","mr-2",3,"img"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","border","border-gray-100","flex-1","overflow-y-auto"],[1,"px-6","py-4","border-b","border-gray-200","bg-gray-50","flex","justify-between","items-center"],[1,"text-lg","font-medium","leading-6","text-gray-900"],["class","text-sm text-gray-500",4,"ngIf"],["role","list",1,"divide-y","divide-gray-200"],["class","px-6 py-4 hover:bg-gray-50 flex justify-between items-center transition-colors",4,"ngFor","ngForOf"],["class","px-6 py-12 text-center text-gray-400",4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto","aria-labelledby","modal-title","role","dialog","aria-modal","true",4,"ngIf"],[1,"text-sm","text-gray-500"],[1,"px-6","py-4","hover:bg-gray-50","flex","justify-between","items-center","transition-colors"],[1,"flex","items-center","gap-4"],[1,"bg-blue-100","p-2","rounded-lg","text-blue-600","font-bold","w-32","text-center","text-sm"],[1,"text-gray-900","font-medium","text-lg","block"],[1,"block","text-sm","text-gray-500"],["title","Eliminar turno",1,"text-gray-400","hover:text-red-600","p-2","rounded-full","hover:bg-red-50","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],[1,"px-6","py-12","text-center","text-gray-400"],[1,"w-12","h-12","mx-auto","mb-3","opacity-20",3,"img"],[1,"mt-2","text-blue-600","hover:underline","font-medium",3,"click"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","items-end","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity",3,"click"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"relative","inline-block","align-bottom","bg-white","rounded-lg","px-4","pt-5","pb-4","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full","sm:p-6"],[1,"absolute","top-0","right-0","pt-4","pr-4"],["type","button",1,"bg-white","rounded-md","text-gray-400","hover:text-gray-500","focus:outline-none",3,"click"],[1,"sr-only"],[1,"w-6","h-6","rotate-45",3,"img"],[1,"sm:flex","sm:items-start"],[1,"mx-auto","flex-shrink-0","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-blue-100","sm:mx-0","sm:h-10","sm:w-10"],[1,"h-6","w-6","text-blue-600",3,"img"],[1,"mt-3","text-center","sm:mt-0","sm:ml-4","sm:text-left","w-full"],["id","modal-title",1,"text-lg","leading-6","font-medium","text-gray-900"],[1,"text-sm","text-gray-500","mt-1"],[1,"mt-4","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700"],["type","date",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel","min"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"grid","grid-cols-2","gap-4"],["type","time",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border","bg-white",3,"ngModelChange","ngModel"],[1,"mt-1","text-xs","text-gray-500"],[1,"mt-5","sm:mt-4","sm:flex","sm:flex-row-reverse"],["type","button",1,"w-full","inline-flex","justify-center","rounded-md","border","border-transparent","shadow-sm","px-4","py-2","bg-blue-600","text-base","font-medium","text-white","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:ml-3","sm:w-auto","sm:text-sm",3,"click"],["type","button",1,"mt-3","w-full","inline-flex","justify-center","rounded-md","border","border-gray-300","shadow-sm","px-4","py-2","bg-white","text-base","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:mt-0","sm:w-auto","sm:text-sm",3,"click"],[3,"value"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),l(3,"Turnos de atenci\xF3n"),o(),r(4,"p",3),l(5,"Define los d\xEDas y horas de atenci\xF3n por especialista y especialidad."),o()(),r(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),l(10,"Seleccionar especialista"),o(),r(11,"app-doctor-selector",8),g("selectionChanged",function(d){return t.selectedDoctorId.set(d)}),o()(),r(12,"div",9)(13,"button",10),g("click",function(){return t.openAddModal()}),_(14,"lucide-icon",11),l(15," Agregar turno "),o()()(),r(16,"div",12)(17,"div",13)(18,"h3",14),l(19,"Horarios configurados"),o(),h(20,ee,2,1,"span",15),o(),r(21,"ul",16),h(22,te,11,5,"li",17)(23,ie,4,1,"li",18)(24,ne,5,0,"li",18),o()()(),h(25,le,46,10,"div",19),o()),e&2&&(a(13),c("disabled",!t.selectedDoctorId()),a(),c("img",t.icons.Plus),a(6),c("ngIf",t.selectedDoctorId()),a(2),c("ngForOf",t.currentSchedules()),a(),c("ngIf",!t.selectedDoctorId()),a(),c("ngIf",t.selectedDoctorId()&&t.currentSchedules().length===0),a(),c("ngIf",t.isModalOpen))},dependencies:[O,F,N,K,G,J,$,z,B,q,P,L,X],encapsulation:2})};export{Z as ScheduleConfigComponent};
