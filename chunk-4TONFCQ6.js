import{a as ee}from"./chunk-DQI4QRFZ.js";import{a as te}from"./chunk-XIIY2O6X.js";import{a as Z}from"./chunk-C7ZZHBBP.js";import{a as X}from"./chunk-R3C6KUGD.js";import{a as j}from"./chunk-J3TERVKR.js";import{a as Q}from"./chunk-7PGC4CCZ.js";import{b as $,c as q,f as z,i as G,j as J,k as Y,o as K}from"./chunk-HT5T4W3C.js";import{a as U}from"./chunk-KFKJMQGU.js";import"./chunk-MZ3EZVY4.js";import{$ as u,$a as c,Aa as l,Ab as D,Bd as H,Cd as B,Ob as V,Qa as F,Rc as R,Ua as S,W as h,aa as p,ab as o,bb as r,cb as v,fc as O,gb as E,gc as A,hb as g,ia as k,ib as m,kc as W,kd as L,tb as a,ub as b,ud as P,vb as M,wb as N,yb as C,zb as w}from"./chunk-XATCTO35.js";function ne(d,n){if(d&1&&(o(0,"span",20),a(1),r()),d&2){let e=m();l(),M(" ",e.currentSchedules().length," turnos asignados ")}}function oe(d,n){if(d&1){let e=E();o(0,"li",21)(1,"div",22)(2,"div",23),a(3),r(),o(4,"div")(5,"span",24),a(6),r(),o(7,"span",25),a(8),r()()(),o(9,"button",26),g("click",function(){let i=u(e).$implicit,s=m();return p(s.remove(i))}),v(10,"lucide-icon",27),r()()}if(d&2){let e=n.$implicit,t=m();l(3),M(" ",t.getScheduleDisplay(e)," "),l(3),N("",t.formatTimeDisplay(e.startTime)," - ",t.formatTimeDisplay(e.endTime)),l(2),b(t.getSpecialtyName(e.specialtyId)),l(2),c("img",t.icons.Trash2)}}function re(d,n){if(d&1&&(o(0,"li",28),v(1,"lucide-icon",29),o(2,"p"),a(3,"Selecciona un especialista para ver y configurar sus horarios de atenci\xF3n."),r()()),d&2){let e=m();l(),c("img",e.icons.Clock)}}function ae(d,n){if(d&1){let e=E();o(0,"li",28)(1,"p"),a(2,"No hay turnos asignados para este especialista."),r(),o(3,"button",30),g("click",function(){u(e);let i=m();return p(i.openAddModal())}),a(4,"Agregar el primer turno"),r()()}}function le(d,n){if(d&1&&(o(0,"option",59),a(1),r()),d&2){let e=n.$implicit;c("value",e.specialtyId),l(),b(e.name)}}function se(d,n){if(d&1&&(o(0,"option",59),a(1),r()),d&2){let e=n.$implicit;c("value",e),l(),b(e)}}function de(d,n){if(d&1){let e=E();o(0,"div",31)(1,"div",32)(2,"div",33),g("click",function(){u(e);let i=m();return p(i.closeModal())}),r(),o(3,"span",34),a(4,"\u200B"),r(),o(5,"div",35)(6,"div",36)(7,"button",37),g("click",function(){u(e);let i=m();return p(i.closeModal())}),o(8,"span",38),a(9,"Cerrar"),r(),v(10,"lucide-icon",39),r()(),o(11,"div",40)(12,"div",41),v(13,"lucide-icon",42),r(),o(14,"div",43)(15,"h3",44),a(16,"Asignar turno de atenci\xF3n"),r(),o(17,"p",45),a(18),r(),o(19,"div",46)(20,"div")(21,"label",47),a(22,"Fecha del turno"),r(),o(23,"input",48),D("ngModelChange",function(i){u(e);let s=m();return w(s.modalData.date,i)||(s.modalData.date=i),p(i)}),g("ngModelChange",function(i){u(e);let s=m();return p(s.onDateChange(i))}),r()(),o(24,"div")(25,"label",47),a(26,"Especialidad"),r(),o(27,"select",49),g("ngModelChange",function(i){u(e);let s=m();return p(s.onSpecialtyChange(i))}),S(28,le,2,2,"option",50),r()(),o(29,"div",51)(30,"div")(31,"label",47),a(32,"Hora inicio"),r(),o(33,"input",52),D("ngModelChange",function(i){u(e);let s=m();return w(s.modalData.startTime,i)||(s.modalData.startTime=i),p(i)}),g("ngModelChange",function(){u(e);let i=m();return p(i.onStartTimeChange())}),r()(),o(34,"div")(35,"label",47),a(36,"Hora fin"),r(),o(37,"select",53),D("ngModelChange",function(i){u(e);let s=m();return w(s.modalData.endTime,i)||(s.modalData.endTime=i),p(i)}),S(38,se,2,2,"option",50),r(),o(39,"p",54),a(40,"Seg\xFAn duraci\xF3n de cita"),r()()(),o(41,"div")(42,"label",47),a(43,"Repetir turno"),r(),o(44,"select",53),D("ngModelChange",function(i){u(e);let s=m();return w(s.modalData.weeksToRepeat,i)||(s.modalData.weeksToRepeat=i),p(i)}),o(45,"option",55),a(46,"Solo esta fecha"),r(),o(47,"option",55),a(48,"Repetir por 1 mes (4 semanas)"),r(),o(49,"option",55),a(50,"Repetir por 2 meses (8 semanas)"),r(),o(51,"option",55),a(52,"Repetir por 3 meses (12 semanas)"),r()(),o(53,"p",54),a(54,"Se crear\xE1n m\xFAltiples turnos para el mismo d\xEDa de la semana."),r()()()()(),o(55,"div",56)(56,"button",57),g("click",function(){u(e);let i=m();return p(i.saveSchedule())}),a(57," Guardar turno "),r(),o(58,"button",58),g("click",function(){u(e);let i=m();return p(i.closeModal())}),a(59," Cancelar "),r()()()()()}if(d&2){let e=m();l(10),c("img",e.icons.Plus),l(3),c("img",e.icons.Clock),l(5),b(e.selectedDoctorName()),l(5),C("ngModel",e.modalData.date),c("min",e.minDate),l(4),c("ngModel",e.modalData.specialtyId),l(),c("ngForOf",e.availableSpecialtiesForDoctor),l(5),C("ngModel",e.modalData.startTime),l(4),C("ngModel",e.modalData.endTime),l(),c("ngForOf",e.validEndTimes()),l(6),C("ngModel",e.modalData.weeksToRepeat),l(),c("ngValue",0),l(2),c("ngValue",4),l(2),c("ngValue",8),l(2),c("ngValue",12)}}var ie=class d{scheduleService=h(ee);doctorService=h(U);specialtyService=h(Q);associationService=h(X);confirmService=h(j);configService=h(te);icons={Clock:R,Plus:L,Trash2:P};selectedDoctorId=k("");currentSchedules=V(()=>{let n=this.selectedDoctorId();if(!n)return[];let e=this.scheduleService.schedules(),t=new Date().toISOString().split("T")[0];return e.filter(i=>i.doctorId===n).filter(i=>i.date>=t).sort((i,s)=>i.date!==s.date?i.date.localeCompare(s.date):i.startTime.localeCompare(s.startTime))});formatTimeDisplay(n){return n?n.substring(0,5):""}isModalOpen=!1;modalData={date:"",startTime:"09:00",endTime:"",specialtyId:"",weeksToRepeat:0};viewMode="list";get availableSpecialtiesForDoctor(){let n=this.selectedDoctorId();return n?this.associationService.getSpecialtiesForDoctor(n).map(t=>this.specialtyService.specialties().find(i=>i.specialtyId===t.specialtyId)).filter(t=>!!t):[]}getDayName(n){return[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Mi\xE9rcoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"S\xE1bado"},{id:0,name:"Domingo"}].find(t=>t.id===n)?.name||"Desconocido"}getSpecialtyName(n){return this.specialtyService.specialties().find(e=>e.specialtyId===n)?.name||""}selectedDoctorName=V(()=>{let n=this.selectedDoctorId();if(!n)return"";let e=this.doctorService.doctors().find(t=>t.id===n||t.doctorId===n);return e?e.fullName:"Especialista"});minDate=new Date().toISOString().split("T")[0];onDateChange(n){}getScheduleDisplay(n){if(n.date){let[e,t,i]=n.date.split("-").map(Number),s=new Date(e,t-1,i);return`${this.getDayName(s.getDay())} ${i}/${t}/${e}`}return"Fecha no v\xE1lida"}validEndTimes=k([]);updateValidEndTimes(){let n=this.selectedDoctorId(),e=this.modalData.specialtyId,t=this.modalData.startTime;if(!n||!e||!t){this.validEndTimes.set([]);return}let s=this.associationService.associations().find(T=>T.doctorId===n&&T.specialtyId===e)?.durationMinutes||30,y=[],x=this.dateFromTime(t),I=this.configService.settings().clinicCloseTime||"20:00",_=this.dateFromTime(I);for(x.setMinutes(x.getMinutes()+s);x<=_;)y.push(this.timeFromDate(x)),x.setMinutes(x.getMinutes()+s);this.validEndTimes.set(y),y.includes(this.modalData.endTime)||(this.modalData.endTime=y[0])}dateFromTime(n){let[e,t]=n.split(":").map(Number),i=new Date;return i.setHours(e,t,0,0),i}timeFromDate(n){return`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}onStartTimeChange(){this.updateValidEndTimes()}onSpecialtyChange(n){this.modalData.specialtyId=n,this.updateValidEndTimes()}openAddModal(){if(!this.selectedDoctorId())return;let n=this.availableSpecialtiesForDoctor[0]?.specialtyId||"",e=new Date().toISOString().split("T")[0];this.modalData={date:e,startTime:"09:00",endTime:"",specialtyId:n,weeksToRepeat:0},this.updateValidEndTimes(),this.isModalOpen=!0}saveSchedule(){let n=this.selectedDoctorId();if(n&&this.modalData.specialtyId&&this.modalData.endTime){let e=f=>f.length===5?`${f}:00`:f,t=[],[i,s,y]=this.modalData.date.split("-").map(Number),x=new Date(i,s-1,y,12,0,0),I=1+this.modalData.weeksToRepeat;for(let f=0;f<I;f++){let _=new Date(x);_.setDate(x.getDate()+f*7);let T=[_.getFullYear(),(_.getMonth()+1).toString().padStart(2,"0"),_.getDate().toString().padStart(2,"0")].join("-");t.push({specialtyId:this.modalData.specialtyId,date:T,startTime:e(this.modalData.startTime),endTime:e(this.modalData.endTime)})}this.scheduleService.addSchedule(n,t).subscribe({next:()=>{this.closeModal(),this.scheduleService.refreshSchedules({doctorId:n})},error:f=>{console.error("Error saving schedule",f),alert("Error al guardar el turno. Verifique los datos.")}})}}closeModal(){this.isModalOpen=!1}async remove(n){await this.confirmService.confirm({title:"Eliminar Turno",message:"\xBFEst\xE1s seguro de que deseas eliminar este turno de atenci\xF3n?",confirmText:"Eliminar",cancelText:"Cancelar"})&&n.id&&this.scheduleService.removeSchedule(n.id,n.doctorId).subscribe({error:t=>console.error("Error deleting schedule",t)})}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=F({type:d,selectors:[["app-schedule-config"]],decls:26,vars:8,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-700"],[1,"flex","flex-col","gap-8","h-[calc(100vh-140px)]"],[1,"bg-white","shadow","rounded-lg","p-6","border","border-gray-100","flex","flex-col","sm:flex-row","sm:items-center","gap-6"],[1,"flex-1","w-full"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"selectionChanged"],[1,"flex-none","pt-0","sm:pt-6","w-full","sm:w-auto"],[1,"inline-flex","w-full","sm:w-auto","items-center","justify-center","px-4","py-2","border","border-transparent","text-sm","font-medium","rounded-md","shadow-sm","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-4","h-4","mr-2",3,"img"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","border","border-gray-100","flex-1","overflow-y-auto"],[1,"px-6","py-4","border-b","border-gray-200","bg-gray-50","flex","justify-between","items-center"],[1,"text-lg","font-medium","leading-6","text-gray-900"],["class","text-sm text-gray-500",4,"ngIf"],["role","list",1,"divide-y","divide-gray-200"],["class","px-6 py-4 hover:bg-gray-50 flex justify-between items-center transition-colors",4,"ngFor","ngForOf"],["class","px-6 py-12 text-center text-gray-400",4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto","aria-labelledby","modal-title","role","dialog","aria-modal","true",4,"ngIf"],[1,"text-sm","text-gray-500"],[1,"px-6","py-4","hover:bg-gray-50","flex","justify-between","items-center","transition-colors"],[1,"flex","items-center","gap-4"],[1,"bg-blue-100","p-2","rounded-lg","text-blue-600","font-bold","w-32","text-center","text-sm"],[1,"text-gray-900","font-medium","text-lg","block"],[1,"block","text-sm","text-gray-500"],["title","Eliminar turno",1,"text-gray-400","hover:text-red-600","p-2","rounded-full","hover:bg-red-50","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],[1,"px-6","py-12","text-center","text-gray-400"],[1,"w-12","h-12","mx-auto","mb-3","opacity-20",3,"img"],[1,"mt-2","text-blue-600","hover:underline","font-medium",3,"click"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","items-end","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity",3,"click"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"relative","inline-block","align-bottom","bg-white","rounded-lg","px-4","pt-5","pb-4","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full","sm:p-6"],[1,"absolute","top-0","right-0","pt-4","pr-4"],["type","button",1,"bg-white","rounded-md","text-gray-400","hover:text-gray-500","focus:outline-none",3,"click"],[1,"sr-only"],[1,"w-6","h-6","rotate-45",3,"img"],[1,"sm:flex","sm:items-start"],[1,"mx-auto","flex-shrink-0","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-blue-100","sm:mx-0","sm:h-10","sm:w-10"],[1,"h-6","w-6","text-blue-600",3,"img"],[1,"mt-3","text-center","sm:mt-0","sm:ml-4","sm:text-left","w-full"],["id","modal-title",1,"text-lg","leading-6","font-medium","text-gray-900"],[1,"text-sm","text-gray-500","mt-1"],[1,"mt-4","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700"],["type","date",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel","min"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"grid","grid-cols-2","gap-4"],["type","time",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border","bg-white",3,"ngModelChange","ngModel"],[1,"mt-1","text-xs","text-gray-500"],[3,"ngValue"],[1,"mt-5","sm:mt-4","sm:flex","sm:flex-row-reverse"],["type","button",1,"w-full","inline-flex","justify-center","rounded-md","border","border-transparent","shadow-sm","px-4","py-2","bg-blue-600","text-base","font-medium","text-white","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:ml-3","sm:w-auto","sm:text-sm",3,"click"],["type","button",1,"mt-3","w-full","inline-flex","justify-center","rounded-md","border","border-gray-300","shadow-sm","px-4","py-2","bg-white","text-base","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:mt-0","sm:w-auto","sm:text-sm",3,"click"],[3,"value"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"h1",2),a(3,"Turnos de atenci\xF3n"),r(),o(4,"p",3),a(5,"Define los d\xEDas y horas de atenci\xF3n por especialista y especialidad."),r()(),o(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),a(10,"Seleccionar especialista"),r(),o(11,"app-doctor-selector",8),g("selectionChanged",function(s){return t.selectedDoctorId.set(s)}),r()(),o(12,"div",9)(13,"button",10),g("click",function(){return t.openAddModal()}),v(14,"lucide-icon",11),a(15," Agregar turno "),r()()(),o(16,"div",12)(17,"div",13)(18,"h3",14),a(19),r(),S(20,ne,2,1,"span",15),r(),o(21,"ul",16),S(22,oe,11,5,"li",17)(23,re,4,1,"li",18)(24,ae,5,0,"li",18),r()()(),S(25,de,60,15,"div",19),r()),e&2&&(l(13),c("disabled",!t.selectedDoctorId()),l(),c("img",t.icons.Plus),l(5),M(" ",t.selectedDoctorName()?"Horarios de "+t.selectedDoctorName():"Horarios configurados"," "),l(),c("ngIf",t.selectedDoctorId()),l(2),c("ngForOf",t.currentSchedules()),l(),c("ngIf",!t.selectedDoctorId()),l(),c("ngIf",t.selectedDoctorId()&&t.currentSchedules().length===0),l(),c("ngIf",t.isModalOpen))},dependencies:[W,O,A,K,J,Y,$,G,q,z,B,H,Z],encapsulation:2})};export{ie as ScheduleConfigComponent};
