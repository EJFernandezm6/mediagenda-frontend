import{e as c}from"./chunk-CHEAYMB6.js";import{a as u}from"./chunk-MZ3EZVY4.js";import{Dc as l,N as s,R as o,W as a,ia as n}from"./chunk-NLC5TGVC.js";var g=class i{http=a(l);router=a(c);apiUrl=`${u.apiUrl}/iam/auth`;currentUser=n(null);constructor(){this.restoreSession()}login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(s(t=>{let r={id:t.userId,fullName:t.fullName||"",email:t.email,roles:[],photoUrl:`https://ui-avatars.com/api/?name=${t.email}&background=0D8ABC&color=fff`,subscriptionStatus:"ACTIVE",clinicId:t.clinicId,roleIds:t.roleIds??[],active:t.active!==void 0?t.active:!0,features:t.features??[],subscriptionId:t.subscriptionId};if(r.active===!1)throw{status:403,message:"Usuario inactivo. Contacte al administrador."};if(!r.features||r.features.length===0)throw{status:403,code:"NO_FEATURES",message:"No tiene m\xF3dulos asignados. Contacte al administrador."};this.currentUser.set(r),localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(r)),this.router.navigate(["/app/dashboard"])}))}forgotPassword(e){return this.http.post(`${this.apiUrl}/forgot-password`,{email:e})}validateCode(e,t){return this.http.post(`${this.apiUrl}/validate-code`,{email:e,code:t})}resetPassword(e,t,r){return this.http.post(`${this.apiUrl}/reset-password`,{email:e,code:t,newPassword:r})}logout(){this.currentUser.set(null),localStorage.clear(),sessionStorage.clear(),this.router.navigate(["/auth/login"])}restoreSession(){let e=localStorage.getItem("user"),t=localStorage.getItem("token");e&&t&&this.currentUser.set(JSON.parse(e))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};export{g as a};
