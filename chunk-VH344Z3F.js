import{a as u}from"./chunk-MZ3EZVY4.js";import{N as m,R as g,W as c,a as s,b as r,ia as d,tc as h,uc as A}from"./chunk-CEVN5TN4.js";var l=class a{http=c(A);apiUrl=`${u.apiUrl}/appointments`;appointments=d([]);pendingAppointments=d([]);normalizeTime(t){return t&&t.length>5?t.substring(0,5):t}normalizeAppointment(t){return r(s({},t),{startTime:this.normalizeTime(t.startTime),endTime:this.normalizeTime(t.endTime)})}refreshAppointmentsByRange(t,n){let i=new h().set("from",t).set("to",n);this.http.get(`${this.apiUrl}/range`,{params:i}).subscribe(e=>{this.appointments.set(e.map(p=>this.normalizeAppointment(p)))})}getAppointmentById(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(m(n=>{this.appointments.update(i=>{let e=i.findIndex(p=>p.appointmentId===n.appointmentId);if(e!==-1){let p=[...i];return p[e]=this.normalizeAppointment(n),p}return i})}))}fetchPendingAppointments(){let t=new h().set("paymentStatus","PENDING");this.http.get(`${this.apiUrl}`,{params:t}).subscribe({next:n=>{let i=n.filter(e=>e.paymentStatus==="PENDING"&&["YAPE","PLIN","CASH"].includes(e.paymentMethod||"")).map(e=>this.normalizeAppointment(e));this.pendingAppointments.set(i)},error:()=>{console.warn("Failed to fetch pending appointments")}})}addAppointment(t){return this.http.post(this.apiUrl,t).pipe(m(n=>{this.appointments.update(i=>[...i,this.normalizeAppointment(n)]),this.fetchPendingAppointments()}))}updatestatus(t,n){this.http.patch(`${this.apiUrl}/${t}/status`,{status:n}).subscribe(()=>{this.appointments.update(i=>i.map(e=>e.appointmentId===t?r(s({},e),{status:n}):e)),this.fetchPendingAppointments()})}updatePayment(t,n,i,e){let p={paymentMethod:n,paymentStatus:i,transactionId:e};this.http.patch(`${this.apiUrl}/${t}/payment`,p).subscribe(()=>{this.appointments.update(I=>I.map(o=>o.appointmentId===t?r(s({},o),{paymentStatus:i,paymentMethod:n}):o)),this.fetchPendingAppointments()})}cancelAppointment(t){this.updatestatus(t,"CANCELLED")}static \u0275fac=function(n){return new(n||a)};static \u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"})};export{l as a};
