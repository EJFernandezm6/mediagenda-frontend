import{a as q}from"./chunk-VDOYPPVO.js";import{a as te,b as ie}from"./chunk-FTFAWZSP.js";import{a as L}from"./chunk-U7G55PT5.js";import{a as Z}from"./chunk-XTHUABNB.js";import{b as V,d as O,g as F,u as A}from"./chunk-OABQPEKD.js";import{a as ee}from"./chunk-KR7YXPEX.js";import"./chunk-MZ3EZVY4.js";import{$ as u,Ad as K,Ba as s,Bb as h,Dd as T,Hd as U,Kd as W,Qd as Y,Ra as I,Sd as N,Td as k,Va as v,Vb as _,W as x,Yb as X,a as j,aa as g,b as H,ba as R,cb as d,db as n,eb as r,fb as y,ia as f,kd as J,mb as S,mc as D,nb as p,nc as M,ob as m,sb as B,tb as P,ub as Q,vc as E,zb as a}from"./chunk-2BMW4ZRB.js";function pe(c,i){if(c&1){let e=S();n(0,"div",8),p("click",function(){u(e);let o=m();return g(o.isOpen.set(!1))}),r()}}function me(c,i){c&1&&(n(0,"span",16),R(),n(1,"svg",17),y(2,"path",18),r()())}function ue(c,i){if(c&1){let e=S();n(0,"li",12),p("click",function(){let o=u(e).$implicit,l=m(2);return g(l.selectSpecialty(o))}),n(1,"div",13)(2,"span",14),a(3),r()(),v(4,me,3,0,"span",15),r()}if(c&2){let e=i.$implicit,t=m(2);s(3),h(" ",e.name," "),s(),d("ngIf",e.specialtyId===t.selectedSpecialtyId())}}function ge(c,i){if(c&1&&(n(0,"div",9)(1,"ul",10),v(2,ue,5,2,"li",11),r()()),c&2){let e=m();s(2),d("ngForOf",e.filteredOptions())}}function fe(c,i){c&1&&(n(0,"div",19),a(1," No se encontraron especialidades. "),r())}var b=class c{specialtyService=x(L);selectedSpecialtyId=f("");disabled=f(!1);selectionChanged=X();set setDisabled(i){this.disabled.set(i)}isOpen=f(!1);searchText=f("");specialties=this.specialtyService.specialties;icons={Search:T};filteredOptions=_(()=>{let i=this.searchText().toLowerCase();return this.specialties().filter(e=>e.name.toLowerCase().includes(i))});onSearchChange(i){this.searchText.set(i),this.isOpen.set(!0),i||(this.selectedSpecialtyId.set(""),this.selectionChanged.emit(""))}selectSpecialty(i){this.selectedSpecialtyId.set(i.specialtyId),this.searchText.set(i.name),this.isOpen.set(!1),this.selectionChanged.emit(i.specialtyId)}clear(){this.selectedSpecialtyId.set(""),this.searchText.set(""),this.selectionChanged.emit("")}setValue(i){let e=this.specialties().find(t=>t.specialtyId===i);e?(this.selectedSpecialtyId.set(i),this.searchText.set(e.name)):(this.selectedSpecialtyId.set(""),this.searchText.set(""))}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=I({type:c,selectors:[["app-specialty-selector"]],inputs:{setDisabled:[0,"disabled","setDisabled"]},outputs:{selectionChanged:"selectionChanged"},decls:8,vars:6,consts:[[1,"relative"],[1,"relative","rounded-md","shadow-sm"],[1,"pointer-events-none","absolute","inset-y-0","left-0","flex","items-center","pl-3"],[1,"h-5","w-5","text-gray-400",3,"img"],["type","text","placeholder","Buscar especialidad...",1,"block","w-full","rounded-md","border-gray-300","pl-10","focus:border-primary","focus:ring-primary","sm:text-sm","border","py-2","disabled:bg-gray-100","disabled:text-gray-500",3,"ngModelChange","focus","ngModel","disabled"],["class","dropdown-backdrop",3,"click",4,"ngIf"],["class","absolute z-40 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",4,"ngIf"],["class","absolute z-40 mt-1 w-full rounded-md bg-white py-2 px-3 text-sm text-gray-500 shadow-lg border",4,"ngIf"],[1,"dropdown-backdrop",3,"click"],[1,"absolute","z-40","mt-1","max-h-60","w-full","overflow-auto","rounded-md","bg-white","py-1","text-base","shadow-lg","ring-1","ring-black","ring-opacity-5","focus:outline-none","sm:text-sm"],["tabindex","-1","role","listbox"],["class","relative cursor-pointer select-none py-2 pl-3 pr-9 hover:bg-primary text-gray-900 group",3,"click",4,"ngFor","ngForOf"],[1,"relative","cursor-pointer","select-none","py-2","pl-3","pr-9","hover:bg-primary","text-gray-900","group",3,"click"],[1,"flex","items-center"],[1,"font-normal","block","truncate","group-hover:font-semibold"],["class","absolute inset-y-0 right-0 flex items-center pr-4 text-primary",4,"ngIf"],[1,"absolute","inset-y-0","right-0","flex","items-center","pr-4","text-primary"],["viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],[1,"absolute","z-40","mt-1","w-full","rounded-md","bg-white","py-2","px-3","text-sm","text-gray-500","shadow-lg","border"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),y(3,"lucide-icon",3),r(),n(4,"input",4),p("ngModelChange",function(l){return t.onSearchChange(l)})("focus",function(){return t.isOpen.set(!0)}),r()(),v(5,pe,1,0,"div",5)(6,ge,3,1,"div",6)(7,fe,2,0,"div",7),r()),e&2&&(s(3),d("img",t.icons.Search),s(),d("ngModel",t.searchText())("disabled",t.disabled()),s(),d("ngIf",t.isOpen()),s(),d("ngIf",t.isOpen()&&t.filteredOptions().length>0),s(),d("ngIf",t.isOpen()&&t.filteredOptions().length===0))},dependencies:[E,D,M,A,V,O,F,k,N],styles:[".dropdown-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:30;background:transparent}"]})};function ye(c,i){if(c&1){let e=S();n(0,"tr")(1,"td",29),a(2),r(),n(3,"td",30),a(4),r(),n(5,"td",30),a(6),r(),n(7,"td",30),a(8),r(),n(9,"td",31)(10,"button",32),p("click",function(){let o=u(e).$implicit,l=m();return g(l.openEditModal(o))}),y(11,"lucide-icon",33),r(),n(12,"button",34),p("click",function(){let o=u(e).$implicit,l=m();return g(l.delete(o))}),y(13,"lucide-icon",33),r()()()}if(c&2){let e=i.$implicit,t=m();s(2),h(" ",t.getSpecialtyName(e.specialtyId)," "),s(2),h(" ",t.getDoctorName(e.doctorId)," "),s(2),h(" S/ ",e.cost," "),s(2),h(" ",e.durationMinutes," min "),s(3),d("img",t.icons.Edit),s(2),d("img",t.icons.Trash2)}}function he(c,i){if(c&1&&(n(0,"tr")(1,"td",35)(2,"div",36),y(3,"lucide-icon",37),n(4,"p",38),a(5,"No se encontraron asignaciones "),r(),n(6,"p",39),a(7,"Intenta ajustar los filtros de b\xFAsqueda. "),r()()()()),c&2){let e=m();s(3),d("img",e.icons.Search)}}function xe(c,i){if(c&1){let e=S();n(0,"div",40)(1,"div",41)(2,"div",42),p("click",function(){u(e);let o=m();return g(o.closeModal())}),r(),n(3,"span",43),a(4,"\u200B"),r(),n(5,"div",44)(6,"div",45)(7,"button",46),p("click",function(){u(e);let o=m();return g(o.closeModal())}),n(8,"span",24),a(9,"Cerrar"),r(),y(10,"lucide-icon",47),r()(),n(11,"div",48)(12,"div",49)(13,"h3",50),a(14),r(),n(15,"div",51)(16,"div")(17,"label",52),a(18,"Especialista"),r(),n(19,"app-doctor-selector",53),p("selectionChanged",function(o){u(e);let l=m();return g(l.selectedDoctorId=o)}),r()(),n(20,"div")(21,"label",52),a(22,"Especialidad"),r(),n(23,"app-specialty-selector",53),p("selectionChanged",function(o){u(e);let l=m();return g(l.selectedSpecialtyId=o)}),r()(),n(24,"div",54)(25,"div")(26,"label",55),a(27,"Costo (S/)"),r(),n(28,"input",56),p("input",function(o){u(e);let l=m();return g(l.onCostInput(o))}),r()(),n(29,"div")(30,"label",55),a(31,"Duraci\xF3n (min)"),r(),n(32,"input",57),p("input",function(o){u(e);let l=m();return g(l.onDurationInput(o))}),r()()()()()(),n(33,"div",58)(34,"button",59),p("click",function(){u(e);let o=m();return g(o.save())}),a(35," Guardar "),r(),n(36,"button",60),p("click",function(){u(e);let o=m();return g(o.closeModal())}),a(37," Cancelar "),r()()()()()}if(c&2){let e=m();s(10),d("img",e.icons.Plus),s(4),h(" ",e.isEditMode()?"Editar asignaci\xF3n":"Nueva asignaci\xF3n"," "),s(5),d("disabled",e.isEditMode()),s(4),d("disabled",e.isEditMode()),s(5),d("ngModel",e.cost),s(4),d("ngModel",e.duration),s(2),d("disabled",!e.selectedDoctorId||!e.selectedSpecialtyId)}}var oe=class c{associationService=x(te);doctorService=x(ee);specialtyService=x(L);confirmService=x(Z);icons={Plus:K,Trash2:W,Edit:U,Search:T,X:Y,Filter:J};doctors=this.doctorService.doctors;specialties=this.specialtyService.specialties;associations=this.associationService.associations;searchTerm=f("");filterDoctorId=f("");filterSpecialtyId=f("");isModalOpen=f(!1);isEditMode=f(!1);selectedDoctorId="";selectedSpecialtyId="";cost=0;duration=30;originalAssociation=null;formattedDoctors=_(()=>this.doctors().map(i=>H(j({},i),{valueId:i.doctorId||i.id,displayName:i.dni?`${i.dni} - ${i.fullName}`:i.fullName})));get doctorFilterOptions(){let i=this.formattedDoctors().map(e=>({id:e.valueId,label:e.displayName}));return[{id:"",label:"Todos los especialistas"},...i]}get specialtyFilterOptions(){let i=this.specialties().map(e=>({id:e.specialtyId,label:e.name}));return[{id:"",label:"Todas las especialidades"},...i]}filteredAssociations=_(()=>{let i=this.searchTerm().toLowerCase(),e=this.filterDoctorId(),t=this.filterSpecialtyId();return this.associations().filter(o=>{let l=this.doctors().find(G=>G.doctorId===o.doctorId||G.id===o.doctorId),C=l?.fullName.toLowerCase()||"",w=l?.dni?.toLowerCase()||"",$=this.getSpecialtyName(o.specialtyId).toLowerCase(),z=C.includes(i)||w.includes(i)||$.includes(i),ne=!e||o.doctorId===e,re=!t||o.specialtyId===t;return z&&ne&&re}).sort((o,l)=>{let C=this.getSpecialtyName(o.specialtyId).toLowerCase(),w=this.getSpecialtyName(l.specialtyId).toLowerCase();if(C<w)return-1;if(C>w)return 1;let $=this.getDoctorName(o.doctorId).toLowerCase(),z=this.getDoctorName(l.doctorId).toLowerCase();return $.localeCompare(z)})});doctorSelector;specialtySelector;onSearchInput(i){let e=i.target,t=e.value.replace(/[^a-zA-Z0-9 áéíóúÁÉÍÓÚñÑ]/g,"");e.value!==t&&(e.value=t),this.searchTerm.set(t)}onCostInput(i){let e=i.target,t=e.value.replace(/[^0-9.]/g,""),o=t.split(".");o.length>2&&(t=o[0]+"."+o.slice(1).join("").replace(/\./g,"")),o.length===2&&o[1].length>2&&(t=o[0]+"."+o[1].substring(0,2)),e.value!==t&&(e.value=t),this.cost=parseFloat(t)||0}onDurationInput(i){let e=i.target,t=e.value.replace(/\D/g,"");t.length>3&&(t=t.substring(0,3)),e.value!==t&&(e.value=t),this.duration=parseInt(t,10)||0}getDoctorName(i){let e=this.doctors().find(t=>t.doctorId===i||t.id===i);return e?e.dni?`${e.dni} - ${e.fullName}`:e.fullName:"Desconocido"}getSpecialtyName(i){return this.specialties().find(e=>e.specialtyId===i)?.name||"Desconocida"}openAddModal(){this.isEditMode.set(!1),this.resetForm(),this.doctorSelector?.clear(),this.specialtySelector?.clear(),this.isModalOpen.set(!0)}openEditModal(i){this.isEditMode.set(!0),this.selectedDoctorId=i.doctorId,this.selectedSpecialtyId=i.specialtyId,this.cost=i.cost,this.duration=i.durationMinutes,this.originalAssociation=j({},i),this.isModalOpen.set(!0),setTimeout(()=>{this.doctorSelector?.setValue(i.doctorId),this.specialtySelector?.setValue(i.specialtyId)})}closeModal(){this.isModalOpen.set(!1),this.resetForm(),this.originalAssociation=null}save(){if(!this.selectedDoctorId||!this.selectedSpecialtyId)return;let i={doctorId:this.selectedDoctorId,specialtyId:this.selectedSpecialtyId,cost:this.cost,durationMinutes:this.duration};if(console.log("\u{1F4BE} Saving association for Doctor ID:",this.selectedDoctorId),this.isEditMode()&&this.originalAssociation?.doctorSpecialtyId)this.associationService.updateAssociation(this.originalAssociation.doctorSpecialtyId,i).subscribe({next:()=>this.closeModal(),error:e=>alert("Error al actualizar: "+(e.error?.message||e.message))});else{if(this.associations().some(t=>t.doctorId===i.doctorId&&t.specialtyId===i.specialtyId)){alert("Esta asignaci\xF3n ya existe.");return}this.associationService.addAssociation(this.selectedDoctorId,i).subscribe({next:()=>this.closeModal(),error:t=>alert("Error al guardar: "+(t.error?.message||t.message))})}}async delete(i){if(!i.doctorSpecialtyId)return;await this.confirmService.confirm({title:"Eliminar Asignaci\xF3n",message:`\xBFEst\xE1s seguro de eliminar la asignaci\xF3n de ${this.getSpecialtyName(i.specialtyId)} a ${this.getDoctorName(i.doctorId)}?`,confirmText:"Eliminar",cancelText:"Cancelar"})&&this.associationService.removeAssociation(i.doctorSpecialtyId).subscribe()}resetForm(){this.selectedDoctorId="",this.selectedSpecialtyId="",this.cost=0,this.duration=30}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=I({type:c,selectors:[["app-doctor-specialty"]],viewQuery:function(e,t){if(e&1&&(B(q,5),B(b,5)),e&2){let o;P(o=Q())&&(t.doctorSelector=o.first),P(o=Q())&&(t.specialtySelector=o.first)}},decls:42,vars:10,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8"],[1,"sm:flex","sm:items-center"],[1,"sm:flex-auto"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-700"],[1,"mt-4","sm:mt-0","sm:ml-16","sm:flex-none"],[1,"inline-flex","items-center","justify-center","rounded-md","border","border-transparent","bg-primary","px-4","py-2","text-sm","font-medium","text-white","shadow-sm","hover:bg-primary","focus:outline-none","focus:ring-2","focus:ring-primary","focus:ring-offset-2","sm:w-auto","gap-2",3,"click"],[1,"w-4","h-4",3,"img"],[1,"mt-8","bg-white","p-4","rounded-lg","shadow-sm","border","border-gray-200","grid","grid-cols-1","gap-4","md:grid-cols-3"],[1,"relative","rounded-md","shadow-sm"],[1,"pointer-events-none","absolute","inset-y-0","left-0","flex","items-center","pl-3"],[1,"h-5","w-5","text-gray-400",3,"img"],["type","text","placeholder","Buscar especialista o especialidad...",1,"block","w-full","rounded-md","border-gray-300","pl-10","focus:border-primary","focus:ring-primary","sm:text-sm","border","py-2",3,"input","ngModel"],["placeholder","Todos los especialistas","displayMode","default",3,"ngModelChange","options","ngModel"],["placeholder","Todas las especialidades","displayMode","default",3,"ngModelChange","options","ngModel"],[1,"mt-8","flex","flex-col"],[1,"-my-2","-mx-4","overflow-x-auto","sm:-mx-6","lg:-mx-8"],[1,"inline-block","min-w-full","py-2","align-middle","md:px-6","lg:px-8"],[1,"overflow-hidden","shadow","ring-1","ring-black","ring-opacity-5","md:rounded-lg"],[1,"min-w-full","divide-y","divide-gray-300"],[1,"bg-gray-50"],["scope","col",1,"py-3.5","pl-4","pr-3","text-left","text-sm","font-semibold","text-gray-900","sm:pl-6"],["scope","col",1,"px-3","py-3.5","text-left","text-sm","font-semibold","text-gray-900"],["scope","col",1,"relative","py-3.5","pl-3","pr-4","sm:pr-6"],[1,"sr-only"],[1,"divide-y","divide-gray-200","bg-white"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto","aria-labelledby","modal-title","role","dialog","aria-modal","true",4,"ngIf"],[1,"whitespace-nowrap","py-4","pl-4","pr-3","text-sm","font-medium","text-gray-900","sm:pl-6"],[1,"whitespace-nowrap","px-3","py-4","text-sm","text-gray-500"],[1,"relative","whitespace-nowrap","py-4","pl-3","pr-4","text-right","text-sm","font-medium","sm:pr-6"],["title","Editar",1,"text-primary","hover:text-blue-900","mr-2","p-2","rounded-full","hover:bg-primary","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],["title","Desactivar",1,"text-red-600","hover:text-red-900","p-2","rounded-full","hover:bg-red-50","transition-all",3,"click"],["colspan","5",1,"px-6","py-12","text-center","text-gray-500"],[1,"flex","flex-col","items-center","justify-center"],[1,"h-12","w-12","text-gray-300","mb-3","opacity-50",3,"img"],[1,"text-base","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","items-end","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity",3,"click"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"relative","inline-block","align-bottom","bg-white","rounded-lg","px-4","pt-5","pb-4","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full","sm:p-6"],[1,"absolute","top-0","right-0","pt-4","pr-4"],["type","button",1,"bg-white","rounded-md","text-gray-400","hover:text-gray-500","focus:outline-none",3,"click"],[1,"w-6","h-6","rotate-45",3,"img"],[1,"sm:flex","sm:items-start","w-full"],[1,"mt-3","text-center","sm:mt-0","sm:text-left","w-full"],["id","modal-title",1,"text-lg","leading-6","font-medium","text-gray-900"],[1,"mt-4","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","text-left","mb-1"],[3,"selectionChanged","disabled"],[1,"grid","grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","text-left"],["type","text","inputmode","decimal",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","px-3","text-base","focus:border-primary","focus:outline-none","focus:ring-primary","sm:text-sm","border",3,"input","ngModel"],["type","text","inputmode","numeric",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","px-3","text-base","focus:border-primary","focus:outline-none","focus:ring-primary","sm:text-sm","border",3,"input","ngModel"],[1,"mt-5","sm:mt-4","sm:flex","sm:flex-row-reverse"],["type","button",1,"inline-flex","w-full","justify-center","rounded-md","border","border-transparent","bg-primary","px-4","py-2","text-base","font-medium","text-white","shadow-sm","hover:bg-primary","focus:outline-none","focus:ring-2","focus:ring-primary","focus:ring-offset-2","sm:ml-3","sm:w-auto","sm:text-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","border","border-gray-300","bg-white","px-4","py-2","text-base","font-medium","text-gray-700","shadow-sm","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-primary","focus:ring-offset-2","sm:mt-0","sm:w-auto","sm:text-sm",3,"click"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Asignaci\xF3n de especialidades"),r(),n(5,"p",4),a(6,"Gestiona las especialidades asignadas a cada m\xE9dico, sus costos y duraciones."),r()(),n(7,"div",5)(8,"button",6),p("click",function(){return t.openAddModal()}),y(9,"lucide-icon",7),a(10," Nueva asignaci\xF3n "),r()()(),n(11,"div",8)(12,"div",9)(13,"div",10),y(14,"lucide-icon",11),r(),n(15,"input",12),p("input",function(l){return t.onSearchInput(l)}),r()(),n(16,"div")(17,"app-searchable-select",13),p("ngModelChange",function(l){return t.filterDoctorId.set(l.toString())}),r()(),n(18,"div")(19,"app-searchable-select",14),p("ngModelChange",function(l){return t.filterSpecialtyId.set(l.toString())}),r()()(),n(20,"div",15)(21,"div",16)(22,"div",17)(23,"div",18)(24,"table",19)(25,"thead",20)(26,"tr")(27,"th",21),a(28," Especialidad"),r(),n(29,"th",22),a(30," Especialista"),r(),n(31,"th",22),a(32,"Costo "),r(),n(33,"th",22),a(34," Duraci\xF3n"),r(),n(35,"th",23)(36,"span",24),a(37,"Acciones"),r()()()(),n(38,"tbody",25),v(39,ye,14,6,"tr",26)(40,he,8,1,"tr",27),r()()()()()()(),v(41,xe,38,7,"div",28)),e&2&&(s(9),d("img",t.icons.Plus),s(5),d("img",t.icons.Search),s(),d("ngModel",t.searchTerm()),s(2),d("options",t.doctorFilterOptions)("ngModel",t.filterDoctorId()),s(2),d("options",t.specialtyFilterOptions)("ngModel",t.filterSpecialtyId()),s(20),d("ngForOf",t.filteredAssociations()),s(),d("ngIf",t.filteredAssociations().length===0),s(),d("ngIf",t.isModalOpen()))},dependencies:[E,D,M,A,V,O,F,k,N,q,b,ie],encapsulation:2})};export{oe as DoctorSpecialtyComponent};
