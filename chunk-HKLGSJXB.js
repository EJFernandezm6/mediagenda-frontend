import{a as ne}from"./chunk-GGGXCLBV.js";import{a as ie}from"./chunk-DLWRNSCF.js";import"./chunk-G2AI53GJ.js";import{b as oe,c as se,f as le,i as ae,j as de,k as ce,o as me}from"./chunk-FIV2NONW.js";import{a as re}from"./chunk-MZ3EZVY4.js";import{$a as m,$b as j,Ab as V,Ia as N,Ic as B,J as h,Lc as q,Ma as x,N as T,Qb as R,Qc as z,Rb as O,S as b,Sb as F,Sc as G,Ta as c,Tc as H,Ua as i,Va as r,Vb as P,Vc as X,Wa as p,X as u,Xa as k,Xc as J,Y as g,Ya as D,Yc as K,Za as U,_a as f,a as M,ac as W,ad as Q,b as I,dd as Y,ea as v,fd as Z,gb as d,hb as E,hd as ee,ib as _,ic as $,id as te,lb as y,mb as C,nb as w,p as A,rb as L,ta as s}from"./chunk-SWYYGHOG.js";var S=class a{http=b(W);apiUrl=`${re.apiUrl}/iam/users`;users=v([]);_currentRole="";constructor(){this.refreshUsers()}refreshUsers(t){t!==void 0&&(this._currentRole=t);let e=new j;this._currentRole&&(e=e.set("role",this._currentRole)),this.http.get(this.apiUrl,{params:e}).pipe(h(n=>console.log("Raw users data:",n)),A(n=>n.map(o=>I(M({},o),{id:o.userId||o.id,fullName:o.fullName||o.name})))).subscribe({next:n=>this.users.set(n),error:n=>console.error("Error fetching users:",n)})}getUsers(){return this.users()}addUser(t){return this.http.post(this.apiUrl,t).pipe(h(()=>this.refreshUsers()))}updateUser(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(h(()=>this.refreshUsers()))}deleteUser(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(h(()=>this.refreshUsers()))}toggleAdminRole(t){return this.http.post(`${this.apiUrl}/${t}/toggle-admin`,{}).pipe(h(()=>this.refreshUsers()))}toggleUserActive(t){return this.http.post(`${this.apiUrl}/${t}/toggle-active`,{}).pipe(h(()=>this.refreshUsers()))}static \u0275fac=function(e){return new(e||a)};static \u0275prov=T({token:a,factory:a.\u0275fac,providedIn:"root"})};var fe=(a,t)=>({"bg-purple-50 text-purple-700 border-purple-100":a,"bg-blue-50 text-blue-700 border-blue-100":t});function xe(a,t){if(a&1&&(i(0,"span",41),d(1),r()),a&2){let e=m().$implicit;c("ngClass",L(2,fe,e==="ADMIN",e==="DOCTOR")),s(),_(" ",e==="DOCTOR"?"Especialista":"Administrador"," ")}}function he(a,t){if(a&1&&(k(0),x(1,xe,2,5,"span",40),D()),a&2){let e=t.$implicit;s(),c("ngIf",e!=="STAFF")}}function be(a,t){a&1&&(i(0,"span",42),p(1,"div",43),d(2," Activo "),r())}function ve(a,t){a&1&&(i(0,"span",44),p(1,"div",45),d(2," Inactivo "),r())}function _e(a,t){if(a&1){let e=U();i(0,"tr",25)(1,"td",26)(2,"div",27)(3,"div",28),d(4),r(),i(5,"div")(6,"div",29),d(7),r(),i(8,"div",30),d(9),r()()()(),i(10,"td",26)(11,"div",31),x(12,he,2,1,"ng-container",32),r()(),i(13,"td",26),x(14,be,3,0,"span",33)(15,ve,3,0,"span",34),r(),i(16,"td",35)(17,"div",36)(18,"button",37),f("click",function(){let o=u(e).$implicit,l=m();return g(l.toggleAdmin(o))}),p(19,"lucide-icon",5),r(),i(20,"button",38),f("click",function(){let o=u(e).$implicit,l=m();return g(l.toggleActive(o))}),p(21,"lucide-icon",5),r(),i(22,"button",39),f("click",function(){let o=u(e).$implicit,l=m();return g(l.editUser(o))}),p(23,"lucide-icon",5),r()()()()}if(a&2){let e=t.$implicit,n=m();s(4),_(" ",e.fullName.charAt(0)," "),s(3),E(e.fullName),s(2),E(e.email),s(3),c("ngForOf",e.roles),s(2),c("ngIf",e.active),s(),c("ngIf",!e.active),s(3),c("ngClass",e.roles.includes("ADMIN")?"text-purple-600 bg-purple-50 hover:bg-purple-100":"text-gray-400 hover:text-purple-600 hover:bg-purple-50"),s(),c("img",n.Icons.Shield),s(),c("ngClass",e.active?"text-emerald-600 bg-emerald-50 hover:bg-emerald-100":"text-red-500 bg-red-50 hover:bg-red-100")("title",e.active?"Desactivar Usuario":"Activar Usuario"),s(),c("img",n.Icons.Power),s(2),c("img",n.Icons.Pencil)}}function ye(a,t){if(a&1&&(i(0,"div",64),p(1,"lucide-icon",65),i(2,"div")(3,"span",66),d(4,"Creando Administrador"),r(),d(5," Este usuario tendr\xE1 acceso completo al sistema. Para registrar doctores, usa el m\xF3dulo de Especialistas. "),r()()),a&2){let e=m(2);s(),c("img",e.Icons.ShieldCheck)}}function Ce(a,t){if(a&1){let e=U();i(0,"div",54)(1,"label",55),d(2,"Contrase\xF1a"),r(),i(3,"div",56)(4,"input",67),w("ngModelChange",function(o){u(e);let l=m(2);return C(l.formData.password,o)||(l.formData.password=o),g(o)}),r(),p(5,"lucide-icon",8),r()()}if(a&2){let e=m(2);s(4),y("ngModel",e.formData.password),s(),c("img",e.Icons.Lock)}}function we(a,t){if(a&1){let e=U();i(0,"div",46)(1,"div",47)(2,"div",48)(3,"h2",49),d(4),r(),i(5,"button",50),f("click",function(){u(e);let o=m();return g(o.closeModal())}),p(6,"lucide-icon",51),r()(),i(7,"div",52),x(8,ye,6,1,"div",53),i(9,"div",54)(10,"label",55),d(11,"Nombre Completo"),r(),i(12,"div",56)(13,"input",57),w("ngModelChange",function(o){u(e);let l=m();return C(l.formData.fullName,o)||(l.formData.fullName=o),g(o)}),r(),p(14,"lucide-icon",8),r()(),i(15,"div",54)(16,"label",55),d(17,"Correo Electr\xF3nico"),r(),i(18,"div",56)(19,"input",58),w("ngModelChange",function(o){u(e);let l=m();return C(l.formData.email,o)||(l.formData.email=o),g(o)}),r(),p(20,"lucide-icon",8),r()(),x(21,Ce,6,2,"div",59),p(22,"div",60),r(),i(23,"div",61)(24,"button",62),f("click",function(){u(e);let o=m();return g(o.closeModal())}),d(25," Cancelar "),r(),i(26,"button",63),f("click",function(){u(e);let o=m();return g(o.saveUser())}),d(27),r()()()()}if(a&2){let e=m();s(4),_(" ",e.isEditing?"Editar Usuario":"Nuevo Usuario"," "),s(2),c("img",e.Icons.X),s(2),c("ngIf",!e.isEditing),s(5),y("ngModel",e.formData.fullName),s(),c("img",e.Icons.User),s(5),y("ngModel",e.formData.email),s(),c("img",e.Icons.Mail),s(),c("ngIf",!e.isEditing),s(5),c("disabled",!e.isValid()),s(),_(" ",e.isEditing?"Guardar Cambios":"Crear Usuario"," ")}}var pe=class a{usersService=b(S);authService=b(ne);confirmService=b(ie);Icons={Plus:G,Search:X,Trash2:Q,Pencil:z,Mail:q,BadgeCheck:$,X:Z,User:Y,Lock:B,ShieldCheck:J,Shield:K,Power:H};users=this.usersService.users;searchTerm=v("");selectedRole=v("");selectedStatus=v("");isModalOpen=!1;isEditing=!1;editingId=null;formData={fullName:"",email:"",password:"",roles:["ADMIN"],cmp:"",clinicId:""};currentUser=this.authService.currentUser;filteredUsers=V(()=>{let t=this.users(),e=this.searchTerm().toLowerCase(),n=this.selectedRole(),o=this.selectedStatus();if(e&&(t=t.filter(l=>l.fullName.toLowerCase().includes(e)||l.email.toLowerCase().includes(e)||l.cmp&&l.cmp.toLowerCase().includes(e))),n&&(t=t.filter(l=>l.roles.includes(n))),o){let l=o==="ACTIVE";t=t.filter(ue=>ue.active===l)}return t});hasRole(t){return this.formData.roles.includes(t)}constructor(){}filterByRole(t){this.selectedRole.set(t)}filterByStatus(t){this.selectedStatus.set(t)}openModal(){this.isEditing=!1,this.editingId=null,this.formData={fullName:"",email:"",password:"",roles:["ADMIN"],cmp:"",clinicId:""},this.isModalOpen=!0}editUser(t){this.isEditing=!0,this.editingId=t.id,this.formData={fullName:t.fullName,email:t.email,password:"",roles:[...t.roles],cmp:t.cmp||"",clinicId:t.clinicId},this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}saveUser(){this.isEditing&&this.editingId?this.usersService.updateUser(this.editingId,this.formData).subscribe(()=>{this.closeModal()}):this.usersService.addUser(this.formData).subscribe(()=>{this.closeModal()})}async toggleAdmin(t){await this.confirmService.confirm({title:"Cambiar Rol de Administrador",message:`\xBFEst\xE1s seguro de cambiar el rol de Administrador para ${t.fullName}?`,confirmText:"Confirmar",cancelText:"Cancelar"})&&this.usersService.toggleAdminRole(t.id).subscribe({next:()=>{},error:n=>{console.error("Error toggling admin role:",n),alert("Error al cambiar el rol. Por favor intente nuevamente.")}})}async toggleActive(t){let e=t.active?"desactivar":"activar";await this.confirmService.confirm({title:`${e.charAt(0).toUpperCase()+e.slice(1)} Usuario`,message:`\xBFEst\xE1s seguro de ${e} a ${t.fullName}?`,confirmText:e.charAt(0).toUpperCase()+e.slice(1),cancelText:"Cancelar"})&&this.usersService.toggleUserActive(t.id).subscribe({next:()=>{},error:o=>{console.error("Error toggling active status:",o),alert("Error al cambiar el estado. Por favor intente nuevamente.")}})}isValid(){return!(!this.formData.fullName||!this.formData.email||!this.isEditing&&!this.formData.password||this.formData.roles.length===0)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=N({type:a,selectors:[["app-users-list"]],decls:43,vars:7,consts:[[1,"p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-500"],[1,"btn","btn-primary","flex","items-center","gap-2",3,"click"],[1,"w-4","h-4",3,"img"],[1,"bg-white","p-4","rounded-lg","shadow-sm","border","border-gray-100","mb-6","flex","gap-4"],[1,"relative","flex-1"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","w-5","h-5","text-gray-400",3,"img"],["type","text","placeholder","Buscar por nombre o email...",1,"w-full","pl-12","pr-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","transition-all",3,"ngModelChange","ngModel"],[1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","bg-white","min-w-[150px]",3,"ngModelChange","ngModel"],["value",""],["value","ACTIVE"],["value","INACTIVE"],[1,"px-4","py-2","border","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","bg-white","min-w-[200px]",3,"ngModelChange","ngModel"],["value","ADMIN"],["value","DOCTOR"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],[1,"w-full"],[1,"bg-gray-50","border-b","border-gray-100"],[1,"px-6","py-4","text-left","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider"],[1,"px-6","py-4","text-right","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider"],[1,"divide-y","divide-gray-100"],["class","hover:bg-gray-50 transition-colors group",4,"ngFor","ngForOf"],["class","fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm p-4",4,"ngIf"],[1,"hover:bg-gray-50","transition-colors","group"],[1,"px-6","py-4"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-full","bg-primary/10","flex","items-center","justify-center","text-primary","font-bold","shadow-sm"],[1,"font-medium","text-gray-900","group-hover:text-primary","transition-colors"],[1,"text-sm","text-gray-500"],[1,"flex","gap-1","flex-wrap"],[4,"ngFor","ngForOf"],["class","inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-100",4,"ngIf"],["class","inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-100",4,"ngIf"],[1,"px-6","py-4","text-right"],[1,"flex","justify-end","gap-2"],["title","Alternar Administrador",1,"p-2","rounded-lg","transition-all",3,"click","ngClass"],[1,"p-2","rounded-lg","transition-all",3,"click","ngClass","title"],["title","Editar",1,"p-2","text-gray-400","hover:text-blue-600","hover:bg-blue-50","rounded-lg","transition-all",3,"click"],["class","px-2.5 py-0.5 rounded-full text-xs font-medium border shadow-sm",3,"ngClass",4,"ngIf"],[1,"px-2.5","py-0.5","rounded-full","text-xs","font-medium","border","shadow-sm",3,"ngClass"],[1,"inline-flex","items-center","gap-1.5","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-emerald-50","text-emerald-700","border","border-emerald-100"],[1,"w-1.5","h-1.5","rounded-full","bg-emerald-500"],[1,"inline-flex","items-center","gap-1.5","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-red-50","text-red-700","border","border-red-100"],[1,"w-1.5","h-1.5","rounded-full","bg-red-500"],[1,"fixed","inset-0","bg-black/50","z-50","flex","items-center","justify-center","backdrop-blur-sm","p-4"],[1,"bg-white","rounded-2xl","shadow-xl","w-full","max-w-lg","flex","flex-col","max-h-[90vh]"],[1,"px-6","py-4","border-b","border-gray-100","flex","justify-between","items-center","bg-gray-50","rounded-t-2xl","flex-shrink-0"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","hover:bg-gray-100","p-2","rounded-full","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],[1,"p-6","space-y-5","overflow-y-auto"],["class","bg-blue-50 text-blue-700 p-3 rounded-lg flex gap-3 text-sm items-start",4,"ngIf"],[1,"space-y-2"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"relative"],["type","text","autocomplete","off","placeholder","Ej: Juan P\xE9rez",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","transition-all","pl-12",3,"ngModelChange","ngModel"],["type","email","autocomplete","off","placeholder","correo@ejemplo.com",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","transition-all","pl-12",3,"ngModelChange","ngModel"],["class","space-y-2",4,"ngIf"],[1,"hidden"],[1,"px-6","py-4","border-t","border-gray-100","flex","justify-end","gap-3","bg-gray-50","rounded-b-2xl","flex-shrink-0"],[1,"px-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-all","font-medium",3,"click"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-all","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","shadow-sm","shadow-primary/20",3,"click","disabled"],[1,"bg-blue-50","text-blue-700","p-3","rounded-lg","flex","gap-3","text-sm","items-start"],[1,"w-5","h-5","flex-shrink-0","mt-0.5",3,"img"],[1,"font-bold","block"],["type","password","autocomplete","new-password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","outline-none","transition-all","pl-12",3,"ngModelChange","ngModel"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),d(4,"Gesti\xF3n de Usuarios"),r(),i(5,"p",3),d(6,"Administra el acceso y roles del sistema"),r()(),i(7,"button",4),f("click",function(){return n.openModal()}),p(8,"lucide-icon",5),d(9," Nuevo Usuario "),r()(),i(10,"div",6)(11,"div",7),p(12,"lucide-icon",8),i(13,"input",9),w("ngModelChange",function(l){return C(n.searchTerm,l)||(n.searchTerm=l),l}),r()(),i(14,"select",10),f("ngModelChange",function(l){return n.filterByStatus(l)}),i(15,"option",11),d(16,"Todos los estados"),r(),i(17,"option",12),d(18,"Activos"),r(),i(19,"option",13),d(20,"Inactivos"),r()(),i(21,"select",14),f("ngModelChange",function(l){return n.filterByRole(l)}),i(22,"option",11),d(23,"Todos los roles"),r(),i(24,"option",15),d(25,"Administradores"),r(),i(26,"option",16),d(27,"Especialistas"),r()()(),i(28,"div",17)(29,"table",18)(30,"thead",19)(31,"tr")(32,"th",20),d(33,"Usuario "),r(),i(34,"th",20),d(35,"Rol "),r(),i(36,"th",20),d(37,"Estado "),r(),i(38,"th",21),d(39," Acciones"),r()()(),i(40,"tbody",22),x(41,_e,24,12,"tr",23),r()()()(),x(42,we,28,10,"div",24)),e&2&&(s(8),c("img",n.Icons.Plus),s(4),c("img",n.Icons.Search),s(),y("ngModel",n.searchTerm),s(),c("ngModel",n.selectedStatus()),s(7),c("ngModel",n.selectedRole()),s(20),c("ngForOf",n.filteredUsers()),s(),c("ngIf",n.isModalOpen))},dependencies:[P,R,O,F,me,de,ce,oe,ae,se,le,te,ee],encapsulation:2})};export{pe as UsersListComponent};
