import{a as n}from"./chunk-MZ3EZVY4.js";import{L as U,N as i,R as d,W as f,a as l,b as h,ia as c,r as g,wc as u,xc as m}from"./chunk-2ZD6ZATD.js";var R=class o{http=f(m);apiUrl=`${n.apiUrl}/iam/users`;users=c([]);_currentRole="";constructor(){this.refreshUsers()}refreshUsers(e){e!==void 0&&(this._currentRole=e);let t=new u;this._currentRole&&(t=t.set("role",this._currentRole)),this.http.get(this.apiUrl,{params:t}).pipe(i(r=>console.log("Raw users data:",r)),g(r=>r.map(s=>h(l({},s),{id:s.userId||s.id,fullName:s.fullName||s.name})))).subscribe({next:r=>this.users.set(r),error:r=>console.error("Error fetching users:",r)})}getUsers(){return this.users()}rolesUrl=`${n.apiUrl}/iam/roles`;getRoles(){return this.http.get(this.rolesUrl)}addUser(e){return this.getRoles().pipe(U(t=>{let r=e.roles.includes("ADMIN")?"ADMIN":e.roles[0],s=t.find(a=>a.roleKey===r||a.name.toUpperCase()===r);if(!s)throw new Error(`Role ${r} not found`);let p={fullName:e.fullName,email:e.email,password:e.password,roleId:s.roleId,phone:e.phone||"",photoUrl:e.photoUrl||""};return console.log("\u{1F50D} Role found:",s),console.log("\u{1F4E4} Final payload to send:",p),this.http.post(this.apiUrl,p)}),i(()=>this.refreshUsers()))}updateUser(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(i(()=>this.refreshUsers()))}deleteUser(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(i(()=>this.refreshUsers()))}toggleAdminRole(e){return this.http.post(`${this.apiUrl}/${e}/toggle-admin`,{}).pipe(i(()=>this.refreshUsers()))}toggleSpecialistRole(e){return this.http.post(`${this.apiUrl}/${e}/toggle-specialist`,{}).pipe(i(()=>this.refreshUsers()))}toggleUserActive(e){return this.http.post(`${this.apiUrl}/${e}/toggle-active`,{}).pipe(i(()=>this.refreshUsers()))}updateProfile(e){return this.http.put(`${this.apiUrl}/profile`,e).pipe(i(()=>this.refreshUsers()))}changePassword(e){return this.http.put(`${this.apiUrl}/change-password`,e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{R as a};
