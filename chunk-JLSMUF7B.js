import{a as D}from"./chunk-IQCUBMRG.js";import{a as oe}from"./chunk-EZCPFMFM.js";import{a as G}from"./chunk-LZP63J3R.js";import{a as te}from"./chunk-JUTIX74D.js";import{b as X,c as R,f as H,h as J,i as K,j as U,k as Y,l as Z,o as ee}from"./chunk-DOKJHZWU.js";import{a as ie}from"./chunk-LGBSUADE.js";import"./chunk-MZ3EZVY4.js";import{$a as m,$c as $,Bb as C,Ia as N,Ic as W,Ma as x,S,Ta as d,Tb as A,Ua as i,Ub as O,Uc as j,Va as n,Wa as b,X as u,Xb as L,Xc as P,Y as g,Za as I,_a as p,a as w,b as E,bb as T,cb as k,cd as z,db as V,ea as y,hb as l,hd as B,ib as F,jb as f,jd as Q,kd as q,mb as v,nb as h,ob as _,ta as a}from"./chunk-A3GKMUNS.js";function me(c,t){if(c&1&&(i(0,"option",30),l(1),n()),c&2){let e=t.$implicit;d("value",e.valueId),a(),f("",e.displayName," ")}}function pe(c,t){if(c&1&&(i(0,"option",30),l(1),n()),c&2){let e=t.$implicit;d("value",e.specialtyId),a(),f("",e.name," ")}}function ue(c,t){if(c&1){let e=I();i(0,"tr")(1,"td",31),l(2),n(),i(3,"td",32),l(4),n(),i(5,"td",32),l(6),n(),i(7,"td",32),l(8),n(),i(9,"td",33)(10,"button",34),p("click",function(){let r=u(e).$implicit,s=m();return g(s.openEditModal(r))}),l(11," Editar"),i(12,"span",25),l(13),n()(),i(14,"button",35),p("click",function(){let r=u(e).$implicit,s=m();return g(s.delete(r))}),l(15," Desactivar"),i(16,"span",25),l(17),n()()()()}if(c&2){let e=t.$implicit,o=m();a(2),f(" ",o.getSpecialtyName(e.specialtyId)," "),a(2),f(" ",o.getDoctorName(e.doctorId)," "),a(2),f(" S/ ",e.cost," "),a(2),f(" ",e.durationMinutes," min "),a(5),f(", ",o.getSpecialtyName(e.specialtyId)),a(4),f(", ",o.getSpecialtyName(e.specialtyId))}}function ge(c,t){if(c&1&&(i(0,"tr")(1,"td",36)(2,"div",37),b(3,"lucide-icon",38),i(4,"p"),l(5,"No se encontraron asignaciones que coincidan con los filtros."),n()()()()),c&2){let e=m();a(3),d("img",e.icons.Search)}}function fe(c,t){if(c&1&&(i(0,"option",30),l(1),n()),c&2){let e=t.$implicit;d("value",e.specialtyId),a(),F(e.name)}}function ye(c,t){if(c&1){let e=I();i(0,"div",39),b(1,"div",40),i(2,"div",41)(3,"div",42)(4,"div",43)(5,"div",44)(6,"button",45),p("click",function(){u(e);let r=m();return g(r.closeModal())}),i(7,"span",25),l(8,"Cerrar"),n(),b(9,"lucide-icon",46),n()(),i(10,"div",47)(11,"div",48)(12,"h3",49),l(13),n(),i(14,"div",50)(15,"div")(16,"label",51),l(17,"Especialista"),n(),i(18,"app-doctor-selector",52),p("selectionChanged",function(r){u(e);let s=m();return g(s.selectedDoctorId=r)}),n()(),i(19,"div")(20,"label",53),l(21,"Especialidad"),n(),i(22,"select",54),_("ngModelChange",function(r){u(e);let s=m();return h(s.selectedSpecialtyId,r)||(s.selectedSpecialtyId=r),g(r)}),i(23,"option",55),l(24,"Seleccionar especialidad"),n(),x(25,fe,2,2,"option",15),n()(),i(26,"div",56)(27,"div")(28,"label",53),l(29,"Costo (S/)"),n(),i(30,"input",57),_("ngModelChange",function(r){u(e);let s=m();return h(s.cost,r)||(s.cost=r),g(r)}),n()(),i(31,"div")(32,"label",53),l(33,"Duraci\xF3n (min)"),n(),i(34,"input",58),_("ngModelChange",function(r){u(e);let s=m();return h(s.duration,r)||(s.duration=r),g(r)}),n()()()()()(),i(35,"div",59)(36,"button",60),p("click",function(){u(e);let r=m();return g(r.save())}),l(37," Guardar "),n(),i(38,"button",61),p("click",function(){u(e);let r=m();return g(r.closeModal())}),l(39," Cancelar "),n()()()()()()}if(c&2){let e=m();a(9),d("img",e.icons.X),a(4),f(" ",e.isEditMode()?"Editar asignaci\xF3n":"Nueva asignaci\xF3n"," "),a(5),d("disabled",e.isEditMode()),a(4),v("ngModel",e.selectedSpecialtyId),d("disabled",e.isEditMode()),a(3),d("ngForOf",e.specialties()),a(5),v("ngModel",e.cost),a(4),v("ngModel",e.duration),a(2),d("disabled",!e.selectedDoctorId||!e.selectedSpecialtyId)}}var ne=class c{associationService=S(oe);doctorService=S(ie);specialtyService=S(te);confirmService=S(G);icons={Plus:j,Trash2:z,Edit:$,Search:P,X:B,Filter:W};doctors=this.doctorService.doctors;specialties=this.specialtyService.specialties;associations=this.associationService.associations;searchTerm=y("");filterDoctorId=y("");filterSpecialtyId=y("");isModalOpen=y(!1);isEditMode=y(!1);selectedDoctorId="";selectedSpecialtyId="";cost=0;duration=30;originalAssociation=null;formattedDoctors=C(()=>this.doctors().map(t=>E(w({},t),{valueId:t.doctorId||t.id,displayName:t.dni?`${t.dni} - ${t.fullName}`:t.fullName})));filteredAssociations=C(()=>{let t=this.searchTerm().toLowerCase(),e=this.filterDoctorId(),o=this.filterSpecialtyId();return this.associations().filter(r=>{let s=this.doctors().find(M=>M.doctorId===r.doctorId||M.id===r.doctorId),re=s?.fullName.toLowerCase()||"",le=s?.dni?.toLowerCase()||"",ae=this.getSpecialtyName(r.specialtyId).toLowerCase(),se=re.includes(t)||le.includes(t)||ae.includes(t),ce=!e||r.doctorId===e,de=!o||r.specialtyId===o;return se&&ce&&de})});doctorSelector;getDoctorName(t){let e=this.doctors().find(o=>o.doctorId===t||o.id===t);return e?e.dni?`${e.dni} - ${e.fullName}`:e.fullName:"Desconocido"}getSpecialtyName(t){return this.specialties().find(e=>e.specialtyId===t)?.name||"Desconocida"}openAddModal(){this.isEditMode.set(!1),this.resetForm(),this.doctorSelector?.clear(),this.isModalOpen.set(!0)}openEditModal(t){this.isEditMode.set(!0),this.selectedDoctorId=t.doctorId,this.selectedSpecialtyId=t.specialtyId,this.cost=t.cost,this.duration=t.durationMinutes,this.originalAssociation=w({},t),this.isModalOpen.set(!0),setTimeout(()=>{this.doctorSelector?.setValue(t.doctorId)})}closeModal(){this.isModalOpen.set(!1),this.resetForm(),this.originalAssociation=null}save(){if(!this.selectedDoctorId||!this.selectedSpecialtyId)return;let t={doctorId:this.selectedDoctorId,specialtyId:this.selectedSpecialtyId,cost:this.cost,durationMinutes:this.duration};if(console.log("\u{1F4BE} Saving association for Doctor ID:",this.selectedDoctorId),this.isEditMode()&&this.originalAssociation?.doctorSpecialtyId)this.associationService.updateAssociation(this.originalAssociation.doctorSpecialtyId,t).subscribe({next:()=>this.closeModal(),error:e=>alert("Error al actualizar: "+(e.error?.message||e.message))});else{if(this.associations().some(o=>o.doctorId===t.doctorId&&o.specialtyId===t.specialtyId)){alert("Esta asignaci\xF3n ya existe.");return}this.associationService.addAssociation(this.selectedDoctorId,t).subscribe({next:()=>this.closeModal(),error:o=>alert("Error al guardar: "+(o.error?.message||o.message))})}}async delete(t){if(!t.doctorSpecialtyId)return;await this.confirmService.confirm({title:"Eliminar Asignaci\xF3n",message:`\xBFEst\xE1s seguro de eliminar la asignaci\xF3n de ${this.getSpecialtyName(t.specialtyId)} a ${this.getDoctorName(t.doctorId)}?`,confirmText:"Eliminar",cancelText:"Cancelar"})&&this.associationService.removeAssociation(t.doctorSpecialtyId).subscribe()}resetForm(){this.selectedDoctorId="",this.selectedSpecialtyId="",this.cost=0,this.duration=30}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=N({type:c,selectors:[["app-doctor-specialty"]],viewQuery:function(e,o){if(e&1&&T(D,5),e&2){let r;k(r=V())&&(o.doctorSelector=r.first)}},decls:48,vars:10,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8"],[1,"sm:flex","sm:items-center"],[1,"sm:flex-auto"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-700"],[1,"mt-4","sm:mt-0","sm:ml-16","sm:flex-none"],[1,"inline-flex","items-center","justify-center","rounded-md","border","border-transparent","bg-blue-600","px-4","py-2","text-sm","font-medium","text-white","shadow-sm","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","sm:w-auto","gap-2",3,"click"],[1,"w-4","h-4",3,"img"],[1,"mt-8","bg-white","p-4","rounded-lg","shadow-sm","border","border-gray-200","grid","grid-cols-1","gap-4","md:grid-cols-4"],[1,"relative","rounded-md","shadow-sm"],[1,"pointer-events-none","absolute","inset-y-0","left-0","flex","items-center","pl-3"],[1,"h-5","w-5","text-gray-400",3,"img"],["type","text","placeholder","Buscar especialista o especialidad...",1,"block","w-full","rounded-md","border-gray-300","pl-10","focus:border-blue-500","focus:ring-blue-500","sm:text-sm","border","py-2",3,"ngModelChange","ngModel"],[1,"block","w-full","rounded-md","border-gray-300","py-2","pl-3","pr-10","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"mt-8","flex","flex-col"],[1,"-my-2","-mx-4","overflow-x-auto","sm:-mx-6","lg:-mx-8"],[1,"inline-block","min-w-full","py-2","align-middle","md:px-6","lg:px-8"],[1,"overflow-hidden","shadow","ring-1","ring-black","ring-opacity-5","md:rounded-lg"],[1,"min-w-full","divide-y","divide-gray-300"],[1,"bg-gray-50"],["scope","col",1,"py-3.5","pl-4","pr-3","text-left","text-sm","font-semibold","text-gray-900","sm:pl-6"],["scope","col",1,"px-3","py-3.5","text-left","text-sm","font-semibold","text-gray-900"],["scope","col",1,"relative","py-3.5","pl-3","pr-4","sm:pr-6"],[1,"sr-only"],[1,"divide-y","divide-gray-200","bg-white"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","relative z-10","aria-labelledby","modal-title","role","dialog","aria-modal","true",4,"ngIf"],[3,"value"],[1,"whitespace-nowrap","py-4","pl-4","pr-3","text-sm","font-medium","text-gray-900","sm:pl-6"],[1,"whitespace-nowrap","px-3","py-4","text-sm","text-gray-500"],[1,"relative","whitespace-nowrap","py-4","pl-3","pr-4","text-right","text-sm","font-medium","sm:pr-6"],[1,"text-blue-600","hover:text-blue-900","mr-4","inline-flex","items-center","gap-1","transition-colors",3,"click"],[1,"text-red-600","hover:text-red-900","inline-flex","items-center","gap-1","transition-colors",3,"click"],["colspan","5",1,"px-6","py-10","text-center","text-sm","text-gray-500"],[1,"flex","flex-col","items-center","justify-center"],[1,"h-10","w-10","text-gray-300","mb-2",3,"img"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"relative","z-10"],[1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity"],[1,"fixed","inset-0","z-10","overflow-y-auto"],[1,"flex","min-h-full","items-end","justify-center","p-4","text-center","sm:items-center","sm:p-0"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","px-4","pt-5","pb-4","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg","sm:p-6"],[1,"absolute","top-0","right-0","hidden","pt-4","pr-4","sm:block"],["type","button",1,"rounded-md","bg-white","text-gray-400","hover:text-gray-500","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"click"],[1,"h-6","w-6",3,"img"],[1,"sm:flex","sm:items-start","w-full"],[1,"mt-3","text-center","sm:mt-0","sm:ml-4","sm:text-left","w-full"],["id","modal-title",1,"text-lg","font-medium","leading-6","text-gray-900"],[1,"mt-4","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","text-left","mb-1"],[3,"selectionChanged","disabled"],[1,"block","text-sm","font-medium","text-gray-700","text-left"],[1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","pl-3","pr-10","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border","disabled:bg-gray-100","disabled:text-gray-500",3,"ngModelChange","ngModel","disabled"],["value","","disabled","","selected",""],[1,"grid","grid-cols-2","gap-4"],["type","number","min","0",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","px-3","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border",3,"ngModelChange","ngModel"],["type","number","step","5","min","5",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","px-3","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border",3,"ngModelChange","ngModel"],[1,"mt-5","sm:mt-4","sm:flex","sm:flex-row-reverse"],["type","button",1,"inline-flex","w-full","justify-center","rounded-md","border","border-transparent","bg-blue-600","px-4","py-2","text-base","font-medium","text-white","shadow-sm","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","sm:ml-3","sm:w-auto","sm:text-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","border","border-gray-300","bg-white","px-4","py-2","text-base","font-medium","text-gray-700","shadow-sm","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","sm:mt-0","sm:w-auto","sm:text-sm",3,"click"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),l(4,"Asignaci\xF3n de especialidades"),n(),i(5,"p",4),l(6,"Gestiona las especialidades asignadas a cada m\xE9dico, sus costos y duraciones."),n()(),i(7,"div",5)(8,"button",6),p("click",function(){return o.openAddModal()}),b(9,"lucide-icon",7),l(10," Nueva asignaci\xF3n "),n()()(),i(11,"div",8)(12,"div",9)(13,"div",10),b(14,"lucide-icon",11),n(),i(15,"input",12),p("ngModelChange",function(s){return o.searchTerm.set(s)}),n()(),i(16,"div")(17,"select",13),p("ngModelChange",function(s){return o.filterDoctorId.set(s)}),i(18,"option",14),l(19,"Todos los especialistas"),n(),x(20,me,2,2,"option",15),n()(),i(21,"div")(22,"select",13),p("ngModelChange",function(s){return o.filterSpecialtyId.set(s)}),i(23,"option",14),l(24,"Todas las especialidades"),n(),x(25,pe,2,2,"option",15),n()()(),i(26,"div",16)(27,"div",17)(28,"div",18)(29,"div",19)(30,"table",20)(31,"thead",21)(32,"tr")(33,"th",22),l(34," Especialidad"),n(),i(35,"th",23),l(36," Especialista"),n(),i(37,"th",23),l(38,"Costo "),n(),i(39,"th",23),l(40," Duraci\xF3n"),n(),i(41,"th",24)(42,"span",25),l(43,"Acciones"),n()()()(),i(44,"tbody",26),x(45,ue,18,6,"tr",27)(46,ge,6,1,"tr",28),n()()()()()()(),x(47,ye,40,9,"div",29)),e&2&&(a(9),d("img",o.icons.Plus),a(5),d("img",o.icons.Search),a(),d("ngModel",o.searchTerm()),a(2),d("ngModel",o.filterDoctorId()),a(3),d("ngForOf",o.formattedDoctors()),a(2),d("ngModel",o.filterSpecialtyId()),a(3),d("ngForOf",o.specialties()),a(20),d("ngForOf",o.filteredAssociations()),a(),d("ngIf",o.filteredAssociations().length===0),a(),d("ngIf",o.isModalOpen()))},dependencies:[L,A,O,ee,U,Y,X,J,K,R,Z,H,q,Q,D],encapsulation:2})};export{ne as DoctorSpecialtyComponent};
