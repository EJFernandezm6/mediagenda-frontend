import{a as p}from"./chunk-MZ3EZVY4.js";import{L as U,N as s,R as g,W as d,a as l,b as n,ia as f,r as h,xc as c,yc as m}from"./chunk-4MKEYT5G.js";var u=class o{http=d(m);apiUrl=`${p.apiUrl}/iam/users`;users=f([]);_currentRole="";constructor(){this.refreshUsers()}refreshUsers(e){e!==void 0&&(this._currentRole=e);let t=new c;this._currentRole&&(t=t.set("role",this._currentRole)),this.http.get(this.apiUrl,{params:t}).pipe(s(r=>console.log("Raw users data:",r)),h(r=>r.map(i=>n(l({},i),{id:i.userId||i.id,fullName:i.fullName||i.name})))).subscribe({next:r=>this.users.set(r),error:r=>console.error("Error fetching users:",r)})}getUsers(){return this.users()}rolesUrl=`${p.apiUrl}/iam/roles`;getRoles(){return this.http.get(this.rolesUrl)}addUser(e){if(e.roleIds?.length){let t={fullName:e.fullName,email:e.email,password:e.password,roleIds:e.roleIds,phone:e.phone||"",photoUrl:e.photoUrl||""};return this.http.post(this.apiUrl,t).pipe(s(()=>this.refreshUsers()))}return this.getRoles().pipe(U(t=>{let r=e.roles.includes("ADMIN")?"ADMIN":e.roles[0],i=t.find(a=>a.roleKey===r||a.name.toUpperCase()===r);if(!i)throw new Error(`Role ${r} not found`);let w={fullName:e.fullName,email:e.email,password:e.password,roleIds:[i.roleId],phone:e.phone||"",photoUrl:e.photoUrl||""};return this.http.post(this.apiUrl,w)}),s(()=>this.refreshUsers()))}updateUser(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(s(()=>this.refreshUsers()))}deleteUser(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(s(()=>this.refreshUsers()))}toggleAdminRole(e){return this.http.post(`${this.apiUrl}/${e}/toggle-admin`,{}).pipe(s(()=>this.refreshUsers()))}toggleSpecialistRole(e){return this.http.post(`${this.apiUrl}/${e}/toggle-specialist`,{}).pipe(s(()=>this.refreshUsers()))}toggleUserActive(e){return this.http.post(`${this.apiUrl}/${e}/toggle-active`,{}).pipe(s(()=>this.refreshUsers()))}updateProfile(e){return this.http.put(`${this.apiUrl}/profile`,e).pipe(s(()=>this.refreshUsers()))}changePassword(e){return this.http.put(`${this.apiUrl}/change-password`,e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"})};export{u as a};
