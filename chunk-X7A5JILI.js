import{e as c}from"./chunk-FV7MBGCK.js";import{a as g}from"./chunk-MZ3EZVY4.js";import{N as o,R as a,W as s,ia as n,xc as l}from"./chunk-2ZD6ZATD.js";var u=class i{http=s(l);router=s(c);apiUrl=`${g.apiUrl}/iam/auth`;currentUser=n(null);constructor(){this.restoreSession()}login(r){return this.http.post(`${this.apiUrl}/login`,r).pipe(o(t=>{let e={id:t.userId,fullName:t.fullName||"",email:t.email,roles:[],photoUrl:`https://ui-avatars.com/api/?name=${t.email}&background=0D8ABC&color=fff`,subscriptionStatus:"ACTIVE",clinicId:t.clinicId,roleId:t.roleId,active:t.active!==void 0?t.active:!0};if(e.active===!1)throw{status:403,message:"Usuario inactivo. Contacte al administrador."};this.currentUser.set(e),localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(e)),this.router.navigate(["/app/dashboard"])}))}forgotPassword(r){return this.http.post(`${this.apiUrl}/forgot-password`,{email:r})}validateCode(r,t){return this.http.post(`${this.apiUrl}/validate-code`,{email:r,code:t})}resetPassword(r,t,e){return this.http.post(`${this.apiUrl}/reset-password`,{email:r,code:t,newPassword:e})}logout(){this.currentUser.set(null),localStorage.removeItem("user"),localStorage.removeItem("token"),this.router.navigate(["/auth/login"])}restoreSession(){let r=localStorage.getItem("user"),t=localStorage.getItem("token");r&&t&&this.currentUser.set(JSON.parse(r))}static \u0275fac=function(t){return new(t||i)};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};export{u as a};
