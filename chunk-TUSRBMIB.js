import{a as te}from"./chunk-NEK3TQOF.js";import{a as Q}from"./chunk-5RN7LDLI.js";import{a as ee}from"./chunk-O7YG2JPL.js";import{a as Z}from"./chunk-4KN2LUD3.js";import{a as U}from"./chunk-VAGHVR4A.js";import{a as L}from"./chunk-NWFZENZL.js";import{b as B,d as q,g as z,l as G,m as J,n as Y,u as K}from"./chunk-IRX75LVQ.js";import{a as X}from"./chunk-BEGM3RB5.js";import"./chunk-MZ3EZVY4.js";import{$ as M,Ab as v,Ba as s,Bb as D,Ed as P,Md as $,Nd as A,Qb as I,Ra as N,Va as b,W as g,Wc as j,aa as F,ab as d,bb as n,cb as o,db as T,hb as k,hc as R,ia as E,ib as f,ic as O,jb as S,pc as W,ub as a,ud as H,vb as _,wb as h,xb as V,zb as x}from"./chunk-4QQE477L.js";function ne(c,t){if(c&1&&(n(0,"option",40),a(1),o()),c&2){let i=t.$implicit;d("value",i.specialtyId),s(),h(" ",i.name," ")}}function oe(c,t){if(c&1&&(n(0,"option",40),a(1),o()),c&2){let i=t.$implicit;d("value",i),s(),_(i)}}function re(c,t){if(c&1&&(n(0,"span",41),a(1),o()),c&2){let i=S();s(),h(" ",i.currentSchedules().length," turnos asignados ")}}function ae(c,t){if(c&1&&(n(0,"tr")(1,"td",42)(2,"div",43)(3,"div",44),T(4,"lucide-icon",45),o(),n(5,"p",46),a(6,"No hay turnos programados para hoy"),o(),n(7,"p",47),a(8),o()()()()),c&2){let i=S();s(4),d("img",i.icons.Clock),s(4),h(" ",i.selectedDoctorId()?"Este especialista no tiene turnos asignados en las fechas futuras.":"Selecciona un especialista en el formulario superior para comenzar."," ")}}function le(c,t){if(c&1){let i=k();n(0,"tr",48)(1,"td",49)(2,"div",50)(3,"span",51),a(4),o(),n(5,"span",52),a(6),o()()(),n(7,"td",49)(8,"div",53),a(9),o()(),n(10,"td",49)(11,"div",54),a(12),o()(),n(13,"td",49)(14,"div",55),a(15),o()(),n(16,"td",56)(17,"button",57),f("click",function(){let l=M(i).$implicit,r=S();return F(r.remove(l))}),T(18,"lucide-icon",58),o()()()}if(c&2){let i=t.$implicit,e=S();s(4),_(e.selectedDoctorName()),s(2),h(" ",e.getSpecialtyName(i.specialtyId)," "),s(3),h(" ",e.getScheduleDisplay(i)," "),s(3),V(" ",e.formatTimeDisplay(i.startTime)," - ",e.formatTimeDisplay(i.endTime)," "),s(3),_(e.calculateDuration(i)),s(3),d("img",e.icons.Trash2)}}var ie=class c{scheduleService=g(te);doctorService=g(X);specialtyService=g(U);associationService=g(Z);confirmService=g(L);configService=g(Q);icons={Clock:j,Plus:H,Trash2:P};selectedDoctorId=E("");currentSchedules=I(()=>{let t=this.selectedDoctorId();if(!t)return[];let i=this.scheduleService.schedules(),e=new Date().toISOString().split("T")[0];return i.filter(l=>l.doctorId===t).filter(l=>l.date>=e).sort((l,r)=>l.date!==r.date?l.date.localeCompare(r.date):l.startTime.localeCompare(r.startTime))});formatTimeDisplay(t){return t?t.substring(0,5):""}formData={date:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"",specialtyId:"",weeksToRepeat:0};viewMode="list";get availableSpecialtiesForDoctor(){let t=this.selectedDoctorId();return t?this.associationService.getSpecialtiesForDoctor(t).map(e=>this.specialtyService.specialties().find(l=>l.specialtyId===e.specialtyId)).filter(e=>!!e):[]}getDayName(t){return[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Mi\xE9rcoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"S\xE1bado"},{id:0,name:"Domingo"}].find(e=>e.id===t)?.name||"Desconocido"}getSpecialtyName(t){return this.specialtyService.specialties().find(i=>i.specialtyId===t)?.name||""}selectedDoctorName=I(()=>{let t=this.selectedDoctorId();if(!t)return"";let i=this.doctorService.doctors().find(e=>e.id===t||e.doctorId===t);return i?i.fullName:"Especialista"});minDate=new Date().toISOString().split("T")[0];onDateChange(t){}getScheduleDisplay(t){if(t.date){let[i,e,l]=t.date.split("-").map(Number),r=new Date(i,e-1,l);return`${this.getDayName(r.getDay())} ${l}/${e}/${i}`}return"Fecha no v\xE1lida"}calculateDuration(t){if(!t.startTime||!t.endTime)return"-";let i=this.dateFromTime(t.startTime),l=this.dateFromTime(t.endTime).getTime()-i.getTime();if(l<=0)return"-";let r=Math.floor(l/6e4),p=Math.floor(r/60),m=r%60;return p>0&&m>0?`${p}h ${m}m`:p>0?`${p}h`:`${m}m`}validEndTimes=E([]);updateValidEndTimes(){let t=this.selectedDoctorId(),i=this.formData.specialtyId,e=this.formData.startTime;if(!t||!i||!e){this.validEndTimes.set([]);return}let r=this.associationService.associations().find(C=>C.doctorId===t&&C.specialtyId===i)?.durationMinutes||30,p=[],m=this.dateFromTime(e),w=this.configService.settings().clinicCloseTime||"20:00",y=this.dateFromTime(w);for(m.setMinutes(m.getMinutes()+r);m<=y;)p.push(this.timeFromDate(m)),m.setMinutes(m.getMinutes()+r);this.validEndTimes.set(p),p.includes(this.formData.endTime)||(this.formData.endTime=p[0])}dateFromTime(t){let[i,e]=t.split(":").map(Number),l=new Date;return l.setHours(i,e,0,0),l}timeFromDate(t){return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}onStartTimeChange(){this.updateValidEndTimes()}onSpecialtyChange(t){this.formData.specialtyId=t,this.updateValidEndTimes()}onDoctorSelectionChange(t){if(this.selectedDoctorId.set(t),t){let i=this.availableSpecialtiesForDoctor;this.formData.specialtyId=i.length>0?i[0].specialtyId:"",this.updateValidEndTimes()}else this.formData.specialtyId="",this.validEndTimes.set([])}saveSchedule(){let t=this.selectedDoctorId();if(t&&this.formData.specialtyId&&this.formData.endTime){let i=u=>u.length===5?`${u}:00`:u,e=[],[l,r,p]=this.formData.date.split("-").map(Number),m=new Date(l,r-1,p,12,0,0),w=1+this.formData.weeksToRepeat;for(let u=0;u<w;u++){let y=new Date(m);y.setDate(m.getDate()+u*7);let C=[y.getFullYear(),(y.getMonth()+1).toString().padStart(2,"0"),y.getDate().toString().padStart(2,"0")].join("-");e.push({specialtyId:this.formData.specialtyId,date:C,startTime:i(this.formData.startTime),endTime:i(this.formData.endTime)})}this.scheduleService.addSchedule(t,e).subscribe({next:()=>{this.scheduleService.refreshSchedules({doctorId:t}),this.formData.startTime="09:00",this.formData.endTime="",this.formData.weeksToRepeat=0,this.updateValidEndTimes()},error:u=>{console.error("Error saving schedule",u),alert("Error al guardar el turno. Verifique los datos.")}})}}async remove(t){await this.confirmService.confirm({title:"Eliminar Turno",message:"\xBFEst\xE1s seguro de que deseas eliminar este turno de atenci\xF3n?",confirmText:"Eliminar",cancelText:"Cancelar"})&&t.id&&this.scheduleService.removeSchedule(t.id,t.doctorId).subscribe({error:e=>console.error("Error deleting schedule",e)})}static \u0275fac=function(i){return new(i||c)};static \u0275cmp=N({type:c,selectors:[["app-schedule-config"]],decls:76,vars:23,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8","bg-gray-50","min-h-screen"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"bg-white","shadow-sm","rounded-xl","border","border-gray-200","overflow-hidden"],[1,"p-6","border-b","border-gray-200","bg-white"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"flex","flex-col","xl:flex-row","gap-4","items-end"],[1,"w-full","xl:w-1/4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"selectionChanged"],[1,"block","w-full","pl-3","pr-10","py-2.5","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-lg","border","disabled:bg-gray-100","disabled:text-gray-400",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"w-full","xl:w-[15%]"],["type","date",1,"block","w-full","border","border-gray-300","rounded-lg","shadow-sm","py-2.5","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","disabled:bg-gray-100","disabled:text-gray-400",3,"ngModelChange","ngModel","min","disabled"],[1,"w-full","xl:w-1/4","flex","items-end","gap-2"],[1,"w-1/2"],["type","time",1,"block","w-full","border","border-gray-300","rounded-lg","shadow-sm","py-2.5","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","disabled:bg-gray-100","disabled:text-gray-400",3,"ngModelChange","ngModel","disabled"],[1,"text-gray-500","mb-2.5"],[1,"block","w-full","pl-3","pr-8","py-2.5","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-lg","border","bg-white","disabled:bg-gray-100","disabled:text-gray-400",3,"ngModelChange","ngModel","disabled"],[1,"w-full","xl:w-auto","mt-4","xl:mt-0"],[1,"w-full","xl:w-auto","inline-flex","items-center","justify-center","px-6","py-2.5","border","border-transparent","text-sm","font-medium","rounded-lg","shadow-sm","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","duration-200",3,"click","disabled"],[1,"w-4","h-4","mr-2",3,"img"],[1,"mt-4","flex","items-center","justify-end","gap-2","pr-2"],[1,"text-sm","font-medium","text-gray-600"],[1,"block","text-sm","border-gray-300","border","rounded-md","py-1","pl-2","pr-8","focus:ring-blue-500","focus:border-blue-500","disabled:bg-gray-100","disabled:text-gray-400",3,"ngModelChange","ngModel","disabled"],[3,"ngValue"],[1,"bg-white"],[1,"px-6","py-4","border-b","border-gray-200","bg-gray-50","flex","justify-between","items-center"],[1,"text-lg","font-medium","text-gray-900"],["class","text-sm py-1 px-3 bg-blue-100 text-blue-700 rounded-full font-medium",4,"ngIf"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],["scope","col",1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[4,"ngIf"],["class","hover:bg-gray-50 outline-none focus-within:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[3,"value"],[1,"text-sm","py-1","px-3","bg-blue-100","text-blue-700","rounded-full","font-medium"],["colspan","5",1,"px-6","py-12","text-center"],[1,"flex","flex-col","items-center","justify-center"],[1,"bg-gray-100","p-4","rounded-full","mb-4"],[1,"w-8","h-8","text-gray-400",3,"img"],[1,"text-gray-900","font-medium","text-lg"],[1,"text-gray-500","text-sm","mt-1","max-w-sm","mx-auto"],[1,"hover:bg-gray-50","outline-none","focus-within:bg-gray-50","transition-colors"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex","flex-col"],[1,"text-sm","font-medium","text-gray-900"],[1,"inline-flex","items-center","mt-1.5","px-2.5","py-0.5","rounded","text-xs","font-medium","bg-blue-50","border","border-blue-200","text-blue-700","w-fit"],[1,"text-sm","text-gray-900","font-medium","flex","items-center"],[1,"text-sm","text-gray-900","bg-gray-100","px-3","py-1","rounded-md","inline-block","font-medium"],[1,"text-sm","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["title","Eliminar turno",1,"text-red-500","hover:text-red-700","bg-red-50","hover:bg-red-100","p-2","rounded-lg","transition-colors","inline-flex","items-center",3,"click"],[1,"w-4","h-4",3,"img"]],template:function(i,e){i&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),a(3,"Gesti\xF3n de Turnos y Horarios"),o(),n(4,"p",3),a(5,"Define los d\xEDas y horas de atenci\xF3n por especialista y especialidad."),o()(),n(6,"div",4)(7,"div",5)(8,"h2",6),a(9,"Registrar Nuevo Turno"),o(),n(10,"div",7)(11,"div",8)(12,"label",9),a(13,"Especialista"),o(),n(14,"app-doctor-selector",10),f("selectionChanged",function(r){return e.onDoctorSelectionChange(r)}),o()(),n(15,"div",8)(16,"label",9),a(17,"Especialidad"),o(),n(18,"select",11),f("ngModelChange",function(r){return e.onSpecialtyChange(r)}),n(19,"option",12),a(20,"Seleccione especialidad..."),o(),b(21,ne,2,2,"option",13),o()(),n(22,"div",14)(23,"label",9),a(24,"Fecha de atenci\xF3n"),o(),n(25,"input",15),D("ngModelChange",function(r){return v(e.formData.date,r)||(e.formData.date=r),r}),f("ngModelChange",function(r){return e.onDateChange(r)}),o()(),n(26,"div",16)(27,"div",17)(28,"label",9),a(29,"Desde"),o(),n(30,"input",18),D("ngModelChange",function(r){return v(e.formData.startTime,r)||(e.formData.startTime=r),r}),f("ngModelChange",function(){return e.onStartTimeChange()}),o()(),n(31,"span",19),a(32,"-"),o(),n(33,"div",17)(34,"label",9),a(35,"Hasta"),o(),n(36,"select",20),D("ngModelChange",function(r){return v(e.formData.endTime,r)||(e.formData.endTime=r),r}),b(37,oe,2,2,"option",13),o()()(),n(38,"div",21)(39,"button",22),f("click",function(){return e.saveSchedule()}),T(40,"lucide-icon",23),a(41," Asignar Turno "),o()()(),n(42,"div",24)(43,"label",25),a(44,"Repetir asignaci\xF3n:"),o(),n(45,"select",26),D("ngModelChange",function(r){return v(e.formData.weeksToRepeat,r)||(e.formData.weeksToRepeat=r),r}),n(46,"option",27),a(47,"Solo esta fecha"),o(),n(48,"option",27),a(49,"Repetir por 1 mes"),o(),n(50,"option",27),a(51,"Repetir por 2 meses"),o(),n(52,"option",27),a(53,"Repetir por 3 meses"),o()()()(),n(54,"div",28)(55,"div",29)(56,"h3",30),a(57),o(),b(58,re,2,1,"span",31),o(),n(59,"div",32)(60,"table",33)(61,"thead",34)(62,"tr")(63,"th",35),a(64," Especialista"),o(),n(65,"th",35),a(66," Fecha"),o(),n(67,"th",35),a(68," Rango Horario"),o(),n(69,"th",35),a(70," Duraci\xF3n"),o(),n(71,"th",36),a(72," Acciones"),o()()(),n(73,"tbody",37),b(74,ae,9,2,"tr",38)(75,le,19,7,"tr",39),o()()()()()()),i&2&&(s(18),d("ngModel",e.formData.specialtyId)("disabled",!e.selectedDoctorId()),s(3),d("ngForOf",e.availableSpecialtiesForDoctor),s(4),x("ngModel",e.formData.date),d("min",e.minDate)("disabled",!e.selectedDoctorId()),s(5),x("ngModel",e.formData.startTime),d("disabled",!e.selectedDoctorId()),s(6),x("ngModel",e.formData.endTime),d("disabled",!e.selectedDoctorId()),s(),d("ngForOf",e.validEndTimes()),s(2),d("disabled",!e.selectedDoctorId()||!e.formData.specialtyId||!e.formData.endTime),s(),d("img",e.icons.Plus),s(5),x("ngModel",e.formData.weeksToRepeat),d("disabled",!e.selectedDoctorId()),s(),d("ngValue",0),s(2),d("ngValue",4),s(2),d("ngValue",8),s(2),d("ngValue",12),s(5),h(" ",e.selectedDoctorName()?"Horarios Registrados - "+e.selectedDoctorName():"Horarios Registrados"," "),s(),d("ngIf",e.selectedDoctorId()&&e.currentSchedules().length>0),s(16),d("ngIf",!e.selectedDoctorId()||e.currentSchedules().length===0),s(),d("ngForOf",e.currentSchedules()))},dependencies:[W,R,O,K,J,Y,B,G,q,z,A,$,ee],encapsulation:2})};export{ie as ScheduleConfigComponent};
