import{a as ce}from"./chunk-QJJBKZNG.js";import{a as se}from"./chunk-YW4BXQUT.js";import{b as te,c as ie,d as ne,f as oe,g as ae,h as re,j as le}from"./chunk-6UD4ND2X.js";import{a as ee}from"./chunk-HFOEO2QN.js";import{a as de}from"./chunk-ZSN2DVST.js";import{a as pe}from"./chunk-XQGVBZLD.js";import{Bb as L,Cb as R,Db as j,Eb as $,Fa as V,Fb as H,Gb as W,Ja as b,N,Pa as s,Qa as t,Ra as i,Rb as B,S as E,Sa as x,Ta as P,Tb as U,Ua as F,Ub as G,Va as v,Vb as Y,Wa as m,Wb as z,X as u,Xa as c,Xb as q,Y as g,a as D,b as M,bb as _,cb as d,db as h,ea as f,eb as y,fb as k,gb as O,ic as J,kc as K,pc as Q,qb as I,sa as o,sc as X,tc as Z}from"./chunk-7HZYIYZF.js";var T=class l{mockAppointments=[{id:"a1",doctorId:"d1",specialtyId:"1",patientId:"p1",patientName:"Ana Garc\xEDa",date:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"09:30",status:"CONFIRMED",notes:"Consulta rutinaria",paymentMethod:"YAPE",paymentStatus:"PAID",transactionId:"123456"},{id:"a2",doctorId:"d1",specialtyId:"1",patientId:"p2",patientName:"Luis Torres",date:new Date().toISOString().split("T")[0],startTime:"10:00",endTime:"10:30",status:"CONFIRMED"}];appointments=f(this.mockAppointments);getAppointments(){return this.appointments()}getAppointmentsForDateRange(a,e,r){return this.appointments().filter(n=>n.date>=a&&n.date<=e&&n.doctorId===r)}addAppointment(a){let e=M(D({},a),{id:Math.random().toString(36).substr(2,9),status:"SCHEDULED"});this.appointments.update(r=>[...r,e])}updatestatus(a,e){this.appointments.update(r=>r.map(n=>n.id===a?M(D({},n),{status:e}):n))}cancelAppointment(a){this.updatestatus(a,"CANCELLED")}static \u0275fac=function(e){return new(e||l)};static \u0275prov=N({token:l,factory:l.\u0275fac,providedIn:"root"})};function ge(l,a){if(l&1){let e=v();t(0,"tr",29)(1,"td",30)(2,"div",31),x(3,"lucide-icon",32),t(4,"span",33),d(5),i()()(),t(6,"td",30)(7,"span",34),d(8),i()(),t(9,"td",35),d(10),i(),t(11,"td",30)(12,"span"),d(13),i()(),t(14,"td",36)(15,"button",37),m("click",function(){let n=u(e).$implicit,p=c(2);return g(p.openAppointmentDetails(n))}),d(16," Ver Detalles "),i()()()}if(l&2){let e=a.$implicit,r=c(2);o(3),s("img",r.icons.Clock),o(2),k("",e.startTime," - ",e.endTime),o(3),h(e.patientName),o(2),y(" ",r.getDoctorName(e.doctorId)," "),o(2),_("px-2 py-1 rounded-full text-[10px] font-bold "+(e.status==="CONFIRMED"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700")),o(),y(" ",e.status," ")}}function xe(l,a){if(l&1&&(t(0,"tr")(1,"td",38),x(2,"lucide-icon",39),t(3,"p"),d(4,"No hay citas programadas para hoy."),i()()()),l&2){let e=c(2);o(2),s("img",e.icons.AlertCircle)}}function be(l,a){if(l&1&&(t(0,"div",14)(1,"div",15)(2,"div")(3,"h2",16),d(4,"Vista General del D\xEDa"),i(),t(5,"p",17),d(6,"Visualizando todas las citas programadas para hoy across todos los m\xE9dicos."),i()(),t(7,"div",18),x(8,"lucide-icon",19),t(9,"span",20),d(10),i()()(),t(11,"div",21)(12,"table",22)(13,"thead",23)(14,"tr")(15,"th",24),d(16,"Hora"),i(),t(17,"th",24),d(18,"Paciente"),i(),t(19,"th",24),d(20,"M\xE9dico"),i(),t(21,"th",24),d(22,"Estado"),i(),t(23,"th",25),d(24,"Acci\xF3n"),i()()(),t(25,"tbody",26),b(26,ge,17,8,"tr",27)(27,xe,5,1,"tr",28),i()()()()),l&2){let e=c();o(8),s("img",e.icons.Calendar),o(2),h(e.currentDateStr()),o(16),s("ngForOf",e.globalAppointments()),o(),s("ngIf",e.globalAppointments().length===0)}}function _e(l,a){if(l&1&&(t(0,"div",45)(1,"p",46),d(2),i(),t(3,"p",47),d(4),i()()),l&2){let e=a.$implicit;o(2),h(e.dayName),o(2),h(e.dayNum)}}function fe(l,a){if(l&1){let e=v();t(0,"button",56),m("click",function(){u(e);let n=c().$implicit,p=c().$implicit,C=c(2);return g(C.openBookingModal(n.iso,p))}),x(1,"lucide-icon",6),i()}if(l&2){let e=c(4);o(),s("img",e.icons.Plus)}}function ve(l,a){if(l&1&&(t(0,"div",57)(1,"p",58),d(2),i(),t(3,"p",59),d(4),i()()),l&2){let e,r,n=c().$implicit,p=c().$implicit,C=c(2);o(2),h((e=C.getAppointment(n.iso,p))==null?null:e.patientName),o(2),h((r=C.getAppointment(n.iso,p))==null?null:r.status)}}function he(l,a){l&1&&x(0,"div",60)}function ye(l,a){if(l&1&&(t(0,"div",51),P(1,52),b(2,fe,2,1,"button",53)(3,ve,5,2,"div",54)(4,he,1,0,"div",55),F(),i()),l&2){let e=a.$implicit,r=a.index,n=c().$implicit,p=c(2);o(),s("ngSwitch",p.getSlotStatus(e.iso,n,r)),o(),s("ngSwitchCase","available"),o(),s("ngSwitchCase","booked")}}function Ce(l,a){if(l&1&&(t(0,"div",48)(1,"div",49),d(2),i(),b(3,ye,5,3,"div",50),i()),l&2){let e=a.$implicit,r=c(2);o(2),y(" ",e," "),o(),s("ngForOf",r.weekDays())}}function Se(l,a){if(l&1&&(t(0,"div",40)(1,"div",41)(2,"div",42),d(3," Hora"),i(),b(4,_e,5,2,"div",43),i(),b(5,Ce,4,2,"div",44),i()),l&2){let e=c();o(4),s("ngForOf",e.weekDays()),o(),s("ngForOf",e.timeSlots)}}function we(l,a){if(l&1&&(t(0,"option",96),d(1),i()),l&2){let e=a.$implicit;s("value",e.id),o(),h(e.name)}}function Ae(l,a){if(l&1&&(t(0,"option",96),d(1),i()),l&2){let e=a.$implicit;s("value",e.id),o(),y("",e.fullName," ")}}function Ee(l,a){if(l&1&&(t(0,"option",96),d(1),i()),l&2){let e=a.$implicit;s("value",e.id),o(),k("",e.fullName," (",e.dni,") ")}}function Ie(l,a){if(l&1){let e=v();t(0,"button",99),m("click",function(){let n=u(e).$implicit,p=c(3);return g(p.modalTime.set(n))}),d(1),i()}if(l&2){let e=a.$implicit,r=c(3);_("py-3 px-2 text-sm font-bold rounded-xl border-2 transition-all duration-200 "+(r.modalTime()===e?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200 scale-105":"bg-white border-gray-200 text-gray-700 hover:border-blue-400 hover:shadow-md hover:scale-102")),o(),y(" ",e," ")}}function De(l,a){if(l&1&&(t(0,"div",97),b(1,Ie,2,3,"button",98),i()),l&2){let e=c(2);o(),s("ngForOf",e.availableSlotsForModal())}}function Me(l,a){if(l&1&&(t(0,"div",100),x(1,"lucide-icon",101),t(2,"p",102),d(3,"Selecciona m\xE9dico y fecha para ver disponibilidad "),i()()),l&2){let e=c(2);o(),s("img",e.icons.Clock)}}function ke(l,a){if(l&1){let e=v();t(0,"div",61)(1,"div",62)(2,"div",63)(3,"div",64)(4,"div")(5,"h2",65),d(6,"Agendar Nueva Cita"),i(),t(7,"p",66),d(8,"Selecciona los detalles de tu consulta"),i()(),t(9,"button",67),m("click",function(){u(e);let n=c();return g(n.closeModal())}),x(10,"lucide-icon",68),i()()(),t(11,"div",69)(12,"div",70)(13,"div",71)(14,"div")(15,"h3",72),d(16,"Detalles de la Cita"),i(),t(17,"p",73),d(18,"Selecciona los detalles de tu consulta"),i()(),t(19,"div")(20,"label",74),d(21," Especialidad "),i(),t(22,"select",75),m("ngModelChange",function(n){u(e);let p=c();return p.modalSpecialtyId.set(n),g(p.modalDoctorId.set(""))}),t(23,"option",76),d(24,"Seleccionar Especialidad"),i(),b(25,we,2,2,"option",77),i()(),t(26,"div")(27,"label",74),d(28," M\xE9dico "),i(),t(29,"select",78),m("ngModelChange",function(n){u(e);let p=c();return g(p.modalDoctorId.set(n))}),t(30,"option",76),d(31,"Seleccionar M\xE9dico"),i(),b(32,Ae,2,2,"option",77),i()(),t(33,"div")(34,"label",74),d(35," Fecha "),i(),t(36,"input",79),m("ngModelChange",function(n){u(e);let p=c();return g(p.modalDate.set(n))}),i()(),t(37,"div")(38,"label",74),d(39," Seleccionar Paciente "),i(),t(40,"select",75),m("ngModelChange",function(n){u(e);let p=c();return g(p.modalPatientId.set(n))}),t(41,"option",76),d(42,"Seleccionar Paciente"),i(),b(43,Ee,2,3,"option",77),i()()(),t(44,"div",80)(45,"h3",81),d(46," Horarios Disponibles "),i(),t(47,"p",82),d(48,"Elige una hora disponible"),i(),b(49,De,2,1,"div",83)(50,Me,4,1,"div",84),i()(),t(51,"div",85)(52,"h3",86),d(53,"M\xE9todo de Pago"),i(),t(54,"div",87)(55,"button",88),m("click",function(){u(e);let n=c();return g(n.modalPaymentMethod.set("CASH"))}),x(56,"lucide-icon",89),t(57,"span"),d(58," Efectivo "),i(),t(59,"span",90),d(60,"En cl\xEDnica"),i()(),t(61,"button",88),m("click",function(){u(e);let n=c();return g(n.modalPaymentMethod.set("YAPE"))}),x(62,"lucide-icon",89),t(63,"span"),d(64," Yape "),i()(),t(65,"button",88),m("click",function(){u(e);let n=c();return g(n.modalPaymentMethod.set("PLIN"))}),x(66,"lucide-icon",89),t(67,"span"),d(68," Plin "),i()(),t(69,"button",88),m("click",function(){u(e);let n=c();return g(n.modalPaymentMethod.set("CARD"))}),x(70,"lucide-icon",89),t(71,"span"),d(72," Tarjeta "),i()()(),t(73,"div")(74,"label",74),d(75," Notas Adicionales "),i(),t(76,"textarea",91),m("ngModelChange",function(n){u(e);let p=c();return g(p.modalNotes.set(n))}),i()()()(),t(77,"div",92)(78,"button",93),m("click",function(){u(e);let n=c();return g(n.closeModal())}),x(79,"lucide-icon",94),d(80," Cancelar "),i(),t(81,"button",95),m("click",function(){u(e);let n=c();return g(n.saveAppointment())}),x(82,"lucide-icon",6),d(83," Confirmar Cita "),i()()()()}if(l&2){let e=c();o(10),s("img",e.icons.AlertCircle),o(12),s("ngModel",e.modalSpecialtyId()),o(3),s("ngForOf",e.specialties()),o(4),s("ngModel",e.modalDoctorId())("disabled",!e.modalSpecialtyId()),o(3),s("ngForOf",e.filteredDoctorsForModal()),o(4),s("ngModel",e.modalDate()),o(4),s("ngModel",e.modalPatientId()),o(3),s("ngForOf",e.patients()),o(6),s("ngIf",e.availableSlotsForModal().length>0),o(),s("ngIf",e.availableSlotsForModal().length===0),o(5),_("relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all "+(e.modalPaymentMethod()==="CASH"?"border-blue-600 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-blue-300")),o(),_(e.modalPaymentMethod()==="CASH"?"text-blue-600":"text-gray-400"),s("img",e.icons.User),o(),_("text-xs font-bold "+(e.modalPaymentMethod()==="CASH"?"text-blue-600":"text-gray-600")),o(4),_("relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all "+(e.modalPaymentMethod()==="YAPE"?"border-blue-600 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-blue-300")),o(),_(e.modalPaymentMethod()==="YAPE"?"text-blue-600":"text-gray-400"),s("img",e.icons.User),o(),_("text-xs font-bold "+(e.modalPaymentMethod()==="YAPE"?"text-blue-600":"text-gray-600")),o(2),_("relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all "+(e.modalPaymentMethod()==="PLIN"?"border-blue-600 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-blue-300")),o(),_(e.modalPaymentMethod()==="PLIN"?"text-blue-600":"text-gray-400"),s("img",e.icons.User),o(),_("text-xs font-bold "+(e.modalPaymentMethod()==="PLIN"?"text-blue-600":"text-gray-600")),o(2),_("relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all "+(e.modalPaymentMethod()==="CARD"?"border-blue-600 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-blue-300")),o(),_(e.modalPaymentMethod()==="CARD"?"text-blue-600":"text-gray-400"),s("img",e.icons.User),o(),_("text-xs font-bold "+(e.modalPaymentMethod()==="CARD"?"text-blue-600":"text-gray-600")),o(5),s("ngModel",e.modalNotes()),o(3),s("img",e.icons.AlertCircle),o(2),s("disabled",!e.modalPatientId()||!e.modalTime()||!e.modalDoctorId()),o(),s("img",e.icons.CheckCircle)}}function Te(l,a){if(l&1&&(t(0,"div",116)(1,"label",114),d(2,"Notas"),i(),t(3,"p",117),d(4),i()()),l&2){let e=c(3);o(4),h(e.selectedAppointment.notes)}}function Ne(l,a){if(l&1&&(t(0,"div",69)(1,"div",109)(2,"div",110),x(3,"lucide-icon",111),t(4,"div")(5,"h3",47),d(6),i(),t(7,"p",112),d(8,"Paciente"),i()()()(),t(9,"div",113)(10,"div")(11,"label",114),d(12,"M\xE9dico"),i(),t(13,"p",33),d(14),i()(),t(15,"div")(16,"label",114),d(17,"Especialidad"),i(),t(18,"p",33),d(19),i()(),t(20,"div")(21,"label",114),d(22,"Fecha"),i(),t(23,"p",33),d(24),i()(),t(25,"div")(26,"label",114),d(27,"Horario"),i(),t(28,"p",33),d(29),i()(),t(30,"div")(31,"label",114),d(32,"Estado"),i(),t(33,"span"),d(34),i()(),t(35,"div")(36,"label",114),d(37,"M\xE9todo de Pago"),i(),t(38,"p",33),d(39),i()()(),b(40,Te,5,1,"div",115),i()),l&2){let e=c(2);o(3),s("img",e.icons.User),o(3),h(e.selectedAppointment.patientName),o(8),h(e.getDoctorName(e.selectedAppointment.doctorId)),o(5),y("",e.getSpecialtyName(e.selectedAppointment.specialtyId)," "),o(5),h(e.selectedAppointment.date),o(5),k("",e.selectedAppointment.startTime," - ",e.selectedAppointment.endTime),o(4),_("inline-block px-3 py-1 rounded-full text-xs font-bold "+(e.selectedAppointment.status==="CONFIRMED"?"bg-green-100 text-green-700":e.selectedAppointment.status==="COMPLETED"?"bg-blue-100 text-blue-700":e.selectedAppointment.status==="CANCELLED"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700")),o(),y(" ",e.selectedAppointment.status," "),o(5),h(e.selectedAppointment.paymentMethod||"N/A"),o(),s("ngIf",e.selectedAppointment.notes)}}function Ve(l,a){if(l&1&&(t(0,"option",96),d(1),i()),l&2){let e=a.$implicit;s("value",e.id),o(),y(" ",e.fullName," ")}}function Pe(l,a){if(l&1){let e=v();t(0,"button",99),m("click",function(){let n=u(e).$implicit,p=c(3);return g(p.modalTime.set(n))}),d(1),i()}if(l&2){let e=a.$implicit,r=c(3);_("py-2 px-2 text-sm font-bold rounded-lg border-2 transition-all "+(r.modalTime()===e?"bg-blue-600 border-blue-600 text-white":"bg-white border-gray-200 text-gray-700 hover:border-blue-400")),o(),y(" ",e," ")}}function Fe(l,a){if(l&1){let e=v();t(0,"div",69)(1,"div",71)(2,"div",118)(3,"p",119),d(4," Solo puedes cambiar el m\xE9dico y el horario para esta especialidad. "),i()(),t(5,"div",120)(6,"div")(7,"label",74),d(8,"Especialidad"),i(),t(9,"div",121),d(10),i()(),t(11,"div")(12,"label",74),d(13,"M\xE9dico"),i(),t(14,"select",122),m("ngModelChange",function(n){u(e);let p=c(2);return g(p.modalDoctorId.set(n))}),b(15,Ve,2,2,"option",77),i()()(),t(16,"div")(17,"label",74),d(18,"Nueva Fecha"),i(),t(19,"input",79),m("ngModelChange",function(n){u(e);let p=c(2);return g(p.modalDate.set(n))}),i()(),t(20,"div")(21,"label",74),d(22,"Nuevo Horario"),i(),t(23,"div",123),b(24,Pe,2,3,"button",98),i()()()()}if(l&2){let e=c(2);o(10),y(" ",e.getSpecialtyName(e.modalSpecialtyId())," "),o(4),s("ngModel",e.modalDoctorId()),o(),s("ngForOf",e.doctorsInCurrentSpecialty()),o(4),s("ngModel",e.modalDate()),o(5),s("ngForOf",e.availableSlotsForModal())}}function Oe(l,a){if(l&1){let e=v();t(0,"div",124)(1,"div",125),x(2,"lucide-icon",126),i(),t(3,"h3",127),d(4,"\xBFConfirmar Cancelaci\xF3n?"),i(),t(5,"p",128),d(6),i(),t(7,"div",129)(8,"button",130),m("click",function(){u(e);let n=c(2);return g(n.cancelCancelConfirmation())}),d(9," No, mantener cita "),i(),t(10,"button",131),m("click",function(){u(e);let n=c(2);return g(n.confirmCancel())}),d(11," S\xED, cancelar cita "),i()()()}if(l&2){let e=c(2);o(2),s("img",e.icons.AlertCircle),o(4),y(" \xBFEst\xE1s seguro de que deseas cancelar la cita de **",e.selectedAppointment==null?null:e.selectedAppointment.patientName,"**? Esta acci\xF3n no se puede deshacer. ")}}function Le(l,a){if(l&1){let e=v();t(0,"button",136),m("click",function(){u(e);let n=c(3);return g(n.showCancelConfirmation())}),x(1,"lucide-icon",6),d(2," Cancelar Cita "),i()}if(l&2){let e=c(3);o(),s("img",e.icons.AlertCircle)}}function Re(l,a){if(l&1){let e=v();t(0,"button",137),m("click",function(){u(e);let n=c(3);return g(n.startRescheduling())}),x(1,"lucide-icon",6),d(2," Reprogramar "),i()}if(l&2){let e=c(3);o(),s("img",e.icons.Calendar)}}function je(l,a){if(l&1){let e=v();t(0,"button",138),m("click",function(){u(e);let n=c(3);return g(n.saveRescheduledAppointment())}),x(1,"lucide-icon",6),d(2," Guardar Cambios "),i()}if(l&2){let e=c(3);s("disabled",!e.modalTime()||!e.modalDate()||!e.modalDoctorId()),o(),s("img",e.icons.CheckCircle)}}function $e(l,a){if(l&1){let e=v();t(0,"div",92)(1,"button",93),m("click",function(){u(e);let n=c(2);return g(n.closeDetailsModal())}),d(2," Cerrar "),i(),t(3,"div",132),b(4,Le,3,1,"button",133)(5,Re,3,1,"button",134)(6,je,3,2,"button",135),i()()}if(l&2){let e=c(2);o(4),s("ngIf",!e.isRescheduling&&(e.selectedAppointment==null?null:e.selectedAppointment.status)!=="CANCELLED"),o(),s("ngIf",!e.isRescheduling&&(e.selectedAppointment==null?null:e.selectedAppointment.status)!=="CANCELLED"),o(),s("ngIf",e.isRescheduling)}}function He(l,a){if(l&1){let e=v();t(0,"div",61)(1,"div",103)(2,"div",104)(3,"div",64)(4,"div")(5,"h2",65),d(6,"Detalles de la Cita"),i(),t(7,"p",105),d(8,"Informaci\xF3n completa de la consulta"),i()(),t(9,"button",67),m("click",function(){u(e);let n=c();return g(n.closeDetailsModal())}),x(10,"lucide-icon",68),i()()(),b(11,Ne,41,12,"div",106)(12,Fe,25,5,"div",106)(13,Oe,12,2,"div",107)(14,$e,7,3,"div",108),i()()}if(l&2){let e=c();o(10),s("img",e.icons.AlertCircle),o(),s("ngIf",e.selectedAppointment&&!e.isRescheduling&&!e.isConfirmingCancel),o(),s("ngIf",e.isRescheduling),o(),s("ngIf",e.isConfirmingCancel),o(),s("ngIf",!e.isConfirmingCancel)}}var me=class l{appointmentsService=E(T);doctorService=E(de);specialtyService=E(ee);scheduleService=E(ce);patientsService=E(pe);doctorSpecialtyService=E(se);icons={ChevronLeft:U,ChevronRight:G,Calendar:B,User:Q,Clock:q,Plus:J,Search:K,AlertCircle:Y,CheckCircle:z};doctors=this.doctorService.doctors;specialties=this.specialtyService.specialties;patients=this.patientsService.patients;appointments=this.appointmentsService.appointments;selectedDoctorId=f("");selectedSpecialtyId=f("");currentDate=f(new Date);currentDateStr=I(()=>this.currentDate().toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));isModalOpen=!1;selectedSlot=null;modalPatientId=f("");modalSpecialtyId=f("");modalDoctorId=f("");modalDate=f(new Date().toISOString().split("T")[0]);modalTime=f("");modalNotes=f("");modalPaymentMethod=f("CASH");modalTransactionId=f("");isDetailsModalOpen=!1;selectedAppointment=null;isRescheduling=!1;isConfirmingCancel=!1;doctorsInCurrentSpecialty=I(()=>{let a=this.isRescheduling?this.modalSpecialtyId():this.selectedSpecialtyId();if(!a)return this.doctors();let r=this.doctorSpecialtyService.associations().filter(n=>n.specialtyId===a).map(n=>n.doctorId);return this.doctors().filter(n=>r.includes(n.id))});globalAppointments=I(()=>{let a=this.currentDate().toISOString().split("T")[0];return this.appointments().filter(e=>e.date===a&&e.status!=="CANCELLED")});filteredDoctorsForModal=I(()=>{let a=this.modalSpecialtyId();if(!a)return[];let r=this.doctorSpecialtyService.associations().filter(n=>n.specialtyId===a).map(n=>n.doctorId);return this.doctors().filter(n=>r.includes(n.id))});availableSlotsForModal=I(()=>{let a=this.modalDoctorId(),e=this.modalSpecialtyId(),r=this.modalDate();if(!a||!e||!r)return[];let n=this.scheduleService.getSchedulesForDoctor(a,e),p=new Date(r).getUTCDay(),C=n.filter(w=>w.dayOfWeek===p);return this.timeSlots.filter(w=>C.some(A=>w>=A.startTime&&w<A.endTime)?!this.appointments().some(A=>A.doctorId===a&&A.date===r&&A.startTime===w&&A.status!=="CANCELLED"):!1)});weekDays=I(()=>{let a=this.getStartOfWeek(this.currentDate()),e=[];for(let r=0;r<7;r++){let n=new Date(a);n.setDate(a.getDate()+r),e.push({date:n,iso:n.toISOString().split("T")[0],dayName:n.toLocaleDateString("es-ES",{weekday:"short"}),dayNum:n.getDate()})}return e});timeSlots=Array.from({length:13},(a,e)=>`${(e+8).toString().padStart(2,"0")}:00`);getStartOfWeek(a){let e=new Date(a),r=e.getDay(),n=e.getDate()-r+(r===0?-6:1);return new Date(e.setDate(n))}changeWeek(a){let e=new Date(this.currentDate());e.setDate(e.getDate()+a*7),this.currentDate.set(e)}getSlotStatus(a,e,r){if(!this.selectedDoctorId()||!this.selectedSpecialtyId())return"unavailable";let n=new Date(a).getDay();return this.scheduleService.getSchedulesForDoctor(this.selectedDoctorId(),this.selectedSpecialtyId()).find(S=>S.dayOfWeek===n&&e>=S.startTime&&e<S.endTime)?this.appointments().find(S=>S.doctorId===this.selectedDoctorId()&&S.date===a&&S.startTime===e&&S.status!=="CANCELLED")?"booked":"available":"unavailable"}getAppointment(a,e){return this.appointments().find(r=>r.doctorId===this.selectedDoctorId()&&r.date===a&&r.startTime===e&&r.status!=="CANCELLED")}openBookingModal(a,e){this.selectedSlot={date:a,time:e},this.modalPatientId.set(""),this.modalSpecialtyId.set(this.selectedSpecialtyId()||""),this.modalDoctorId.set(this.selectedDoctorId()||""),this.modalDate.set(a),this.modalTime.set(e),this.modalNotes.set(""),this.modalPaymentMethod.set("CASH"),this.modalTransactionId.set(""),this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}saveAppointment(){let a=this.modalDoctorId(),e=this.modalSpecialtyId(),r=this.modalDate(),n=this.modalTime(),p=this.modalPatientId();if(a&&e&&r&&n&&p){let C=this.patients().find(w=>w.id===p);this.appointmentsService.addAppointment({doctorId:a,specialtyId:e,patientId:p,patientName:C?.fullName||"Desconocido",date:r,startTime:n,endTime:this.addMinutes(n,30),notes:this.modalNotes(),paymentMethod:this.modalPaymentMethod(),paymentStatus:this.modalPaymentMethod()==="CASH"?"PENDING":"PAID",transactionId:this.modalTransactionId()}),this.closeModal()}}addMinutes(a,e){let[r,n]=a.split(":").map(Number),p=new Date;return p.setHours(r,n+e),`${p.getHours().toString().padStart(2,"0")}:${p.getMinutes().toString().padStart(2,"0")}`}getDoctorName(a){return this.doctors().find(e=>e.id===a)?.fullName||"Desconocido"}getSpecialtyName(a){return this.specialties().find(e=>e.id===a)?.name||"Desconocido"}openGenericBooking(){let a=new Date().toISOString().split("T")[0],e=this.timeSlots.find(r=>this.getSlotStatus(a,r,0)==="available");e?this.openBookingModal(a,e):this.openBookingModal(a,this.timeSlots[0])}openAppointmentDetails(a){this.selectedAppointment=a,this.isDetailsModalOpen=!0,this.isRescheduling=!1}closeDetailsModal(){this.isDetailsModalOpen=!1,this.selectedAppointment=null,this.isRescheduling=!1,this.isConfirmingCancel=!1}startRescheduling(){this.selectedAppointment&&(this.isRescheduling=!0,this.isConfirmingCancel=!1,this.modalSpecialtyId.set(this.selectedAppointment.specialtyId),this.modalDoctorId.set(this.selectedAppointment.doctorId),this.modalDate.set(this.selectedAppointment.date),this.modalTime.set(this.selectedAppointment.startTime),this.modalPatientId.set(this.selectedAppointment.patientId),this.modalNotes.set(this.selectedAppointment.notes||""),this.modalPaymentMethod.set(this.selectedAppointment.paymentMethod||"CASH"),this.modalTransactionId.set(this.selectedAppointment.transactionId||""))}showCancelConfirmation(){this.isConfirmingCancel=!0,this.isRescheduling=!1}cancelCancelConfirmation(){this.isConfirmingCancel=!1}confirmCancel(){this.selectedAppointment&&(this.appointmentsService.updatestatus(this.selectedAppointment.id,"CANCELLED"),this.closeDetailsModal(),this.isConfirmingCancel=!1)}saveRescheduledAppointment(){if(this.selectedAppointment&&this.modalTime()&&this.modalDate()){let a=M(D({},this.selectedAppointment),{date:this.modalDate(),startTime:this.modalTime(),endTime:this.addMinutes(this.modalTime(),30),notes:this.modalNotes(),paymentMethod:this.modalPaymentMethod(),transactionId:this.modalTransactionId()}),e=this.appointments(),r=e.findIndex(n=>n.id===this.selectedAppointment.id);r!==-1&&(e[r]=a,this.appointmentsService.appointments.set([...e])),this.closeDetailsModal()}}cancelAppointment(){this.selectedAppointment&&(this.appointmentsService.updatestatus(this.selectedAppointment.id,"CANCELLED"),this.closeDetailsModal())}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=V({type:l,selectors:[["app-appointments-calendar"]],decls:23,vars:11,consts:[[1,"h-full","flex","flex-col"],[1,"bg-white","border-b","border-gray-200","px-6","py-4","flex","flex-col","md:flex-row","md:items-center","justify-between","gap-4"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-2","bg-blue-600","hover:bg-blue-700","text-white","px-6","py-2.5","rounded-xl","text-sm","font-bold","shadow-lg","shadow-blue-200","transition-all","active:scale-95",3,"click"],[1,"w-5","h-5",3,"img"],[1,"flex","items-center","bg-gray-100","rounded-xl","p-1"],[1,"p-1.5","hover:bg-white","hover:shadow-sm","rounded-lg","transition-all","text-gray-600",3,"click"],[1,"px-4","text-xs","font-bold","text-gray-900","min-w-[140px]","text-center","uppercase","tracking-wide"],[1,"flex-1","overflow-auto","bg-gray-50","p-6"],["class","space-y-6",4,"ngIf"],["class","bg-white rounded-xl shadow border border-gray-200 overflow-hidden min-w-[800px]",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",4,"ngIf"],[1,"space-y-6"],[1,"bg-blue-50","border","border-blue-100","rounded-xl","p-6","flex","items-center","justify-between"],[1,"text-lg","font-bold","text-blue-900"],[1,"text-sm","text-blue-700"],[1,"flex","items-center","gap-2","bg-white","px-4","py-2","rounded-lg","shadow-sm"],[1,"w-5","h-5","text-blue-600",3,"img"],[1,"font-bold","text-gray-900"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"w-full","text-left","border-collapse"],[1,"bg-gray-50","border-b","border-gray-200"],[1,"px-6","py-3","text-xs","font-semibold","text-gray-500","uppercase"],[1,"px-6","py-3","text-xs","font-semibold","text-gray-500","uppercase","text-right"],[1,"divide-y","divide-gray-100"],["class","hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"hover:bg-gray-50","transition-colors"],[1,"px-6","py-4"],[1,"flex","items-center","gap-2"],[1,"w-4","h-4","text-gray-400",3,"img"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-sm","font-bold","text-gray-900"],[1,"px-6","py-4","text-sm","text-gray-600"],[1,"px-6","py-4","text-right"],[1,"text-blue-600","hover:text-blue-800","text-sm","font-medium","hover:underline",3,"click"],["colspan","5",1,"px-6","py-12","text-center","text-gray-400"],[1,"w-12","h-12","mx-auto","mb-2","opacity-20",3,"img"],[1,"bg-white","rounded-xl","shadow","border","border-gray-200","overflow-hidden","min-w-[800px]"],[1,"grid","grid-cols-8","border-b","border-gray-200","bg-gray-50"],[1,"p-4","text-xs","font-semibold","text-gray-400","uppercase","tracking-wider","text-center","border-r","border-gray-200"],["class","p-4 text-center border-r border-gray-200 last:border-r-0",4,"ngFor","ngForOf"],["class","grid grid-cols-8 border-b border-gray-100 last:border-b-0 h-20",4,"ngFor","ngForOf"],[1,"p-4","text-center","border-r","border-gray-200","last:border-r-0"],[1,"text-xs","font-semibold","text-gray-500","uppercase"],[1,"text-lg","font-bold","text-gray-900"],[1,"grid","grid-cols-8","border-b","border-gray-100","last:border-b-0","h-20"],[1,"p-2","text-xs","font-medium","text-gray-500","text-center","border-r","border-gray-100","flex","items-center","justify-center","bg-gray-50/50"],["class","border-r border-gray-100 last:border-r-0 relative group p-1",4,"ngFor","ngForOf"],[1,"border-r","border-gray-100","last:border-r-0","relative","group","p-1"],[3,"ngSwitch"],["class","w-full h-full rounded-lg border-2 border-dashed border-gray-200 hover:border-blue-400 hover:bg-blue-50 flex items-center justify-center opacity-30 group-hover:opacity-100 transition-all text-blue-600",3,"click",4,"ngSwitchCase"],["class","w-full h-full bg-blue-100 border-l-4 border-blue-600 rounded p-2 overflow-hidden hover:shadow-md transition-shadow cursor-pointer",4,"ngSwitchCase"],["class","w-full h-full bg-gray-50/30",4,"ngSwitchDefault"],[1,"w-full","h-full","rounded-lg","border-2","border-dashed","border-gray-200","hover:border-blue-400","hover:bg-blue-50","flex","items-center","justify-center","opacity-30","group-hover:opacity-100","transition-all","text-blue-600",3,"click"],[1,"w-full","h-full","bg-blue-100","border-l-4","border-blue-600","rounded","p-2","overflow-hidden","hover:shadow-md","transition-shadow","cursor-pointer"],[1,"text-xs","font-bold","text-blue-800","truncate"],[1,"text-[10px]","text-blue-600","truncate","mt-0.5"],[1,"w-full","h-full","bg-gray-50/30"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"bg-white","rounded-2xl","shadow-2xl","w-full","max-w-3xl","max-h-[90vh]","overflow-y-auto"],[1,"bg-gradient-to-r","from-blue-600","to-blue-700","px-8","py-6","rounded-t-2xl"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-white"],[1,"text-blue-100","text-sm","mt-1"],[1,"text-white","hover:bg-white","hover:bg-opacity-20","rounded-lg","p-2","transition-all",3,"click"],[1,"w-6","h-6","rotate-45",3,"img"],[1,"p-8"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"space-y-5"],[1,"text-sm","font-bold","text-gray-700","uppercase","tracking-wide","mb-4"],[1,"text-xs","text-gray-500","mb-4"],[1,"block","text-xs","font-bold","text-gray-600","uppercase","tracking-wide","mb-2"],[1,"w-full","rounded-xl","border-2","border-gray-200","py-3","px-4","text-sm","font-medium","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","transition-all","outline-none",3,"ngModelChange","ngModel"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"w-full","rounded-xl","border-2","border-gray-200","py-3","px-4","text-sm","font-medium","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","transition-all","outline-none","disabled:bg-gray-50","disabled:text-gray-400",3,"ngModelChange","ngModel","disabled"],["type","date",1,"w-full","rounded-xl","border-2","border-gray-200","py-3","px-4","text-sm","font-medium","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","transition-all","outline-none",3,"ngModelChange","ngModel"],[1,"bg-gradient-to-br","from-gray-50","to-blue-50","rounded-2xl","p-6","border-2","border-gray-100"],[1,"text-sm","font-bold","text-gray-700","uppercase","tracking-wide","mb-2","text-center"],[1,"text-xs","text-gray-500","mb-4","text-center"],["class","grid grid-cols-3 gap-3 max-h-[320px] overflow-y-auto pr-2 custom-scrollbar",4,"ngIf"],["class","h-[320px] flex flex-col items-center justify-center text-center text-gray-400",4,"ngIf"],[1,"mt-8","pt-8","border-t-2","border-gray-100"],[1,"text-sm","font-bold","text-gray-700","uppercase","tracking-wide","mb-5"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-3","mb-6"],["type","button",3,"click"],[1,"w-6","h-6","mb-2",3,"img"],[1,"text-xs","text-gray-500","mt-1"],["placeholder","Escribe cualquier nota relevante para el m\xE9dico...","rows","3",1,"w-full","rounded-xl","border-2","border-gray-200","py-3","px-4","text-sm","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","transition-all","outline-none","resize-none",3,"ngModelChange","ngModel"],[1,"bg-gray-50","px-8","py-5","flex","flex-col-reverse","sm:flex-row","gap-3","border-t-2","border-gray-100","rounded-b-2xl"],["type","button",1,"flex-1","sm:flex-none","inline-flex","items-center","justify-center","gap-2","rounded-xl","bg-white","border-2","border-gray-300","px-6","py-3","text-sm","font-bold","text-gray-700","hover:bg-gray-50","transition-all",3,"click"],[1,"w-5","h-5","rotate-45",3,"img"],["type","button",1,"flex-1","inline-flex","items-center","justify-center","gap-2","rounded-xl","bg-blue-600","px-8","py-3","text-sm","font-bold","text-white","shadow-lg","shadow-blue-200","hover:bg-blue-700","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","disabled:shadow-none",3,"click","disabled"],[3,"value"],[1,"grid","grid-cols-3","gap-3","max-h-[320px]","overflow-y-auto","pr-2","custom-scrollbar"],[3,"class","click",4,"ngFor","ngForOf"],[3,"click"],[1,"h-[320px]","flex","flex-col","items-center","justify-center","text-center","text-gray-400"],[1,"w-16","h-16","mb-4","opacity-20",3,"img"],[1,"text-sm","font-medium","px-6"],[1,"bg-white","rounded-2xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","overflow-y-auto"],[1,"bg-gradient-to-r","from-indigo-600","to-purple-700","px-8","py-6","rounded-t-2xl"],[1,"text-indigo-100","text-sm","mt-1"],["class","p-8",4,"ngIf"],["class","p-12 text-center",4,"ngIf"],["class","bg-gray-50 px-8 py-5 flex flex-col-reverse sm:flex-row gap-3 border-t-2 border-gray-100 rounded-b-2xl",4,"ngIf"],[1,"bg-gradient-to-br","from-blue-50","to-indigo-50","rounded-xl","p-6","mb-6","border-2","border-blue-100"],[1,"flex","items-center","gap-3"],[1,"w-8","h-8","text-blue-600",3,"img"],[1,"text-sm","text-gray-600"],[1,"grid","grid-cols-2","gap-6","mb-6"],[1,"block","text-xs","font-bold","text-gray-500","uppercase","mb-2"],["class","bg-gray-50 rounded-xl p-4",4,"ngIf"],[1,"bg-gray-50","rounded-xl","p-4"],[1,"text-sm","text-gray-700"],[1,"bg-yellow-50","border-l-4","border-yellow-400","p-4","mb-4"],[1,"text-sm","text-yellow-700","italic"],[1,"grid","grid-cols-2","gap-4"],[1,"w-full","rounded-xl","border-2","border-gray-100","bg-gray-50","py-3","px-4","text-sm","font-bold","text-gray-500","italic"],[1,"w-full","rounded-xl","border-2","border-gray-200","py-3","px-4","text-sm","font-medium","focus:border-blue-500","outline-none","transition-all",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-4","gap-2","max-h-48","overflow-y-auto","pr-2","custom-scrollbar"],[1,"p-12","text-center"],[1,"w-20","h-20","bg-red-100","rounded-full","flex","items-center","justify-center","mx-auto","mb-6"],[1,"w-10","h-10","text-red-600",3,"img"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","mb-8","max-w-md","mx-auto"],[1,"flex","gap-4"],[1,"flex-1","py-4","bg-gray-100","text-gray-700","font-bold","rounded-xl","hover:bg-gray-200","transition-all",3,"click"],[1,"flex-1","py-4","bg-red-600","text-white","font-bold","rounded-xl","hover:bg-red-700","transition-all","shadow-lg","shadow-red-200",3,"click"],[1,"flex-1","flex","gap-3"],["type","button","class","flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-red-600 px-6 py-3 text-sm font-bold text-white hover:bg-red-700 transition-all",3,"click",4,"ngIf"],["type","button","class","flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-indigo-600 px-6 py-3 text-sm font-bold text-white shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all",3,"click",4,"ngIf"],["type","button","class","flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-8 py-3 text-sm font-bold text-white shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",3,"disabled","click",4,"ngIf"],["type","button",1,"flex-1","inline-flex","items-center","justify-center","gap-2","rounded-xl","bg-red-600","px-6","py-3","text-sm","font-bold","text-white","hover:bg-red-700","transition-all",3,"click"],["type","button",1,"flex-1","inline-flex","items-center","justify-center","gap-2","rounded-xl","bg-indigo-600","px-6","py-3","text-sm","font-bold","text-white","shadow-lg","shadow-indigo-200","hover:bg-indigo-700","transition-all",3,"click"],["type","button",1,"flex-1","inline-flex","items-center","justify-center","gap-2","rounded-xl","bg-blue-600","px-8","py-3","text-sm","font-bold","text-white","shadow-lg","shadow-blue-200","hover:bg-blue-700","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),d(4,"Agenda de Citas"),i(),t(5,"p",3),d(6,"Gestiona los turnos y citas m\xE9dicas globales."),i()(),t(7,"div",4)(8,"button",5),m("click",function(){return r.openGenericBooking()}),x(9,"lucide-icon",6),d(10," Agendar Nueva Cita "),i(),t(11,"div",7)(12,"button",8),m("click",function(){return r.changeWeek(-1)}),x(13,"lucide-icon",6),i(),t(14,"span",9),d(15),i(),t(16,"button",8),m("click",function(){return r.changeWeek(1)}),x(17,"lucide-icon",6),i()()()(),t(18,"div",10),b(19,be,28,4,"div",11)(20,Se,6,2,"div",12),i()(),b(21,ke,84,43,"div",13)(22,He,15,5,"div",13)),e&2&&(o(9),s("img",r.icons.Plus),o(4),s("img",r.icons.ChevronLeft),o(2),O(" ",r.weekDays()[0].dayName," ",r.weekDays()[0].dayNum," - ",r.weekDays()[6].dayName," ",r.weekDays()[6].dayNum," "),o(2),s("img",r.icons.ChevronRight),o(2),s("ngIf",!r.selectedDoctorId()||!r.selectedSpecialtyId()),o(),s("ngIf",r.selectedDoctorId()&&r.selectedSpecialtyId()),o(),s("ngIf",r.isModalOpen),o(),s("ngIf",r.isDetailsModalOpen))},dependencies:[W,L,R,j,$,H,le,ae,re,te,oe,ie,ne,Z,X],styles:[".custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9;border-radius:10px}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:10px}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.scale-102[_ngcontent-%COMP%]{transform:scale(1.02)}"]})};export{me as AppointmentsCalendarComponent};
