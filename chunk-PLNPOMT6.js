import{a as $}from"./chunk-NWFZENZL.js";import{a as be,b as xe,d as ye,g as he,i as ve,l as Se,m as Ce,n as _e,o as Me,s as Pe,u as we}from"./chunk-IRX75LVQ.js";import{a as _}from"./chunk-MZ3EZVY4.js";import{$ as g,A as R,Ab as N,Ba as o,Bb as T,Ed as ue,Ib as q,Kb as X,Kd as ge,Lb as oe,Ld as fe,Mc as de,Md as V,N as w,Nd as B,Qb as A,R as te,Ra as I,Va as p,W as h,Yc as me,aa as f,ab as c,bb as i,cb as r,db as u,eb as ie,fb as ne,gc as ae,hb as Y,hc as F,ia as b,ib as x,ic as k,id as z,jb as m,n as j,nc as le,oc as se,pc as U,qb as re,sb as C,ub as a,ud as pe,vb as v,wb as y,x as ee,xb as E,yc as ce,zb as D}from"./chunk-4QQE477L.js";var M=class l{http=h(ce);apiUrl=`${_.apiUrl}/subscriptions`;currentCurrency=b("PEN");plans=b([]);paymentMethods=b([]);currentSubscriptionId=b(null);upcomingBilling=b(null);clinicInfo=b(null);constructor(){}setCurrency(t){this.currentCurrency.set(t)}loadClinicInfo(){return this.http.get(`${_.apiUrl}/clinics/my`).pipe(w(t=>{this.clinicInfo.set(t),this.currentSubscriptionId.set(t.subscriptionId)}),R(()=>(this.clinicInfo.set(null),j(null))))}loadPlans(){return this.http.get(this.apiUrl).pipe(w(t=>this.plans.set(t.filter(e=>e.isActive).sort((e,n)=>e.order-n.order))),R(()=>(this.plans.set([]),j([]))))}loadPaymentMethods(){return this.http.get(`${_.apiUrl}/payment-methods`).pipe(w(t=>this.paymentMethods.set(t)),R(()=>(this.paymentMethods.set([]),j([]))))}createPaymentMethod(t){return this.http.post(`${_.apiUrl}/payment-methods`,t).pipe(w(()=>this.loadPaymentMethods()))}deletePaymentMethod(t){return this.http.delete(`${_.apiUrl}/payment-methods/${t}`).pipe(w(()=>this.loadPaymentMethods()))}loadUpcomingBilling(){return this.http.get(`${_.apiUrl}/clinics/my/upcoming-billing`).pipe(w(t=>this.upcomingBilling.set(t)),R(()=>(this.upcomingBilling.set(null),j(null))))}updateSubscription(t){return this.http.patch(`${_.apiUrl}/clinics/my/subscription`,t)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=te({token:l,factory:l.\u0275fac,providedIn:"root"})};function Ue(l,t){l&1&&(i(0,"div",14),a(1," Plan Actual "),r())}function Ve(l,t){if(l&1&&(i(0,"div",15)(1,"p",16),a(2),r(),i(3,"p",17),a(4),r()()),l&2){let e=m();o(2),E("Pagar ahora: ",e.currencySymbol()," ",e.upgradeAmount.toFixed(2)),o(2),E("Solo por el per\xEDodo actual. Desde el pr\xF3ximo per\xEDodo se cobrar\xE1 ",e.displayPrice(),"/",e.plan.periodUnit==="MONTHLY"?"mes":"a\xF1o",".")}}function Be(l,t){if(l&1&&(i(0,"li",9),u(1,"lucide-icon",10),i(2,"span",11),a(3),r()()),l&2){let e=t.$implicit,n=m();o(),c("img",n.checkIcon),o(2),v(e.title)}}var G=class l{plan;isCurrent=!1;upgradeAmount=null;onSelect;subService=h(M);checkIcon=de;get activeCharacteristics(){return[...this.plan.characteristics].filter(t=>t.isActive).sort((t,e)=>t.order-e.order)}displayPrice=A(()=>{let t=this.subService.currentCurrency(),e=this.plan.prices.find(s=>s.currency===t);return e?`${t==="USD"?"$":"S/"} ${e.price.toFixed(2)}`:"N/A"});currencySymbol=A(()=>this.subService.currentCurrency()==="USD"?"$":"S/");static \u0275fac=function(e){return new(e||l)};static \u0275cmp=I({type:l,selectors:[["app-plan-card"]],inputs:{plan:"plan",isCurrent:"isCurrent",upgradeAmount:"upgradeAmount",onSelect:"onSelect"},decls:24,vars:31,consts:[[1,"relative","rounded-xl","border","p-6","shadow-sm","flex","flex-col","h-full","transition-all","duration-200"],["class","absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-0.5 bg-blue-600 text-white text-[10px] font-bold uppercase tracking-wide rounded-full shadow-sm",4,"ngIf"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-500","mt-1","min-h-[2.5rem]"],[1,"mt-4","flex","items-baseline","text-gray-900"],[1,"text-3xl","font-bold","tracking-tight"],[1,"ml-1","text-sm","font-semibold","text-gray-500"],["class","mt-2 p-2 bg-blue-50 rounded-lg border border-blue-100",4,"ngIf"],["role","list",1,"mt-6","space-y-3","flex-1"],[1,"flex","items-start"],[1,"h-5","w-5","flex-shrink-0","text-green-500",3,"img"],[1,"ml-3","text-sm","text-gray-700"],["class","flex items-start",4,"ngFor","ngForOf"],[1,"mt-8","block","w-full","py-2.5","px-4","border","border-transparent","rounded-lg","text-center","text-sm","font-medium","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","px-3","py-0.5","bg-blue-600","text-white","text-[10px]","font-bold","uppercase","tracking-wide","rounded-full","shadow-sm"],[1,"mt-2","p-2","bg-blue-50","rounded-lg","border","border-blue-100"],[1,"text-xs","font-semibold","text-blue-700"],[1,"text-[10px]","text-blue-500","mt-0.5"]],template:function(e,n){e&1&&(i(0,"div",0),p(1,Ue,2,0,"div",1),i(2,"h3",2),a(3),r(),i(4,"p",3),a(5),r(),i(6,"div",4)(7,"span",5),a(8),r(),i(9,"span",6),a(10),r()(),p(11,Ve,5,4,"div",7),i(12,"ul",8)(13,"li",9),u(14,"lucide-icon",10),i(15,"span",11),a(16),r()(),i(17,"li",9),u(18,"lucide-icon",10),i(19,"span",11),a(20),r()(),p(21,Be,4,2,"li",12),r(),i(22,"button",13),x("click",function(){return n.onSelect()}),a(23),r()()),e&2&&(C("border-blue-500",n.isCurrent)("bg-blue-50",n.isCurrent)("border-gray-200",!n.isCurrent)("hover:border-blue-300",!n.isCurrent),o(),c("ngIf",n.isCurrent),o(2),v(n.plan.name),o(2),v(n.plan.description),o(3),v(n.displayPrice()),o(2),y("/",n.plan.periodUnit==="MONTHLY"?"mes":"a\xF1o"),o(),c("ngIf",n.upgradeAmount!==null),o(3),c("img",n.checkIcon),o(2),y("Hasta ",n.plan.maxDoctors," especialistas"),o(2),c("img",n.checkIcon),o(2),y("Hasta ",n.plan.maxPatients," pacientes"),o(),c("ngForOf",n.activeCharacteristics),o(),C("bg-blue-600",!n.isCurrent)("text-white",!n.isCurrent)("hover:bg-blue-700",!n.isCurrent)("bg-blue-100",n.isCurrent)("text-blue-800",n.isCurrent),c("disabled",n.isCurrent),o(),y(" ",n.isCurrent?"Plan Actual":"Seleccionar Plan"," "))},dependencies:[U,F,k,B,V],encapsulation:2})};function Le(l,t){if(l&1&&(i(0,"div",42),a(1),r()),l&2){let e=m(2);o(),y(" ",e.errorMessage()," ")}}function Oe(l,t){if(l&1&&(i(0,"option",43),a(1),r()),l&2){let e=t.$implicit;c("value",e),o(),v(e.toString().padStart(2,"0"))}}function je(l,t){l&1&&(i(0,"span",44),a(1,"(obligatorio para el primer m\xE9todo)"),r())}function Re(l,t){if(l&1&&u(0,"lucide-icon",45),l&2){let e=m(2);c("img",e.icons.Loader)}}function Ye(l,t){if(l&1){let e=Y();i(0,"div",12)(1,"div",13)(2,"div",14)(3,"h3",15),a(4,"Agregar M\xE9todo de Pago"),r(),i(5,"button",16),x("click",function(){g(e);let s=m();return f(s.closeModal())}),u(6,"lucide-icon",17),r()(),p(7,Le,2,1,"div",18),i(8,"div",19)(9,"div")(10,"label",20),a(11,"Tipo "),i(12,"span",21),a(13,"*"),r()(),i(14,"select",22),T("ngModelChange",function(s){g(e);let d=m();return N(d.form.type,s)||(d.form.type=s),f(s)}),i(15,"option",23),a(16,"Tarjeta de Cr\xE9dito"),r(),i(17,"option",24),a(18,"Tarjeta de D\xE9bito"),r()()(),i(19,"div")(20,"label",20),a(21,"Proveedor"),r(),i(22,"select",25),T("ngModelChange",function(s){g(e);let d=m();return N(d.form.provider,s)||(d.form.provider=s),f(s)}),i(23,"option",26),a(24,"Seleccionar..."),r(),i(25,"option",27),a(26,"VISA"),r(),i(27,"option",28),a(28,"MASTERCARD"),r(),i(29,"option",29),a(30,"AMEX"),r()()(),i(31,"div")(32,"label",20),a(33,"N\xFAmero de tarjeta"),r(),i(34,"input",30),x("ngModelChange",function(s){g(e);let d=m();return f(d.formatCardNumber(s))}),r()(),i(35,"div",31)(36,"div")(37,"label",20),a(38,"Mes exp."),r(),i(39,"select",32),T("ngModelChange",function(s){g(e);let d=m();return N(d.form.expiryMonth,s)||(d.form.expiryMonth=s),f(s)}),p(40,Oe,2,2,"option",33),r()(),i(41,"div")(42,"label",20),a(43,"A\xF1o exp."),r(),i(44,"input",34),T("ngModelChange",function(s){g(e);let d=m();return N(d.form.expiryYear,s)||(d.form.expiryYear=s),f(s)}),r()()(),i(45,"div",3)(46,"input",35),T("ngModelChange",function(s){g(e);let d=m();return N(d.form.isDefault,s)||(d.form.isDefault=s),f(s)}),r(),i(47,"label",36),a(48," Establecer como predeterminado "),p(49,je,2,0,"span",37),r()()(),i(50,"div",38)(51,"button",39),x("click",function(){g(e);let s=m();return f(s.closeModal())}),a(52," Cancelar "),r(),i(53,"button",40),x("click",function(){g(e);let s=m();return f(s.submitForm())}),p(54,Re,1,1,"lucide-icon",41),a(55),r()()()()}if(l&2){let e=m();o(5),c("disabled",e.isSubmitting()),o(),c("img",e.icons.X),o(),c("ngIf",e.errorMessage()),o(7),D("ngModel",e.form.type),o(8),D("ngModel",e.form.provider),o(12),c("ngModel",e.form.cardNumber),o(5),D("ngModel",e.form.expiryMonth),o(),c("ngForOf",e.months),o(4),D("ngModel",e.form.expiryYear),c("min",e.currentYear),o(2),D("ngModel",e.form.isDefault),c("disabled",e.paymentMethods().length===0),o(),C("text-gray-400",e.paymentMethods().length===0),o(2),c("ngIf",e.paymentMethods().length===0),o(2),c("disabled",e.isSubmitting()),o(2),c("disabled",e.isSubmitting()),o(),c("ngIf",e.isSubmitting()),o(),y(" ",e.isSubmitting()?"Guardando...":"Guardar"," ")}}function We(l,t){l&1&&(i(0,"div",46),a(1," No hay m\xE9todos de pago registrados. "),r())}function $e(l,t){l&1&&(i(0,"span",54),a(1," Predeterminado "),r())}function ze(l,t){if(l&1){let e=Y();i(0,"li",47)(1,"div",48)(2,"div",49),a(3),r(),i(4,"div")(5,"p",50),a(6),p(7,$e,2,0,"span",51),r(),i(8,"p",52),a(9),r()()(),i(10,"button",53),x("click",function(){let s=g(e).$implicit,d=m();return f(d.deleteMethod(s.paymentMethodId))}),u(11,"lucide-icon",7),r()()}if(l&2){let e=t.$implicit,n=m();o(3),y(" ",e.provider||e.type," "),o(3),y(" \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 ",e.last4," "),o(),c("ngIf",e.isDefault),o(2),E("Expira ",e.expiryMonth,"/",e.expiryYear),o(2),c("img",n.icons.Trash2)}}var H=class l{subService=h(M);confirmService=h($);paymentMethods=this.subService.paymentMethods;icons={CreditCard:me,Trash2:ue,Plus:pe,X:ge,Loader:z};showModal=b(!1);isSubmitting=b(!1);errorMessage=b("");currentYear=new Date().getFullYear();months=[1,2,3,4,5,6,7,8,9,10,11,12];form=this.emptyForm();emptyForm(){return{type:"CREDIT_CARD",provider:"",cardNumber:"",expiryMonth:1,expiryYear:this.currentYear,isDefault:!1}}async deleteMethod(t){await this.confirmService.confirm({title:"Eliminar m\xE9todo de pago",message:"\xBFEst\xE1s seguro de eliminar este m\xE9todo de pago?",confirmText:"S\xED, eliminar",cancelText:"Cancelar"})&&this.subService.deletePaymentMethod(t).subscribe()}formatCardNumber(t){let e=t.replace(/\D/g,"").slice(0,16);this.form.cardNumber=e.replace(/(\d{4})(?=\d)/g,"$1-")}openModal(){this.form=this.emptyForm(),this.paymentMethods().length===0&&(this.form.isDefault=!0),this.errorMessage.set(""),this.showModal.set(!0)}closeModal(){this.showModal.set(!1)}submitForm(){this.errorMessage.set(""),this.isSubmitting.set(!0);let t=this.form.cardNumber.replace(/\D/g,""),e=t.length>=4?t.slice(-4):void 0;this.subService.createPaymentMethod({type:this.form.type,provider:this.form.provider||void 0,cardNumber:t||void 0,last4:e,expiryMonth:this.form.expiryMonth,expiryYear:this.form.expiryYear,isDefault:this.form.isDefault}).subscribe({next:()=>{this.isSubmitting.set(!1),this.showModal.set(!1)},error:()=>{this.isSubmitting.set(!1),this.errorMessage.set("Ocurri\xF3 un error al guardar el m\xE9todo de pago.")}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=I({type:l,selectors:[["app-payment-methods"]],decls:14,vars:5,consts:[["class","fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",4,"ngIf"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","border","border-gray-100"],[1,"px-6","py-4","border-b","border-gray-100","bg-gray-50","flex","items-center","justify-between"],[1,"flex","items-center","gap-2"],[1,"w-5","h-5","text-gray-500",3,"img"],[1,"text-lg","font-medium","text-gray-900"],[1,"text-sm","text-blue-600","hover:text-blue-800","font-medium","flex","items-center","gap-1",3,"click"],[1,"w-4","h-4",3,"img"],[1,"p-6"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"divide-y","divide-gray-100"],["class","py-4 flex items-center justify-between",4,"ngFor","ngForOf"],[1,"fixed","inset-0","bg-black/40","z-50","flex","items-center","justify-center","p-4"],[1,"bg-white","rounded-2xl","p-6","w-full","max-w-md","shadow-2xl"],[1,"flex","items-center","justify-between","mb-5"],[1,"text-lg","font-semibold","text-gray-900"],[1,"p-1","text-gray-400","hover:text-gray-600","rounded-lg","hover:bg-gray-100","disabled:opacity-50",3,"click","disabled"],[1,"w-5","h-5",3,"img"],["class","mb-4 p-3 text-sm text-red-700 bg-red-100 rounded-lg",4,"ngIf"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["name","type",1,"w-full","rounded-md","border","border-gray-300","p-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500",3,"ngModelChange","ngModel"],["value","CREDIT_CARD"],["value","DEBIT_CARD"],["name","provider",1,"w-full","rounded-md","border","border-gray-300","p-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500",3,"ngModelChange","ngModel"],["value",""],["value","VISA"],["value","MASTERCARD"],["value","AMEX"],["type","text","name","cardNumber","maxlength","19","placeholder","0000-0000-0000-0000",1,"w-full","rounded-md","border","border-gray-300","p-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500","tracking-widest",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-3"],["name","expiryMonth",1,"w-full","rounded-md","border","border-gray-300","p-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","number","name","expiryYear",1,"w-full","rounded-md","border","border-gray-300","p-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500",3,"ngModelChange","ngModel","min"],["type","checkbox","name","isDefault","id","isDefault",1,"h-4","w-4","rounded","border-gray-300","text-blue-600","focus:ring-blue-500","disabled:opacity-60","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],["for","isDefault",1,"text-sm","text-gray-700"],["class","text-xs text-gray-400",4,"ngIf"],[1,"flex","gap-3","mt-6"],[1,"flex-1","py-2","px-4","rounded-lg","border","border-gray-300","text-sm","font-medium","text-gray-700","hover:bg-gray-50","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","py-2","px-4","rounded-lg","bg-blue-600","text-sm","font-medium","text-white","hover:bg-blue-700","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"click","disabled"],["class","w-4 h-4 animate-spin",3,"img",4,"ngIf"],[1,"mb-4","p-3","text-sm","text-red-700","bg-red-100","rounded-lg"],[3,"value"],[1,"text-xs","text-gray-400"],[1,"w-4","h-4","animate-spin",3,"img"],[1,"text-center","py-8","text-gray-500"],[1,"py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"h-10","w-24","flex-shrink-0","px-2","bg-gray-100","rounded","flex","items-center","justify-center","text-gray-500","font-bold","text-[10px]","uppercase","border","border-gray-200"],[1,"text-sm","font-medium","text-gray-900"],["class","ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",4,"ngIf"],[1,"text-xs","text-gray-500"],[1,"text-gray-400","hover:text-red-600","p-2","rounded-full","hover:bg-red-50","transition-colors",3,"click"],[1,"ml-2","inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-green-100","text-green-800"]],template:function(e,n){e&1&&(p(0,Ye,56,19,"div",0),i(1,"div",1)(2,"div",2)(3,"div",3),u(4,"lucide-icon",4),i(5,"h3",5),a(6,"M\xE9todos de Pago"),r()(),i(7,"button",6),x("click",function(){return n.openModal()}),u(8,"lucide-icon",7),a(9," Agregar tarjeta "),r()(),i(10,"div",8),p(11,We,2,0,"div",9),i(12,"ul",10),p(13,ze,12,6,"li",11),r()()()),e&2&&(c("ngIf",n.showModal()),o(4),c("img",n.icons.CreditCard),o(4),c("img",n.icons.Plus),o(3),c("ngIf",n.paymentMethods().length===0),o(2),c("ngForOf",n.paymentMethods()))},dependencies:[U,F,k,we,Ce,_e,xe,ve,be,Se,ye,Pe,Me,he,B,V],encapsulation:2})};function Ge(l,t){if(l&1&&(i(0,"div",16)(1,"div",17),u(2,"lucide-icon",18),i(3,"p",19),a(4,"Cargando..."),r()()()),l&2){let e=m();o(2),c("img",e.icons.Loader)}}function He(l,t){if(l&1&&u(0,"app-plan-card",20),l&2){let e=t.$implicit,n=m();c("plan",e)("isCurrent",n.currentSubscriptionId()===e.subscriptionId)("upgradeAmount",n.getUpgradeAmount(e))("onSelect",n.selectPlan.bind(n,e.subscriptionId))}}function qe(l,t){if(l&1&&(ie(0),i(1,"div",21)(2,"span",22),a(3,"Plan"),r(),i(4,"span",23),a(5),r()(),i(6,"div",21)(7,"span",22),a(8,"Fecha"),r(),i(9,"span",23),a(10),q(11,"date"),r()(),i(12,"div",21)(13,"span",22),a(14,"Monto"),r(),i(15,"span",24),a(16),q(17,"number"),r()(),i(18,"div",25)(19,"span",22),a(20,"Estado"),r(),i(21,"span",26),a(22),r()(),i(23,"p",27),a(24," * El monto puede variar seg\xFAn prorrateo o cambios de plan. "),r(),ne()),l&2){let e=m();o(5),v(e.billingPlanName()??"\u2014"),o(5),v(X(11,6,e.upcomingBilling().dueDate,"dd MMM yyyy")),o(6),E(" ",e.upcomingBilling().currency==="USD"?"$":"S/"," ",X(17,9,e.upcomingBilling().amountDue,"1.2-2")," "),o(5),c("ngClass",e.statusClass(e.upcomingBilling().status)),o(),y(" ",e.statusLabel(e.upcomingBilling().status)," ")}}function Xe(l,t){l&1&&(i(0,"p",28),a(1,"Sin facturaci\xF3n pr\xF3xima."),r())}var Ne=class l{subService=h(M);confirmService=h($);plans=this.subService.plans;currentSubscriptionId=this.subService.currentSubscriptionId;currentCurrency=this.subService.currentCurrency;upcomingBilling=this.subService.upcomingBilling;isLoading=b(!1);currentPlan=A(()=>this.plans().find(t=>t.subscriptionId===this.currentSubscriptionId())??null);billingPlanName=A(()=>{let t=this.upcomingBilling();return t?this.plans().find(e=>e.subscriptionId===t.subscriptionId)?.name??null:null});icons={Zap:fe,Loader:z};constructor(){this.isLoading.set(!0),ee([this.subService.loadClinicInfo(),this.subService.loadPlans(),this.subService.loadPaymentMethods(),this.subService.loadUpcomingBilling()]).subscribe({next:()=>this.isLoading.set(!1),error:()=>this.isLoading.set(!1)})}toggleCurrency(t){this.subService.setCurrency(t)}getUpgradeAmount(t){let e=this.currentPlan();if(!e||t.order<=e.order)return null;let n=this.currentCurrency(),s=t.prices.find(P=>P.currency===n)?.price??0,d=e.prices.find(P=>P.currency===n)?.price??0,L=this.subService.clinicInfo(),O=L?.startDate,W=L?.expirationDate;if(!O||!W)return s;let S=P=>new Date(P.getFullYear(),P.getMonth(),P.getDate()),Te=S(new Date),Ae=S(new Date(O)),J=S(new Date(W)),K=864e5,Q=Math.round((J.getTime()-Ae.getTime())/K),Fe=Math.max(0,Math.round((J.getTime()-Te.getTime())/K));if(Q<=0)return s;let ke=d*(Fe/Q);return Math.max(0,Math.round((s-ke)*100)/100)}statusClass(t){return{PENDING:"bg-yellow-100 text-yellow-700",PAID:"bg-green-100 text-green-700",OVERDUE:"bg-red-100 text-red-700"}[t]??"bg-gray-100 text-gray-600"}statusLabel(t){return{PENDING:"Pendiente",PAID:"Pagado",OVERDUE:"Vencido"}[t]??t}async selectPlan(t){let e=this.plans().find(S=>S.subscriptionId===t);if(!e)return;if(e.prices.every(S=>S.price===0)&&this.subService.clinicInfo()?.hadFreePlan){await this.confirmService.alert("Plan no disponible","Ya utilizaste el plan gratuito anteriormente. No es posible volver a seleccionarlo.");return}if(!await this.confirmService.confirm({title:"Cambiar plan",message:`\xBFEst\xE1s seguro de cambiar al ${e.name}?`,confirmText:"S\xED, cambiar",cancelText:"Cancelar"}))return;let d=this.currentPlan(),L=this.currentCurrency(),O=e.prices.find(S=>S.currency===L)?.price??0,W=d&&e.order>d.order?this.getUpgradeAmount(e)??O:O;this.isLoading.set(!0),this.subService.updateSubscription({subscriptionId:t,currency:L,amountPaid:W}).subscribe({next:async()=>{d&&e.order>d.order&&this.subService.currentSubscriptionId.set(t),this.subService.loadUpcomingBilling().subscribe(),this.isLoading.set(!1),await this.confirmService.alert("Plan actualizado","Tu plan ha sido actualizado con \xE9xito.")},error:async()=>{this.isLoading.set(!1),await this.confirmService.alert("Error","Ocurri\xF3 un error al actualizar el plan. Intenta nuevamente.")}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=I({type:l,selectors:[["app-subscription"]],decls:25,vars:21,consts:[["noBilling",""],["class","fixed inset-0 bg-black/30 z-40 flex items-center justify-center",4,"ngIf"],[1,"max-w-6xl","mx-auto","px-4","py-8"],[1,"mb-8","flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"text-2xl","font-bold","text-gray-900","flex","items-center","gap-2"],[1,"w-8","h-8","text-yellow-500","fill-yellow-500",3,"img"],[1,"mt-2","text-gray-600"],[1,"bg-gray-100","p-1","rounded-lg","inline-flex","items-center"],[1,"px-4","py-1.5","text-sm","font-medium","rounded-md","transition-all",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6","mb-12"],[3,"plan","isCurrent","upgradeAmount","onSelect",4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"lg:col-span-2"],[1,"bg-white","shadow","rounded-lg","p-6","border","border-gray-100"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","bg-black/30","z-40","flex","items-center","justify-center"],[1,"bg-white","rounded-2xl","px-10","py-8","flex","flex-col","items-center","gap-3","shadow-2xl"],[1,"w-10","h-10","text-blue-600","animate-spin",3,"img"],[1,"text-sm","font-medium","text-gray-600"],[3,"plan","isCurrent","upgradeAmount","onSelect"],[1,"flex","items-center","justify-between","py-2","border-b","border-gray-100"],[1,"text-gray-500"],[1,"font-medium"],[1,"font-semibold","text-gray-900"],[1,"flex","items-center","justify-between","py-2"],[1,"text-xs","font-bold","px-2","py-0.5","rounded-full",3,"ngClass"],[1,"mt-4","text-xs","text-gray-400"],[1,"text-sm","text-gray-400","text-center","py-4"]],template:function(e,n){if(e&1){let s=Y();p(0,Ge,5,1,"div",1),i(1,"div",2)(2,"div",3)(3,"div")(4,"h1",4),u(5,"lucide-icon",5),a(6," Planes y Suscripci\xF3n "),r(),i(7,"p",6),a(8,"Gestiona tu plan actual, facturaci\xF3n y m\xE9todos de pago."),r()(),i(9,"div",7)(10,"button",8),x("click",function(){return g(s),f(n.toggleCurrency("PEN"))}),a(11," Soles (PEN) "),r(),i(12,"button",8),x("click",function(){return g(s),f(n.toggleCurrency("USD"))}),a(13," D\xF3lares (USD) "),r()()(),i(14,"div",9),p(15,He,1,4,"app-plan-card",10),r(),i(16,"div",11)(17,"div",12),u(18,"app-payment-methods"),r(),i(19,"div",13)(20,"h3",14),a(21,"Pr\xF3xima Facturaci\xF3n"),r(),p(22,qe,25,12,"ng-container",15)(23,Xe,2,0,"ng-template",null,0,oe),r()()()}if(e&2){let s=re(24);c("ngIf",n.isLoading()),o(5),c("img",n.icons.Zap),o(5),C("bg-white",n.currentCurrency()==="PEN")("text-blue-600",n.currentCurrency()==="PEN")("shadow-sm",n.currentCurrency()==="PEN")("text-gray-500",n.currentCurrency()!=="PEN"),o(2),C("bg-white",n.currentCurrency()==="USD")("text-blue-600",n.currentCurrency()==="USD")("shadow-sm",n.currentCurrency()==="USD")("text-gray-500",n.currentCurrency()!=="USD"),o(3),c("ngForOf",n.plans()),o(7),c("ngIf",n.upcomingBilling())("ngIfElse",s)}},dependencies:[U,ae,F,k,B,V,G,H,se,le],styles:["[_nghost-%COMP%]{display:block}"]})};export{Ne as SubscriptionComponent};
