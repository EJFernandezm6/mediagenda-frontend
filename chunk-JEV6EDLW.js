import{a as Q}from"./chunk-HDHEHOY6.js";import{a as z}from"./chunk-BAEEHCHP.js";import"./chunk-QH3LZKOO.js";import{b as D,c as m,d as V,e as O,h as R,j as K,k as B,r as J,t as H}from"./chunk-PDYZXUXT.js";import"./chunk-MZ3EZVY4.js";import{Ba as l,Bd as M,Cd as k,Gd as L,Hd as q,Ra as F,Va as u,W as w,Yc as I,Zc as T,a as y,ab as o,bb as i,cb as t,cd as G,db as d,ed as A,ib as c,ic as U,jb as f,mc as N,qd as j,ub as a,vb as v,xa as S}from"./chunk-MMESFILH.js";function X(r,n){if(r&1&&d(0,"img",37),r&2){let s,e=f();o("src",(s=e.currentUser())==null?null:s.photoUrl,S)}}function Y(r,n){if(r&1&&d(0,"lucide-icon",38),r&2){let s=f();o("img",s.icons.User)}}function Z(r,n){r&1&&(i(0,"p",39),a(1," El nombre es requerido "),t())}function $(r,n){if(r&1&&d(0,"lucide-icon",32),r&2){let s=f();o("img",s.icons.Save)}}function ee(r,n){r&1&&(i(0,"span"),a(1,"Guardando..."),t())}function te(r,n){r&1&&(i(0,"span"),a(1,"Guardar Cambios"),t())}function re(r,n){r&1&&(i(0,"p",39),a(1," Requerido "),t())}function ie(r,n){r&1&&(i(0,"p",39),a(1," M\xEDnimo 6 caracteres "),t())}function oe(r,n){r&1&&(i(0,"p",39),a(1," Las contrase\xF1as no coinciden "),t())}function ne(r,n){if(r&1&&d(0,"lucide-icon",32),r&2){let s=f();o("img",s.icons.KeyRound)}}function le(r,n){r&1&&(i(0,"span"),a(1,"Actualizando..."),t())}function ae(r,n){r&1&&(i(0,"span"),a(1,"Actualizar Contrase\xF1a"),t())}function se(r){let n=r.get("password"),s=r.get("confirmPassword");return n&&s&&n.value!==s.value?{mismatch:!0}:null}var W=class r{fb=w(J);authService=w(z);usersService=w(Q);currentUser=this.authService.currentUser;isUpdatingProfile=!1;isChangingPassword=!1;showPassword=!1;showCurrentPassword=!1;icons={User:k,UserCog:M,Save:j,Lock:A,KeyRound:G,Eye:T,EyeOff:I};profileForm;passwordForm;constructor(){let n=this.currentUser();this.profileForm=this.fb.group({fullName:[n?.fullName||"",[m.required]],phone:[n?.phone||""],photoUrl:[n?.photoUrl||""]}),this.passwordForm=this.fb.group({currentPassword:["",[m.required]],password:["",[m.required,m.minLength(6)]],confirmPassword:["",[m.required]]},{validators:se})}onUpdateProfile(){if(this.profileForm.invalid)return;let n=this.currentUser();if(!n)return;this.isUpdatingProfile=!0;let s={fullName:this.profileForm.value.fullName,phone:this.profileForm.value.phone,photoUrl:this.profileForm.value.photoUrl};this.usersService.updateUser(n.id,s).subscribe({next:()=>{let e=y(y({},n),s);this.authService.currentUser.set(e),localStorage.setItem("user",JSON.stringify(e)),this.isUpdatingProfile=!1,alert("Perfil actualizado correctamente")},error:e=>{console.error("Error updating profile:",e),this.isUpdatingProfile=!1,alert("Error al actualizar el perfil")}})}onChangePassword(){if(this.passwordForm.invalid)return;this.isChangingPassword=!0;let n=this.passwordForm.value.currentPassword,s=this.passwordForm.value.password;this.usersService.changePassword({currentPassword:n,newPassword:s}).subscribe({next:()=>{this.isChangingPassword=!1,this.passwordForm.reset(),alert("Contrase\xF1a actualizada correctamente")},error:e=>{console.error("Error updating password:",e),this.isChangingPassword=!1,alert("Error al cambiar la contrase\xF1a: "+(e.error?.message||"Error desconocido"))}})}static \u0275fac=function(s){return new(s||r)};static \u0275cmp=F({type:r,selectors:[["app-profile"]],decls:78,vars:25,consts:[[1,"space-y-6","animate-fade-in"],[1,"bg-white","p-6","rounded-2xl","shadow-sm","border","border-gray-100","flex","flex-col","md:flex-row","md:items-center","justify-between","gap-4"],[1,"text-2xl","font-bold","text-gray-800"],[1,"text-gray-500"],[1,"flex","items-center","gap-3"],[1,"h-12","w-12","rounded-full","bg-blue-100","flex","items-center","justify-center","overflow-hidden","border-2","border-white","shadow-sm"],["alt","Profile","class","h-full w-full object-cover",3,"src",4,"ngIf"],["class","w-6 h-6 text-blue-600",3,"img",4,"ngIf"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2","bg-white","p-6","rounded-2xl","shadow-sm","border","border-gray-100"],[1,"text-lg","font-semibold","text-gray-800","mb-6","flex","items-center","gap-2"],[1,"w-5","h-5","text-blue-600",3,"img"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"space-y-1"],[1,"text-sm","font-medium","text-gray-700"],["type","text","formControlName","fullName","placeholder","Tu nombre completo",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-blue-500/20","focus:border-blue-500","transition-all","outline-none"],["class","text-xs text-red-500",4,"ngIf"],["type","tel","formControlName","phone","placeholder","+51 999 999 999",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-blue-500/20","focus:border-blue-500","transition-all","outline-none"],["type","email","disabled","",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","bg-gray-50","text-gray-500","cursor-not-allowed",3,"value"],[1,"text-xs","text-gray-400"],["type","url","formControlName","photoUrl","placeholder","https://example.com/photo.jpg",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-blue-500/20","focus:border-blue-500","transition-all","outline-none"],[1,"pt-4","flex","justify-end"],["type","submit",1,"px-6","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"disabled"],["class","w-4 h-4",3,"img",4,"ngIf"],[4,"ngIf"],[1,"bg-white","p-6","rounded-2xl","shadow-sm","border","border-gray-100","h-fit"],[1,"relative"],["formControlName","currentPassword","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-blue-500/20","focus:border-blue-500","transition-all","outline-none",3,"type"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-gray-400","hover:text-gray-600",3,"click"],[1,"w-4","h-4",3,"img"],["formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-blue-500/20","focus:border-blue-500","transition-all","outline-none",3,"type"],["type","password","formControlName","confirmPassword","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","px-4","py-2","border","border-gray-200","rounded-lg","focus:ring-2","focus:ring-blue-500/20","focus:border-blue-500","transition-all","outline-none"],[1,"pt-4"],["type","submit",1,"w-full","px-6","py-2","bg-gray-900","text-white","rounded-lg","hover:bg-gray-800","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","gap-2",3,"disabled"],["alt","Profile",1,"h-full","w-full","object-cover",3,"src"],[1,"w-6","h-6","text-blue-600",3,"img"],[1,"text-xs","text-red-500"]],template:function(s,e){if(s&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),a(4,"Mi Perfil"),t(),i(5,"p",3),a(6,"Gestiona tu informaci\xF3n personal y seguridad"),t()(),i(7,"div",4)(8,"div",5),u(9,X,1,1,"img",6)(10,Y,1,1,"lucide-icon",7),t(),i(11,"div")(12,"p",8),a(13),t(),i(14,"p",9),a(15),t()()()(),i(16,"div",10)(17,"div",11)(18,"h3",12),d(19,"lucide-icon",13),a(20," Informaci\xF3n Personal "),t(),i(21,"form",14),c("ngSubmit",function(){return e.onUpdateProfile()}),i(22,"div",15)(23,"div",16)(24,"label",17),a(25,"Nombre Completo"),t(),d(26,"input",18),u(27,Z,2,0,"p",19),t(),i(28,"div",16)(29,"label",17),a(30,"Tel\xE9fono"),t(),d(31,"input",20),t()(),i(32,"div",16)(33,"label",17),a(34,"Correo Electr\xF3nico"),t(),d(35,"input",21),i(36,"p",22),a(37,"El correo electr\xF3nico no se puede cambiar"),t()(),i(38,"div",16)(39,"label",17),a(40,"URL de Foto (Opcional)"),t(),d(41,"input",23),t(),i(42,"div",24)(43,"button",25),u(44,$,1,1,"lucide-icon",26)(45,ee,2,0,"span",27)(46,te,2,0,"span",27),t()()()(),i(47,"div",28)(48,"h3",12),d(49,"lucide-icon",13),a(50," Seguridad "),t(),i(51,"form",14),c("ngSubmit",function(){return e.onChangePassword()}),i(52,"div",16)(53,"label",17),a(54,"Contrase\xF1a Actual"),t(),i(55,"div",29),d(56,"input",30),i(57,"button",31),c("click",function(){return e.showCurrentPassword=!e.showCurrentPassword}),d(58,"lucide-icon",32),t()(),u(59,re,2,0,"p",19),t(),i(60,"div",16)(61,"label",17),a(62,"Nueva Contrase\xF1a"),t(),i(63,"div",29),d(64,"input",33),i(65,"button",31),c("click",function(){return e.showPassword=!e.showPassword}),d(66,"lucide-icon",32),t()(),u(67,ie,2,0,"p",19),t(),i(68,"div",16)(69,"label",17),a(70,"Confirmar Contrase\xF1a"),t(),d(71,"input",34),u(72,oe,2,0,"p",19),t(),i(73,"div",35)(74,"button",36),u(75,ne,1,1,"lucide-icon",26)(76,le,2,0,"span",27)(77,ae,2,0,"span",27),t()()()()()()),s&2){let p,_,P,C,g,x,b,h,E;l(9),o("ngIf",(p=e.currentUser())==null?null:p.photoUrl),l(),o("ngIf",!((_=e.currentUser())!=null&&_.photoUrl)),l(3),v(((P=e.currentUser())==null?null:P.fullName)||"Usuario"),l(2),v((C=e.currentUser())==null?null:C.email),l(4),o("img",e.icons.UserCog),l(2),o("formGroup",e.profileForm),l(6),o("ngIf",((g=e.profileForm.get("fullName"))==null?null:g.touched)&&((g=e.profileForm.get("fullName"))==null?null:g.invalid)),l(8),o("value",(x=e.currentUser())==null?null:x.email),l(8),o("disabled",e.profileForm.invalid||e.isUpdatingProfile),l(),o("ngIf",!e.isUpdatingProfile),l(),o("ngIf",e.isUpdatingProfile),l(),o("ngIf",!e.isUpdatingProfile),l(3),o("img",e.icons.Lock),l(2),o("formGroup",e.passwordForm),l(5),o("type",e.showCurrentPassword?"text":"password"),l(2),o("img",e.showCurrentPassword?e.icons.EyeOff:e.icons.Eye),l(),o("ngIf",((b=e.passwordForm.get("currentPassword"))==null?null:b.touched)&&((b=e.passwordForm.get("currentPassword"))==null?null:b.invalid)),l(5),o("type",e.showPassword?"text":"password"),l(2),o("img",e.showPassword?e.icons.EyeOff:e.icons.Eye),l(),o("ngIf",((h=e.passwordForm.get("password"))==null?null:h.touched)&&((h=e.passwordForm.get("password"))==null?null:h.invalid)),l(5),o("ngIf",(e.passwordForm.errors==null?null:e.passwordForm.errors.mismatch)&&((E=e.passwordForm.get("confirmPassword"))==null?null:E.touched)),l(2),o("disabled",e.passwordForm.invalid||e.isChangingPassword),l(),o("ngIf",!e.isChangingPassword),l(),o("ngIf",e.isChangingPassword),l(),o("ngIf",!e.isChangingPassword)}},dependencies:[N,U,H,R,D,V,O,K,B,q,L],encapsulation:2})};export{W as ProfileComponent,se as passwordMatchValidator};
