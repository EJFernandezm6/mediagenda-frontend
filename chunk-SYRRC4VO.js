import{a as R}from"./chunk-UVZ55QY3.js";import{a as ae}from"./chunk-MRZLPRIY.js";import{a as L}from"./chunk-5PR7GVTJ.js";import{a as U}from"./chunk-D3EGGWZK.js";import{b as V,d as O,g as F,i as oe,l as ne,m as re,n as le,o as se,u as A}from"./chunk-QZM4Q4DO.js";import{a as ce}from"./chunk-5QU4QAOU.js";import"./chunk-MZ3EZVY4.js";import{$ as u,Ab as q,Ad as ee,Ba as l,Bb as G,Dd as te,Jd as ie,Ld as T,Md as k,Qb as _,Ra as I,Tb as K,Va as h,W as b,a as j,aa as g,ab as d,b as H,ba as J,bb as o,cb as n,db as y,dd as Y,hb as S,hc as D,ia as f,ib as m,ic as M,jb as p,nb as B,ob as P,oc as E,pb as Q,td as Z,ub as a,wb as x,wd as N,zb as W}from"./chunk-NGQHHHUV.js";function he(s,t){if(s&1){let e=S();o(0,"div",8),m("click",function(){u(e);let r=p();return g(r.isOpen.set(!1))}),n()}}function be(s,t){s&1&&(o(0,"span",16),J(),o(1,"svg",17),y(2,"path",18),n()())}function Se(s,t){if(s&1){let e=S();o(0,"li",12),m("click",function(){let r=u(e).$implicit,c=p(2);return g(c.selectSpecialty(r))}),o(1,"div",13)(2,"span",14),a(3),n()(),h(4,be,3,0,"span",15),n()}if(s&2){let e=t.$implicit,i=p(2);l(3),x(" ",e.name," "),l(),d("ngIf",e.specialtyId===i.selectedSpecialtyId())}}function _e(s,t){if(s&1&&(o(0,"div",9)(1,"ul",10),h(2,Se,5,2,"li",11),n()()),s&2){let e=p();l(2),d("ngForOf",e.filteredOptions())}}function ve(s,t){s&1&&(o(0,"div",19),a(1," No se encontraron especialidades. "),n())}var v=class s{specialtyService=b(L);selectedSpecialtyId=f("");disabled=f(!1);selectionChanged=K();set setDisabled(t){this.disabled.set(t)}isOpen=f(!1);searchText=f("");specialties=this.specialtyService.specialties;icons={Search:N};filteredOptions=_(()=>{let t=this.searchText().toLowerCase();return this.specialties().filter(e=>e.name.toLowerCase().includes(t))});onSearchChange(t){this.searchText.set(t),this.isOpen.set(!0),t||(this.selectedSpecialtyId.set(""),this.selectionChanged.emit(""))}selectSpecialty(t){this.selectedSpecialtyId.set(t.specialtyId),this.searchText.set(t.name),this.isOpen.set(!1),this.selectionChanged.emit(t.specialtyId)}clear(){this.selectedSpecialtyId.set(""),this.searchText.set(""),this.selectionChanged.emit("")}setValue(t){let e=this.specialties().find(i=>i.specialtyId===t);e?(this.selectedSpecialtyId.set(t),this.searchText.set(e.name)):(this.selectedSpecialtyId.set(""),this.searchText.set(""))}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=I({type:s,selectors:[["app-specialty-selector"]],inputs:{setDisabled:[0,"disabled","setDisabled"]},outputs:{selectionChanged:"selectionChanged"},decls:8,vars:6,consts:[[1,"relative"],[1,"relative","rounded-md","shadow-sm"],[1,"pointer-events-none","absolute","inset-y-0","left-0","flex","items-center","pl-3"],[1,"h-5","w-5","text-gray-400",3,"img"],["type","text","placeholder","Buscar especialidad...",1,"block","w-full","rounded-md","border-gray-300","pl-10","focus:border-blue-500","focus:ring-blue-500","sm:text-sm","border","py-2","disabled:bg-gray-100","disabled:text-gray-500",3,"ngModelChange","focus","ngModel","disabled"],["class","dropdown-backdrop",3,"click",4,"ngIf"],["class","absolute z-40 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",4,"ngIf"],["class","absolute z-40 mt-1 w-full rounded-md bg-white py-2 px-3 text-sm text-gray-500 shadow-lg border",4,"ngIf"],[1,"dropdown-backdrop",3,"click"],[1,"absolute","z-40","mt-1","max-h-60","w-full","overflow-auto","rounded-md","bg-white","py-1","text-base","shadow-lg","ring-1","ring-black","ring-opacity-5","focus:outline-none","sm:text-sm"],["tabindex","-1","role","listbox"],["class","relative cursor-pointer select-none py-2 pl-3 pr-9 hover:bg-blue-50 text-gray-900 group",3,"click",4,"ngFor","ngForOf"],[1,"relative","cursor-pointer","select-none","py-2","pl-3","pr-9","hover:bg-blue-50","text-gray-900","group",3,"click"],[1,"flex","items-center"],[1,"font-normal","block","truncate","group-hover:font-semibold"],["class","absolute inset-y-0 right-0 flex items-center pr-4 text-blue-600",4,"ngIf"],[1,"absolute","inset-y-0","right-0","flex","items-center","pr-4","text-blue-600"],["viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],[1,"absolute","z-40","mt-1","w-full","rounded-md","bg-white","py-2","px-3","text-sm","text-gray-500","shadow-lg","border"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),y(3,"lucide-icon",3),n(),o(4,"input",4),m("ngModelChange",function(c){return i.onSearchChange(c)})("focus",function(){return i.isOpen.set(!0)}),n()(),h(5,he,1,0,"div",5)(6,_e,3,1,"div",6)(7,ve,2,0,"div",7),n()),e&2&&(l(3),d("img",i.icons.Search),l(),d("ngModel",i.searchText())("disabled",i.disabled()),l(),d("ngIf",i.isOpen()),l(),d("ngIf",i.isOpen()&&i.filteredOptions().length>0),l(),d("ngIf",i.isOpen()&&i.filteredOptions().length===0))},dependencies:[E,D,M,A,V,O,F,k,T],styles:[".dropdown-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:30;background:transparent}"]})};function Ce(s,t){if(s&1&&(o(0,"option",30),a(1),n()),s&2){let e=t.$implicit;d("value",e.valueId),l(),x("",e.displayName," ")}}function we(s,t){if(s&1&&(o(0,"option",30),a(1),n()),s&2){let e=t.$implicit;d("value",e.specialtyId),l(),x("",e.name," ")}}function Ie(s,t){if(s&1){let e=S();o(0,"tr")(1,"td",31),a(2),n(),o(3,"td",32),a(4),n(),o(5,"td",32),a(6),n(),o(7,"td",32),a(8),n(),o(9,"td",33)(10,"button",34),m("click",function(){let r=u(e).$implicit,c=p();return g(c.openEditModal(r))}),y(11,"lucide-icon",35),n(),o(12,"button",36),m("click",function(){let r=u(e).$implicit,c=p();return g(c.delete(r))}),y(13,"lucide-icon",35),n()()()}if(s&2){let e=t.$implicit,i=p();l(2),x(" ",i.getSpecialtyName(e.specialtyId)," "),l(2),x(" ",i.getDoctorName(e.doctorId)," "),l(2),x(" S/ ",e.cost," "),l(2),x(" ",e.durationMinutes," min "),l(3),d("img",i.icons.Edit),l(2),d("img",i.icons.Trash2)}}function De(s,t){if(s&1&&(o(0,"tr")(1,"td",37)(2,"div",38),y(3,"lucide-icon",39),o(4,"p",40),a(5,"No se encontraron asignaciones "),n(),o(6,"p",41),a(7,"Intenta ajustar los filtros de b\xFAsqueda. "),n()()()()),s&2){let e=p();l(3),d("img",e.icons.Search)}}function Me(s,t){if(s&1){let e=S();o(0,"div",42)(1,"div",43)(2,"div",44),m("click",function(){u(e);let r=p();return g(r.closeModal())}),n(),o(3,"span",45),a(4,"\u200B"),n(),o(5,"div",46)(6,"div",47)(7,"button",48),m("click",function(){u(e);let r=p();return g(r.closeModal())}),o(8,"span",25),a(9,"Cerrar"),n(),y(10,"lucide-icon",49),n()(),o(11,"div",50)(12,"div",51)(13,"h3",52),a(14),n(),o(15,"div",53)(16,"div")(17,"label",54),a(18,"Especialista"),n(),o(19,"app-doctor-selector",55),m("selectionChanged",function(r){u(e);let c=p();return g(c.selectedDoctorId=r)}),n()(),o(20,"div")(21,"label",54),a(22,"Especialidad"),n(),o(23,"app-specialty-selector",55),m("selectionChanged",function(r){u(e);let c=p();return g(c.selectedSpecialtyId=r)}),n()(),o(24,"div",56)(25,"div")(26,"label",57),a(27,"Costo (S/)"),n(),o(28,"input",58),G("ngModelChange",function(r){u(e);let c=p();return q(c.cost,r)||(c.cost=r),g(r)}),n()(),o(29,"div")(30,"label",57),a(31,"Duraci\xF3n (min)"),n(),o(32,"input",59),G("ngModelChange",function(r){u(e);let c=p();return q(c.duration,r)||(c.duration=r),g(r)}),n()()()()()(),o(33,"div",60)(34,"button",61),m("click",function(){u(e);let r=p();return g(r.save())}),a(35," Guardar "),n(),o(36,"button",62),m("click",function(){u(e);let r=p();return g(r.closeModal())}),a(37," Cancelar "),n()()()()()}if(s&2){let e=p();l(10),d("img",e.icons.Plus),l(4),x(" ",e.isEditMode()?"Editar asignaci\xF3n":"Nueva asignaci\xF3n"," "),l(5),d("disabled",e.isEditMode()),l(4),d("disabled",e.isEditMode()),l(5),W("ngModel",e.cost),l(4),W("ngModel",e.duration),l(2),d("disabled",!e.selectedDoctorId||!e.selectedSpecialtyId)}}var de=class s{associationService=b(ae);doctorService=b(ce);specialtyService=b(L);confirmService=b(U);icons={Plus:Z,Trash2:te,Edit:ee,Search:N,X:ie,Filter:Y};doctors=this.doctorService.doctors;specialties=this.specialtyService.specialties;associations=this.associationService.associations;searchTerm=f("");filterDoctorId=f("");filterSpecialtyId=f("");isModalOpen=f(!1);isEditMode=f(!1);selectedDoctorId="";selectedSpecialtyId="";cost=0;duration=30;originalAssociation=null;formattedDoctors=_(()=>this.doctors().map(t=>H(j({},t),{valueId:t.doctorId||t.id,displayName:t.dni?`${t.dni} - ${t.fullName}`:t.fullName})));filteredAssociations=_(()=>{let t=this.searchTerm().toLowerCase(),e=this.filterDoctorId(),i=this.filterSpecialtyId();return this.associations().filter(r=>{let c=this.doctors().find(X=>X.doctorId===r.doctorId||X.id===r.doctorId),C=c?.fullName.toLowerCase()||"",w=c?.dni?.toLowerCase()||"",z=this.getSpecialtyName(r.specialtyId).toLowerCase(),$=C.includes(t)||w.includes(t)||z.includes(t),pe=!e||r.doctorId===e,me=!i||r.specialtyId===i;return $&&pe&&me}).sort((r,c)=>{let C=this.getSpecialtyName(r.specialtyId).toLowerCase(),w=this.getSpecialtyName(c.specialtyId).toLowerCase();if(C<w)return-1;if(C>w)return 1;let z=this.getDoctorName(r.doctorId).toLowerCase(),$=this.getDoctorName(c.doctorId).toLowerCase();return z.localeCompare($)})});doctorSelector;specialtySelector;getDoctorName(t){let e=this.doctors().find(i=>i.doctorId===t||i.id===t);return e?e.dni?`${e.dni} - ${e.fullName}`:e.fullName:"Desconocido"}getSpecialtyName(t){return this.specialties().find(e=>e.specialtyId===t)?.name||"Desconocida"}openAddModal(){this.isEditMode.set(!1),this.resetForm(),this.doctorSelector?.clear(),this.specialtySelector?.clear(),this.isModalOpen.set(!0)}openEditModal(t){this.isEditMode.set(!0),this.selectedDoctorId=t.doctorId,this.selectedSpecialtyId=t.specialtyId,this.cost=t.cost,this.duration=t.durationMinutes,this.originalAssociation=j({},t),this.isModalOpen.set(!0),setTimeout(()=>{this.doctorSelector?.setValue(t.doctorId),this.specialtySelector?.setValue(t.specialtyId)})}closeModal(){this.isModalOpen.set(!1),this.resetForm(),this.originalAssociation=null}save(){if(!this.selectedDoctorId||!this.selectedSpecialtyId)return;let t={doctorId:this.selectedDoctorId,specialtyId:this.selectedSpecialtyId,cost:this.cost,durationMinutes:this.duration};if(console.log("\u{1F4BE} Saving association for Doctor ID:",this.selectedDoctorId),this.isEditMode()&&this.originalAssociation?.doctorSpecialtyId)this.associationService.updateAssociation(this.originalAssociation.doctorSpecialtyId,t).subscribe({next:()=>this.closeModal(),error:e=>alert("Error al actualizar: "+(e.error?.message||e.message))});else{if(this.associations().some(i=>i.doctorId===t.doctorId&&i.specialtyId===t.specialtyId)){alert("Esta asignaci\xF3n ya existe.");return}this.associationService.addAssociation(this.selectedDoctorId,t).subscribe({next:()=>this.closeModal(),error:i=>alert("Error al guardar: "+(i.error?.message||i.message))})}}async delete(t){if(!t.doctorSpecialtyId)return;await this.confirmService.confirm({title:"Eliminar Asignaci\xF3n",message:`\xBFEst\xE1s seguro de eliminar la asignaci\xF3n de ${this.getSpecialtyName(t.specialtyId)} a ${this.getDoctorName(t.doctorId)}?`,confirmText:"Eliminar",cancelText:"Cancelar"})&&this.associationService.removeAssociation(t.doctorSpecialtyId).subscribe()}resetForm(){this.selectedDoctorId="",this.selectedSpecialtyId="",this.cost=0,this.duration=30}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=I({type:s,selectors:[["app-doctor-specialty"]],viewQuery:function(e,i){if(e&1&&(B(R,5),B(v,5)),e&2){let r;P(r=Q())&&(i.doctorSelector=r.first),P(r=Q())&&(i.specialtySelector=r.first)}},decls:48,vars:10,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8"],[1,"sm:flex","sm:items-center"],[1,"sm:flex-auto"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-700"],[1,"mt-4","sm:mt-0","sm:ml-16","sm:flex-none"],[1,"inline-flex","items-center","justify-center","rounded-md","border","border-transparent","bg-blue-600","px-4","py-2","text-sm","font-medium","text-white","shadow-sm","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","sm:w-auto","gap-2",3,"click"],[1,"w-4","h-4",3,"img"],[1,"mt-8","bg-white","p-4","rounded-lg","shadow-sm","border","border-gray-200","grid","grid-cols-1","gap-4","md:grid-cols-4"],[1,"relative","rounded-md","shadow-sm"],[1,"pointer-events-none","absolute","inset-y-0","left-0","flex","items-center","pl-3"],[1,"h-5","w-5","text-gray-400",3,"img"],["type","text","placeholder","Buscar especialista o especialidad...",1,"block","w-full","rounded-md","border-gray-300","pl-10","focus:border-blue-500","focus:ring-blue-500","sm:text-sm","border","py-2",3,"ngModelChange","ngModel"],[1,"block","w-full","rounded-md","border-gray-300","py-2","pl-3","pr-10","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"mt-8","flex","flex-col"],[1,"-my-2","-mx-4","overflow-x-auto","sm:-mx-6","lg:-mx-8"],[1,"inline-block","min-w-full","py-2","align-middle","md:px-6","lg:px-8"],[1,"overflow-hidden","shadow","ring-1","ring-black","ring-opacity-5","md:rounded-lg"],[1,"min-w-full","divide-y","divide-gray-300"],[1,"bg-gray-50"],["scope","col",1,"py-3.5","pl-4","pr-3","text-left","text-sm","font-semibold","text-gray-900","sm:pl-6"],["scope","col",1,"px-3","py-3.5","text-left","text-sm","font-semibold","text-gray-900"],["scope","col",1,"relative","py-3.5","pl-3","pr-4","sm:pr-6"],[1,"sr-only"],[1,"divide-y","divide-gray-200","bg-white"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto","aria-labelledby","modal-title","role","dialog","aria-modal","true",4,"ngIf"],[3,"value"],[1,"whitespace-nowrap","py-4","pl-4","pr-3","text-sm","font-medium","text-gray-900","sm:pl-6"],[1,"whitespace-nowrap","px-3","py-4","text-sm","text-gray-500"],[1,"relative","whitespace-nowrap","py-4","pl-3","pr-4","text-right","text-sm","font-medium","sm:pr-6"],["title","Editar",1,"text-blue-600","hover:text-blue-900","mr-2","p-2","rounded-full","hover:bg-blue-50","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],["title","Desactivar",1,"text-red-600","hover:text-red-900","p-2","rounded-full","hover:bg-red-50","transition-all",3,"click"],["colspan","5",1,"px-6","py-12","text-center","text-gray-500"],[1,"flex","flex-col","items-center","justify-center"],[1,"h-12","w-12","text-gray-300","mb-3","opacity-50",3,"img"],[1,"text-base","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","items-end","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity",3,"click"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"relative","inline-block","align-bottom","bg-white","rounded-lg","px-4","pt-5","pb-4","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full","sm:p-6"],[1,"absolute","top-0","right-0","pt-4","pr-4"],["type","button",1,"bg-white","rounded-md","text-gray-400","hover:text-gray-500","focus:outline-none",3,"click"],[1,"w-6","h-6","rotate-45",3,"img"],[1,"sm:flex","sm:items-start","w-full"],[1,"mt-3","text-center","sm:mt-0","sm:text-left","w-full"],["id","modal-title",1,"text-lg","leading-6","font-medium","text-gray-900"],[1,"mt-4","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","text-left","mb-1"],[3,"selectionChanged","disabled"],[1,"grid","grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","text-left"],["type","number","min","0",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","px-3","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border",3,"ngModelChange","ngModel"],["type","number","step","5","min","5",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","px-3","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border",3,"ngModelChange","ngModel"],[1,"mt-5","sm:mt-4","sm:flex","sm:flex-row-reverse"],["type","button",1,"inline-flex","w-full","justify-center","rounded-md","border","border-transparent","bg-blue-600","px-4","py-2","text-base","font-medium","text-white","shadow-sm","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","sm:ml-3","sm:w-auto","sm:text-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","border","border-gray-300","bg-white","px-4","py-2","text-base","font-medium","text-gray-700","shadow-sm","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","sm:mt-0","sm:w-auto","sm:text-sm",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"Asignaci\xF3n de especialidades"),n(),o(5,"p",4),a(6,"Gestiona las especialidades asignadas a cada m\xE9dico, sus costos y duraciones."),n()(),o(7,"div",5)(8,"button",6),m("click",function(){return i.openAddModal()}),y(9,"lucide-icon",7),a(10," Nueva asignaci\xF3n "),n()()(),o(11,"div",8)(12,"div",9)(13,"div",10),y(14,"lucide-icon",11),n(),o(15,"input",12),m("ngModelChange",function(c){return i.searchTerm.set(c)}),n()(),o(16,"div")(17,"select",13),m("ngModelChange",function(c){return i.filterDoctorId.set(c)}),o(18,"option",14),a(19,"Todos los especialistas"),n(),h(20,Ce,2,2,"option",15),n()(),o(21,"div")(22,"select",13),m("ngModelChange",function(c){return i.filterSpecialtyId.set(c)}),o(23,"option",14),a(24,"Todas las especialidades"),n(),h(25,we,2,2,"option",15),n()()(),o(26,"div",16)(27,"div",17)(28,"div",18)(29,"div",19)(30,"table",20)(31,"thead",21)(32,"tr")(33,"th",22),a(34," Especialidad"),n(),o(35,"th",23),a(36," Especialista"),n(),o(37,"th",23),a(38,"Costo "),n(),o(39,"th",23),a(40," Duraci\xF3n"),n(),o(41,"th",24)(42,"span",25),a(43,"Acciones"),n()()()(),o(44,"tbody",26),h(45,Ie,14,6,"tr",27)(46,De,8,1,"tr",28),n()()()()()()(),h(47,Me,38,7,"div",29)),e&2&&(l(9),d("img",i.icons.Plus),l(5),d("img",i.icons.Search),l(),d("ngModel",i.searchTerm()),l(2),d("ngModel",i.filterDoctorId()),l(3),d("ngForOf",i.formattedDoctors()),l(2),d("ngModel",i.filterSpecialtyId()),l(3),d("ngForOf",i.specialties()),l(20),d("ngForOf",i.filteredAssociations()),l(),d("ngIf",i.filteredAssociations().length===0),l(),d("ngIf",i.isModalOpen()))},dependencies:[E,D,M,A,re,le,V,oe,ne,O,se,F,k,T,R,v],encapsulation:2})};export{de as DoctorSpecialtyComponent};
