import{a as O}from"./chunk-VXYXIBWZ.js";import{e as R,f as V}from"./chunk-OOPWGQAY.js";import{b as j,d as q,e as B,f as K,g as G,h as H,p as Y,r as z,s as J,u as Q}from"./chunk-IRX75LVQ.js";import"./chunk-MZ3EZVY4.js";import{$ as p,Ab as w,Ba as o,Bb as v,Ec as T,La as C,Md as W,Nd as D,Ra as E,Sc as A,Va as g,aa as u,ab as a,bb as n,cb as r,db as h,eb as S,fb as b,gd as N,hb as _,ib as f,ic as M,jb as l,jc as P,jd as F,kc as I,md as k,pc as L,ub as s,wb as y,zb as x}from"./chunk-4QQE477L.js";function X(e,i){e&1&&(n(0,"span"),s(1,"Recuperar Contrase\xF1a"),r())}function Z(e,i){e&1&&(n(0,"span"),s(1,"Ingresa el C\xF3digo"),r())}function $(e,i){e&1&&(n(0,"span"),s(1,"Nueva Contrase\xF1a"),r())}function ee(e,i){e&1&&(n(0,"span"),s(1,"Ingresa tu correo electr\xF3nico y te enviaremos un c\xF3digo de verificaci\xF3n."),r())}function te(e,i){e&1&&(n(0,"span"),s(1,"Ingresa el c\xF3digo de 6 d\xEDgitos que enviamos a tu correo."),r())}function ie(e,i){e&1&&(n(0,"span"),s(1,"Ingresa tu nueva contrase\xF1a para restablecer el acceso."),r())}function ne(e,i){if(e&1&&(n(0,"div",15)(1,"span",16),s(2,"\xA1\xC9xito!"),r(),s(3),r()),e&2){let t=l();o(3),y(" ",t.successMessage," ")}}function re(e,i){if(e&1&&(n(0,"div",17)(1,"span",16),s(2,"Error!"),r(),s(3),r()),e&2){let t=l();o(3),y(" ",t.errorMessage," ")}}function oe(e,i){e&1&&(n(0,"span"),s(1,"Enviar c\xF3digo"),r())}function ae(e,i){e&1&&(n(0,"span"),s(1,"Enviando..."),r())}function se(e,i){if(e&1){let t=_();n(0,"form",18),f("ngSubmit",function(){p(t);let c=l();return u(c.onSendEmail())}),n(1,"div")(2,"label",19),s(3,"Email"),r(),n(4,"input",20),v("ngModelChange",function(c){p(t);let m=l();return w(m.email,c)||(m.email=c),u(c)}),r()(),n(5,"button",21),g(6,oe,2,0,"span",22)(7,ae,2,0,"span",22),r()()}if(e&2){let t=l();o(4),x("ngModel",t.email),o(),a("disabled",t.isLoading),o(),a("ngIf",!t.isLoading),o(),a("ngIf",t.isLoading)}}function de(e,i){e&1&&(n(0,"span"),s(1,"Verificar c\xF3digo"),r())}function ce(e,i){e&1&&(n(0,"span"),s(1,"Verificando..."),r())}function le(e,i){if(e&1){let t=_();n(0,"form",18),f("ngSubmit",function(){p(t);let c=l();return u(c.onVerifyCode())}),n(1,"div")(2,"label",23),s(3,"C\xF3digo de Verificaci\xF3n"),r(),n(4,"input",24),v("ngModelChange",function(c){p(t);let m=l();return w(m.verificationCode,c)||(m.verificationCode=c),u(c)}),r()(),n(5,"button",21),g(6,de,2,0,"span",22)(7,ce,2,0,"span",22),r(),n(8,"div",25)(9,"button",26),f("click",function(){p(t);let c=l();return u(c.backToEmail())}),s(10," \xBFNo recibiste el c\xF3digo? Intentar de nuevo "),r()()()}if(e&2){let t=l();o(4),x("ngModel",t.verificationCode),o(),a("disabled",t.isLoading),o(),a("ngIf",!t.isLoading),o(),a("ngIf",t.isLoading)}}function me(e,i){e&1&&(n(0,"span"),s(1,"Cambiar Contrase\xF1a"),r())}function pe(e,i){e&1&&(n(0,"span"),s(1,"Cambiando..."),r())}function ue(e,i){if(e&1){let t=_();n(0,"form",18),f("ngSubmit",function(){p(t);let c=l();return u(c.onResetPassword())}),n(1,"div")(2,"label",27),s(3,"Nueva Contrase\xF1a"),r(),n(4,"input",28),v("ngModelChange",function(c){p(t);let m=l();return w(m.newPassword,c)||(m.newPassword=c),u(c)}),r()(),n(5,"button",21),g(6,me,2,0,"span",22)(7,pe,2,0,"span",22),r()()}if(e&2){let t=l();o(4),x("ngModel",t.newPassword),o(),a("disabled",t.isLoading),o(),a("ngIf",!t.isLoading),o(),a("ngIf",t.isLoading)}}var U=class e{constructor(i,t){this.router=i;this.authService=t}ArrowLeftIcon=T;MailIcon=k;LockIcon=F;CheckCircleIcon=A;KeyIcon=N;currentStep="EMAIL";email="";verificationCode="";newPassword="";isLoading=!1;errorMessage="";successMessage="";onSendEmail(){this.email&&(this.isLoading=!0,this.errorMessage="",this.authService.forgotPassword(this.email).subscribe({next:i=>{this.isLoading=!1,this.currentStep="CODE",this.successMessage=`Hemos enviado un c\xF3digo de verificaci\xF3n a ${this.email}`,i.code&&(console.log("DEV ONLY: Code is",i.code),this.verificationCode=i.code)},error:i=>{this.isLoading=!1,this.errorMessage="No se pudo enviar el correo. Int\xE9ntalo de nuevo.",console.error(i)}}))}onVerifyCode(){this.verificationCode&&(this.isLoading=!0,this.errorMessage="",this.successMessage="",this.authService.validateCode(this.email,this.verificationCode).subscribe({next:i=>{this.isLoading=!1,i.valid?(this.successMessage="C\xF3digo verificado correctamente.",this.currentStep="NEW_PASSWORD"):this.errorMessage="El c\xF3digo ingresado es incorrecto o ha expirado."},error:i=>{this.isLoading=!1,this.errorMessage="Error al verificar el c\xF3digo.",console.error(i)}}))}onResetPassword(){if(!this.newPassword||this.newPassword.length<6){this.errorMessage="La contrase\xF1a debe tener al menos 6 caracteres.";return}this.isLoading=!0,this.errorMessage="",this.authService.resetPassword(this.email,this.verificationCode,this.newPassword).subscribe({next:i=>{this.isLoading=!1,this.successMessage="Contrase\xF1a restablecida exitosamente. Redirigiendo al login...",setTimeout(()=>{this.router.navigate(["/auth/login"])},2e3)},error:i=>{this.isLoading=!1,this.errorMessage="No se pudo restablecer la contrase\xF1a.",console.error(i)}})}backToEmail(){this.currentStep="EMAIL",this.verificationCode="",this.errorMessage="",this.successMessage=""}static \u0275fac=function(t){return new(t||e)(C(R),C(O))};static \u0275cmp=E({type:e,selectors:[["app-recover-password"]],decls:24,vars:15,consts:[[1,"flex","flex-col","items-center","justify-center","w-full","px-4","py-8"],[1,"w-full","max-w-sm","bg-white","rounded-2xl","shadow-xl","p-8","border","border-gray-100"],[1,"flex","flex-col","items-center","mb-6"],[1,"w-12","h-12","bg-blue-100","rounded-full","flex","items-center","justify-center","text-blue-600","mb-4"],[1,"w-6","h-6",3,"img"],[1,"text-xl","font-bold","text-gray-900"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"text-gray-500","text-sm","mt-1","text-center"],["class","p-4 mb-6 text-sm text-green-700 bg-green-100 rounded-lg","role","alert",4,"ngIf"],["class","p-4 mb-6 text-sm text-red-700 bg-red-100 rounded-lg","role","alert",4,"ngIf"],["class","space-y-4",3,"ngSubmit",4,"ngIf"],[1,"mt-6","text-center"],["routerLink","/auth/login",1,"inline-flex","items-center","text-sm","font-medium","text-gray-500","hover:text-gray-900"],[1,"w-4","h-4","mr-2",3,"img"],["role","alert",1,"p-4","mb-6","text-sm","text-green-700","bg-green-100","rounded-lg"],[1,"font-medium"],["role","alert",1,"p-4","mb-6","text-sm","text-red-700","bg-red-100","rounded-lg"],[1,"space-y-4",3,"ngSubmit"],["for","email",1,"block","text-sm","font-medium","text-gray-700"],["type","email","id","email","name","email","required","","placeholder","tu@email.com",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500","sm:text-sm","border","p-2",3,"ngModelChange","ngModel"],["type","submit",1,"w-full","flex","justify-center","py-2","px-4","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[4,"ngIf"],["for","code",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","code","name","code","required","","placeholder","123456","maxlength","6",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500","sm:text-sm","border","p-2","text-center","tracking-widest","text-lg",3,"ngModelChange","ngModel"],[1,"text-center","mt-2"],["type","button",1,"text-sm","text-blue-600","hover:underline",3,"click"],["for","newPassword",1,"block","text-sm","font-medium","text-gray-700"],["type","password","id","newPassword","name","newPassword","required","","minlength","6","placeholder","******",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500","sm:text-sm","border","p-2",3,"ngModelChange","ngModel"]],template:function(t,d){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),h(4,"lucide-icon",4),r(),n(5,"h1",5),S(6,6),g(7,X,2,0,"span",7)(8,Z,2,0,"span",7)(9,$,2,0,"span",7),b(),r(),n(10,"p",8),S(11,6),g(12,ee,2,0,"span",7)(13,te,2,0,"span",7)(14,ie,2,0,"span",7),b(),r()(),g(15,ne,4,1,"div",9)(16,re,4,1,"div",10)(17,se,8,4,"form",11)(18,le,11,4,"form",11)(19,ue,8,4,"form",11),n(20,"div",12)(21,"a",13),h(22,"lucide-icon",14),s(23," Volver al inicio de sesi\xF3n "),r()()()()),t&2&&(o(4),a("img",d.currentStep==="EMAIL"?d.MailIcon:d.currentStep==="CODE"?d.LockIcon:d.KeyIcon),o(2),a("ngSwitch",d.currentStep),o(),a("ngSwitchCase","EMAIL"),o(),a("ngSwitchCase","CODE"),o(),a("ngSwitchCase","NEW_PASSWORD"),o(2),a("ngSwitch",d.currentStep),o(),a("ngSwitchCase","EMAIL"),o(),a("ngSwitchCase","CODE"),o(),a("ngSwitchCase","NEW_PASSWORD"),o(),a("ngIf",d.successMessage),o(),a("ngIf",d.errorMessage),o(),a("ngIf",d.currentStep==="EMAIL"),o(),a("ngIf",d.currentStep==="CODE"),o(),a("ngIf",d.currentStep==="NEW_PASSWORD"),o(3),a("img",d.ArrowLeftIcon))},dependencies:[L,M,P,I,Q,H,j,q,B,Y,z,J,G,K,V,D,W],encapsulation:2})};export{U as RecoverPasswordComponent};
