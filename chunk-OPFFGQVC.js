import{a as Y}from"./chunk-C26W6QIR.js";import{a as X}from"./chunk-IQCUBMRG.js";import{a as U}from"./chunk-EZCPFMFM.js";import{a as H}from"./chunk-LZP63J3R.js";import{a as Q}from"./chunk-JUTIX74D.js";import{b as $,c as B,f as q,i as z,j as J,k as G,o as K}from"./chunk-DOKJHZWU.js";import{a as R}from"./chunk-LGBSUADE.js";import"./chunk-MZ3EZVY4.js";import{$a as m,Bb as M,Ia as k,Ma as b,S as _,Ta as c,Tb as F,Ua as a,Ub as N,Uc as A,Va as o,Wa as v,X as u,Xb as O,Y as p,Za as S,_a as g,cd as L,ea as E,hb as l,ib as C,jb as I,jd as j,kb as V,kd as P,mb as w,nb as D,ob as T,ta as s,zc as W}from"./chunk-A3GKMUNS.js";function ee(d,t){if(d&1&&(a(0,"span",20),l(1),o()),d&2){let e=m();s(),I(" ",e.currentSchedules().length," turnos asignados ")}}function te(d,t){if(d&1){let e=S();a(0,"li",21)(1,"div",22)(2,"div",23),l(3),o(),a(4,"div")(5,"span",24),l(6),o(),a(7,"span",25),l(8),o()()(),a(9,"button",26),g("click",function(){let n=u(e).$implicit,r=m();return p(r.remove(n))}),v(10,"lucide-icon",27),o()()}if(d&2){let e=t.$implicit,i=m();s(3),I(" ",i.getScheduleDisplay(e)," "),s(3),V("",e.startTime," - ",e.endTime),s(2),C(i.getSpecialtyName(e.specialtyId)),s(2),c("img",i.icons.Trash2)}}function ie(d,t){if(d&1&&(a(0,"li",28),v(1,"lucide-icon",29),a(2,"p"),l(3,"Selecciona un especialista para ver y configurar sus horarios de atenci\xF3n."),o()()),d&2){let e=m();s(),c("img",e.icons.Clock)}}function ne(d,t){if(d&1){let e=S();a(0,"li",28)(1,"p"),l(2,"No hay turnos asignados para este especialista."),o(),a(3,"button",30),g("click",function(){u(e);let n=m();return p(n.openAddModal())}),l(4,"Agregar el primer turno"),o()()}}function oe(d,t){if(d&1&&(a(0,"option",57),l(1),o()),d&2){let e=t.$implicit;c("value",e.specialtyId),s(),C(e.name)}}function ae(d,t){if(d&1&&(a(0,"option",57),l(1),o()),d&2){let e=t.$implicit;c("value",e),s(),C(e)}}function re(d,t){if(d&1){let e=S();a(0,"div",31)(1,"div",32)(2,"div",33),g("click",function(){u(e);let n=m();return p(n.closeModal())}),o(),a(3,"span",34),l(4,"\u200B"),o(),a(5,"div",35)(6,"div",36)(7,"button",37),g("click",function(){u(e);let n=m();return p(n.closeModal())}),a(8,"span",38),l(9,"Cerrar"),o(),v(10,"lucide-icon",39),o()(),a(11,"div",40)(12,"div",41),v(13,"lucide-icon",42),o(),a(14,"div",43)(15,"h3",44),l(16,"Asignar turno de atenci\xF3n"),o(),a(17,"div",45)(18,"div")(19,"label",46),l(20,"Fecha del turno"),o(),a(21,"input",47),T("ngModelChange",function(n){u(e);let r=m();return D(r.modalData.date,n)||(r.modalData.date=n),p(n)}),g("ngModelChange",function(n){u(e);let r=m();return p(r.onDateChange(n))}),o()(),a(22,"div")(23,"label",46),l(24,"Especialidad"),o(),a(25,"select",48),g("ngModelChange",function(n){u(e);let r=m();return p(r.onSpecialtyChange(n))}),b(26,oe,2,2,"option",49),o()(),a(27,"div",50)(28,"div")(29,"label",46),l(30,"Hora inicio"),o(),a(31,"input",51),T("ngModelChange",function(n){u(e);let r=m();return D(r.modalData.startTime,n)||(r.modalData.startTime=n),p(n)}),g("ngModelChange",function(){u(e);let n=m();return p(n.onStartTimeChange())}),o()(),a(32,"div")(33,"label",46),l(34,"Hora fin"),o(),a(35,"select",52),T("ngModelChange",function(n){u(e);let r=m();return D(r.modalData.endTime,n)||(r.modalData.endTime=n),p(n)}),b(36,ae,2,2,"option",49),o(),a(37,"p",53),l(38,"Seg\xFAn duraci\xF3n de cita"),o()()()()()(),a(39,"div",54)(40,"button",55),g("click",function(){u(e);let n=m();return p(n.saveSchedule())}),l(41," Guardar turno "),o(),a(42,"button",56),g("click",function(){u(e);let n=m();return p(n.closeModal())}),l(43," Cancelar "),o()()()()()}if(d&2){let e=m();s(10),c("img",e.icons.Plus),s(3),c("img",e.icons.Clock),s(8),w("ngModel",e.modalData.date),s(4),c("ngModel",e.modalData.specialtyId),s(),c("ngForOf",e.availableSpecialtiesForDoctor),s(5),w("ngModel",e.modalData.startTime),s(4),w("ngModel",e.modalData.endTime),s(),c("ngForOf",e.validEndTimes())}}var Z=class d{scheduleService=_(Y);doctorService=_(R);specialtyService=_(Q);associationService=_(U);confirmService=_(H);icons={Clock:W,Plus:A,Trash2:L};doctors=M(()=>{let t=this.doctorService.doctors(),e=this.associationService.associations();return t.filter(i=>e.some(n=>n.doctorId===i.id))});selectedDoctorId=E("");currentSchedules=M(()=>{let t=this.selectedDoctorId();return t?this.scheduleService.schedules().filter(i=>i.doctorId===t):[]});weekDays=M(()=>{let t=new Date,e=t.getDay(),i=t.getDate()-e+(e===0?-6:1),n=new Date(t.setDate(i)),r=[],h=["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"];for(let x=1;x<=6;x++){let y=new Date(n);y.setDate(n.getDate()+(x-1)),r.push({id:x,name:h[x],dateLabel:y.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})})}let f=new Date(n);return f.setDate(n.getDate()+6),r.push({id:0,name:h[0],dateLabel:f.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}),r});isModalOpen=!1;modalData={dayOfWeek:1,date:"",startTime:"09:00",endTime:"",specialtyId:""};viewMode="list";get availableSpecialtiesForDoctor(){let t=this.selectedDoctorId();return t?this.associationService.getSpecialtiesForDoctor(t).map(i=>this.specialtyService.specialties().find(n=>n.specialtyId===i.specialtyId)).filter(i=>!!i):[]}getDayName(t){return[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Mi\xE9rcoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"S\xE1bado"},{id:0,name:"Domingo"}].find(i=>i.id===t)?.name||"Desconocido"}getSpecialtyName(t){return this.specialtyService.specialties().find(e=>e.specialtyId===t)?.name||""}onDateChange(t){if(t){let e=new Date(t),[i,n,r]=t.split("-").map(Number),h=new Date(i,n-1,r);this.modalData.dayOfWeek=h.getDay()}}getScheduleDisplay(t){if(t.date){let[e,i,n]=t.date.split("-").map(Number),r=new Date(e,i-1,n);return`${this.getDayName(r.getDay())} ${n}/${i}/${e}`}return`Todos los ${this.getDayName(t.dayOfWeek)}s`}validEndTimes=E([]);updateValidEndTimes(){let t=this.selectedDoctorId(),e=this.modalData.specialtyId,i=this.modalData.startTime;if(!t||!e||!i){this.validEndTimes.set([]);return}let r=this.associationService.associations().find(y=>y.doctorId===t&&y.specialtyId===e)?.durationMinutes||30,h=[],f=this.dateFromTime(i),x=new Date(f);x.setHours(23,59,0,0),f.setMinutes(f.getMinutes()+r);for(let y=0;y<16&&!(f>x);y++)h.push(this.timeFromDate(f)),f.setMinutes(f.getMinutes()+r);this.validEndTimes.set(h),h.includes(this.modalData.endTime)||(this.modalData.endTime=h[0])}dateFromTime(t){let[e,i]=t.split(":").map(Number),n=new Date;return n.setHours(e,i,0,0),n}timeFromDate(t){return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}onStartTimeChange(){this.updateValidEndTimes()}onSpecialtyChange(t){this.modalData.specialtyId=t,this.updateValidEndTimes()}openAddModal(){if(!this.selectedDoctorId())return;let t=this.availableSpecialtiesForDoctor[0]?.specialtyId||"",e=new Date().toISOString().split("T")[0];this.modalData={dayOfWeek:new Date().getDay(),date:e,startTime:"09:00",endTime:"",specialtyId:t},this.updateValidEndTimes(),this.isModalOpen=!0}saveSchedule(){let t=this.selectedDoctorId();if(t&&this.modalData.specialtyId&&this.modalData.endTime){let e={doctorId:t,specialtyId:this.modalData.specialtyId,dayOfWeek:this.modalData.dayOfWeek,date:this.modalData.date,startTime:this.modalData.startTime,endTime:this.modalData.endTime};this.scheduleService.addSchedule(t,[e]).subscribe({next:()=>{this.closeModal()},error:i=>{console.error("Error saving schedule",i),alert("Error al guardar el turno. Verifique los datos.")}})}}closeModal(){this.isModalOpen=!1}async remove(t){await this.confirmService.confirm({title:"Eliminar Turno",message:"\xBFEst\xE1s seguro de que deseas eliminar este turno de atenci\xF3n?",confirmText:"Eliminar",cancelText:"Cancelar"})&&this.scheduleService.removeSchedule(t)}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=k({type:d,selectors:[["app-schedule-config"]],decls:26,vars:7,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-700"],[1,"flex","flex-col","gap-8","h-[calc(100vh-140px)]"],[1,"bg-white","shadow","rounded-lg","p-6","border","border-gray-100","flex","flex-col","sm:flex-row","sm:items-center","gap-6"],[1,"flex-1","w-full"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"selectionChanged"],[1,"flex-none","pt-0","sm:pt-6","w-full","sm:w-auto"],[1,"inline-flex","w-full","sm:w-auto","items-center","justify-center","px-4","py-2","border","border-transparent","text-sm","font-medium","rounded-md","shadow-sm","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-4","h-4","mr-2",3,"img"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","border","border-gray-100","flex-1","overflow-y-auto"],[1,"px-6","py-4","border-b","border-gray-200","bg-gray-50","flex","justify-between","items-center"],[1,"text-lg","font-medium","leading-6","text-gray-900"],["class","text-sm text-gray-500",4,"ngIf"],["role","list",1,"divide-y","divide-gray-200"],["class","px-6 py-4 hover:bg-gray-50 flex justify-between items-center transition-colors",4,"ngFor","ngForOf"],["class","px-6 py-12 text-center text-gray-400",4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto","aria-labelledby","modal-title","role","dialog","aria-modal","true",4,"ngIf"],[1,"text-sm","text-gray-500"],[1,"px-6","py-4","hover:bg-gray-50","flex","justify-between","items-center","transition-colors"],[1,"flex","items-center","gap-4"],[1,"bg-blue-100","p-2","rounded-lg","text-blue-600","font-bold","w-32","text-center","text-sm"],[1,"text-gray-900","font-medium","text-lg","block"],[1,"block","text-sm","text-gray-500"],["title","Eliminar turno",1,"text-gray-400","hover:text-red-600","p-2","rounded-full","hover:bg-red-50","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],[1,"px-6","py-12","text-center","text-gray-400"],[1,"w-12","h-12","mx-auto","mb-3","opacity-20",3,"img"],[1,"mt-2","text-blue-600","hover:underline","font-medium",3,"click"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","items-end","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity",3,"click"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"relative","inline-block","align-bottom","bg-white","rounded-lg","px-4","pt-5","pb-4","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full","sm:p-6"],[1,"absolute","top-0","right-0","pt-4","pr-4"],["type","button",1,"bg-white","rounded-md","text-gray-400","hover:text-gray-500","focus:outline-none",3,"click"],[1,"sr-only"],[1,"w-6","h-6","rotate-45",3,"img"],[1,"sm:flex","sm:items-start"],[1,"mx-auto","flex-shrink-0","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-blue-100","sm:mx-0","sm:h-10","sm:w-10"],[1,"h-6","w-6","text-blue-600",3,"img"],[1,"mt-3","text-center","sm:mt-0","sm:ml-4","sm:text-left","w-full"],["id","modal-title",1,"text-lg","leading-6","font-medium","text-gray-900"],[1,"mt-4","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700"],["type","date",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"grid","grid-cols-2","gap-4"],["type","time",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border","bg-white",3,"ngModelChange","ngModel"],[1,"mt-1","text-xs","text-gray-500"],[1,"mt-5","sm:mt-4","sm:flex","sm:flex-row-reverse"],["type","button",1,"w-full","inline-flex","justify-center","rounded-md","border","border-transparent","shadow-sm","px-4","py-2","bg-blue-600","text-base","font-medium","text-white","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:ml-3","sm:w-auto","sm:text-sm",3,"click"],["type","button",1,"mt-3","w-full","inline-flex","justify-center","rounded-md","border","border-gray-300","shadow-sm","px-4","py-2","bg-white","text-base","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:mt-0","sm:w-auto","sm:text-sm",3,"click"],[3,"value"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h1",2),l(3,"Turnos de atenci\xF3n"),o(),a(4,"p",3),l(5,"Define los d\xEDas y horas de atenci\xF3n por especialista y especialidad."),o()(),a(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),l(10,"Seleccionar especialista"),o(),a(11,"app-doctor-selector",8),g("selectionChanged",function(r){return i.selectedDoctorId.set(r)}),o()(),a(12,"div",9)(13,"button",10),g("click",function(){return i.openAddModal()}),v(14,"lucide-icon",11),l(15," Agregar turno "),o()()(),a(16,"div",12)(17,"div",13)(18,"h3",14),l(19,"Horarios configurados"),o(),b(20,ee,2,1,"span",15),o(),a(21,"ul",16),b(22,te,11,5,"li",17)(23,ie,4,1,"li",18)(24,ne,5,0,"li",18),o()()(),b(25,re,44,8,"div",19),o()),e&2&&(s(13),c("disabled",!i.selectedDoctorId()),s(),c("img",i.icons.Plus),s(6),c("ngIf",i.selectedDoctorId()),s(2),c("ngForOf",i.currentSchedules()),s(),c("ngIf",!i.selectedDoctorId()),s(),c("ngIf",i.selectedDoctorId()&&i.currentSchedules().length===0),s(),c("ngIf",i.isModalOpen))},dependencies:[O,F,N,K,J,G,$,z,B,q,P,j,X],encapsulation:2})};export{Z as ScheduleConfigComponent};
