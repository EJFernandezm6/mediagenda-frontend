import{a as l}from"./chunk-MZ3EZVY4.js";import{Dc as o,Ec as A,N as a,R as d,W as c,a as s,b as r,ia as h}from"./chunk-2BMW4ZRB.js";var u=class m{http=c(A);apiUrl=`${l.apiUrl}/appointments`;appointments=h([]);pendingAppointments=h([]);normalizeTime(t){return t&&t.length>5?t.substring(0,5):t}normalizeAppointment(t){return r(s({},t),{startTime:this.normalizeTime(t.startTime),endTime:this.normalizeTime(t.endTime)})}refreshAppointmentsByRange(t,n){let i=new o().set("from",t).set("to",n);this.http.get(`${this.apiUrl}/range`,{params:i}).subscribe(e=>{this.appointments.set(e.map(p=>this.normalizeAppointment(p)))})}getAppointmentsRange(t,n){let i=new o().set("from",t).set("to",n);return this.http.get(`${this.apiUrl}/range`,{params:i}).pipe(a(e=>e.map(p=>this.normalizeAppointment(p))))}getAppointmentById(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(a(n=>{this.appointments.update(i=>{let e=i.findIndex(p=>p.appointmentId===n.appointmentId);if(e!==-1){let p=[...i];return p[e]=this.normalizeAppointment(n),p}return i})}))}fetchPendingAppointments(){let t=new o().set("paymentStatus","PENDING");this.http.get(`${this.apiUrl}`,{params:t}).subscribe({next:n=>{let i=n.filter(e=>e.paymentStatus==="PENDING"&&["YAPE","PLIN","CASH"].includes(e.paymentMethod||"")).map(e=>this.normalizeAppointment(e));this.pendingAppointments.set(i)},error:()=>{console.warn("Failed to fetch pending appointments")}})}addAppointment(t){return this.http.post(this.apiUrl,t).pipe(a(n=>{this.appointments.update(i=>[...i,this.normalizeAppointment(n)]),this.fetchPendingAppointments()}))}updatestatus(t,n){this.http.patch(`${this.apiUrl}/${t}/status`,{status:n}).subscribe(()=>{this.appointments.update(i=>i.map(e=>e.appointmentId===t?r(s({},e),{status:n}):e)),this.fetchPendingAppointments()})}updatePayment(t,n,i,e){let p={paymentMethod:n,paymentStatus:i,transactionId:e};this.http.patch(`${this.apiUrl}/${t}/payment`,p).subscribe(()=>{this.appointments.update(f=>f.map(g=>g.appointmentId===t?r(s({},g),{paymentStatus:i,paymentMethod:n}):g)),this.fetchPendingAppointments()})}cancelAppointment(t){this.updatestatus(t,"CANCELLED")}static \u0275fac=function(n){return new(n||m)};static \u0275prov=d({token:m,factory:m.\u0275fac,providedIn:"root"})};export{u as a};
