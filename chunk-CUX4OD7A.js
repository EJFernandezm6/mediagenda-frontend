import{e as c}from"./chunk-MOZS2QOH.js";import{a as u}from"./chunk-MZ3EZVY4.js";import{N as o,R as s,W as i,ia as n,xc as l}from"./chunk-5ZAWVRKT.js";var g=class a{http=i(l);router=i(c);apiUrl=`${u.apiUrl}/iam/auth`;currentUser=n(null);constructor(){this.restoreSession()}login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(o(t=>{let r={id:t.userId,fullName:t.fullName||"",email:t.email,roles:[],photoUrl:`https://ui-avatars.com/api/?name=${t.email}&background=0D8ABC&color=fff`,subscriptionStatus:"ACTIVE",clinicId:t.clinicId,roleId:t.roleId,active:t.active!==void 0?t.active:!0,features:t.features??[]};if(r.active===!1)throw{status:403,message:"Usuario inactivo. Contacte al administrador."};if(!r.features||r.features.length===0)throw{status:403,code:"NO_FEATURES",message:"No tiene m\xF3dulos asignados. Contacte al administrador."};this.currentUser.set(r),localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(r)),this.router.navigate(["/app/dashboard"])}))}forgotPassword(e){return this.http.post(`${this.apiUrl}/forgot-password`,{email:e})}validateCode(e,t){return this.http.post(`${this.apiUrl}/validate-code`,{email:e,code:t})}resetPassword(e,t,r){return this.http.post(`${this.apiUrl}/reset-password`,{email:e,code:t,newPassword:r})}logout(){this.currentUser.set(null),localStorage.removeItem("user"),localStorage.removeItem("token"),this.router.navigate(["/auth/login"])}restoreSession(){let e=localStorage.getItem("user"),t=localStorage.getItem("token");e&&t&&this.currentUser.set(JSON.parse(e))}static \u0275fac=function(t){return new(t||a)};static \u0275prov=s({token:a,factory:a.\u0275fac,providedIn:"root"})};export{g as a};
