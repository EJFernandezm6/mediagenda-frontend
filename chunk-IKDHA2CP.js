import{a as ae}from"./chunk-MOKWQR56.js";import{b as X,c as Z,d as ee,f as te,g as ne,h as ie,j as oe}from"./chunk-RWTD4LR5.js";import{a as Q}from"./chunk-BDBARYAH.js";import{a as re}from"./chunk-FMLYNP3Z.js";import{a as le}from"./chunk-LZBZD3P5.js";import{Ab as V,Bb as W,Cb as j,Db as H,Eb as R,Fb as B,Ga as N,Ka as m,N as k,Pb as $,Qa as p,Ra as a,Rb as G,S as y,Sa as o,Sb as Y,Ta as _,Tb as U,Ua as T,Va as O,Wa as A,X as u,Xa as f,Y as g,Ya as c,a as E,b as M,db as d,eb as v,ec as z,fa as b,fb as I,gb as F,hb as L,ib as C,jb as w,kb as S,lc as q,oc as J,pb as P,pc as K,ta as l}from"./chunk-GRSUPIB2.js";var D=class r{mockAppointments=[{id:"a1",doctorId:"d1",specialtyId:"1",patientId:"p1",patientName:"Ana Garc\xEDa",date:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"09:30",status:"CONFIRMED",notes:"Consulta rutinaria",paymentMethod:"YAPE",paymentStatus:"PAID",transactionId:"123456"},{id:"a2",doctorId:"d1",specialtyId:"1",patientId:"p2",patientName:"Luis Torres",date:new Date().toISOString().split("T")[0],startTime:"10:00",endTime:"10:30",status:"CONFIRMED"}];appointments=b(this.mockAppointments);getAppointments(){return this.appointments()}getAppointmentsForDateRange(i,e,t){return this.appointments().filter(n=>n.date>=i&&n.date<=e&&n.doctorId===t)}addAppointment(i){let e=M(E({},i),{id:Math.random().toString(36).substr(2,9),status:"SCHEDULED"});this.appointments.update(t=>[...t,e])}updatestatus(i,e){this.appointments.update(t=>t.map(n=>n.id===i?M(E({},n),{status:e}):n))}cancelAppointment(i){this.updatestatus(i,"CANCELLED")}static \u0275fac=function(e){return new(e||r)};static \u0275prov=k({token:r,factory:r.\u0275fac,providedIn:"root"})};function pe(r,i){if(r&1&&(a(0,"option",16),d(1),o()),r&2){let e=i.$implicit;p("value",e.id),l(),v(e.fullName)}}function ce(r,i){if(r&1&&(a(0,"option",16),d(1),o()),r&2){let e=i.$implicit;p("value",e.id),l(),v(e.name)}}function me(r,i){if(r&1&&(a(0,"div",17),_(1,"lucide-icon",18),a(2,"p",19),d(3,"Selecciona un M\xE9dico y una Especialidad"),o(),a(4,"p",20),d(5,"Para ver la disponibilidad y agendar citas."),o()()),r&2){let e=c();l(),p("img",e.icons.Calendar)}}function ue(r,i){if(r&1&&(a(0,"div",26)(1,"p",27),d(2),o(),a(3,"p",28),d(4),o()()),r&2){let e=i.$implicit;l(2),v(e.dayName),l(2),v(e.dayNum)}}function ge(r,i){if(r&1){let e=A();a(0,"button",37),f("click",function(){u(e);let n=c().$implicit,s=c().$implicit,h=c(2);return g(h.openBookingModal(n.iso,s))}),_(1,"lucide-icon",10),o()}if(r&2){let e=c(4);l(),p("img",e.icons.Plus)}}function fe(r,i){if(r&1&&(a(0,"div",38)(1,"p",39),d(2),o(),a(3,"p",40),d(4),o()()),r&2){let e,t,n=c().$implicit,s=c().$implicit,h=c(2);l(2),v((e=h.getAppointment(n.iso,s))==null?null:e.patientName),l(2),v((t=h.getAppointment(n.iso,s))==null?null:t.status)}}function xe(r,i){r&1&&_(0,"div",41)}function _e(r,i){if(r&1&&(a(0,"div",32),T(1,33),m(2,ge,2,1,"button",34)(3,fe,5,2,"div",35)(4,xe,1,0,"div",36),O(),o()),r&2){let e=i.$implicit,t=i.index,n=c().$implicit,s=c(2);l(),p("ngSwitch",s.getSlotStatus(e.iso,n,t)),l(),p("ngSwitchCase","available"),l(),p("ngSwitchCase","booked")}}function ve(r,i){if(r&1&&(a(0,"div",29)(1,"div",30),d(2),o(),m(3,_e,5,3,"div",31),o()),r&2){let e=i.$implicit,t=c(2);l(2),I(" ",e," "),l(),p("ngForOf",t.weekDays())}}function ye(r,i){if(r&1&&(a(0,"div",21)(1,"div",22)(2,"div",23),d(3," Hora"),o(),m(4,ue,5,2,"div",24),o(),m(5,ve,4,2,"div",25),o()),r&2){let e=c();l(4),p("ngForOf",e.weekDays()),l(),p("ngForOf",e.timeSlots)}}function be(r,i){if(r&1&&(a(0,"option",16),d(1),o()),r&2){let e=i.$implicit;p("value",e.id),l(),F("",e.fullName," (",e.dni,")")}}function he(r,i){if(r&1){let e=A();a(0,"div")(1,"label",52),d(2,"ID de Transacci\xF3n / Comprobante"),o(),a(3,"input",63),S("ngModelChange",function(n){u(e);let s=c(2);return w(s.newApp.transactionId,n)||(s.newApp.transactionId=n),g(n)}),o()()}if(r&2){let e=c(2);l(3),C("ngModel",e.newApp.transactionId)}}function Ce(r,i){if(r&1){let e=A();a(0,"div",42)(1,"div",43)(2,"div",44),f("click",function(){u(e);let n=c();return g(n.closeModal())}),o(),a(3,"div",45)(4,"div",46)(5,"h3",47),_(6,"lucide-icon",10),d(7," Agendar Cita "),o()(),a(8,"div",48)(9,"div",49)(10,"p",50)(11,"strong"),d(12,"Fecha:"),o(),d(13),_(14,"br"),a(15,"strong"),d(16,"Hora:"),o(),d(17),o()(),a(18,"div",51)(19,"div")(20,"label",52),d(21,"Paciente"),o(),a(22,"select",53),S("ngModelChange",function(n){u(e);let s=c();return w(s.newApp.patientId,n)||(s.newApp.patientId=n),g(n)}),a(23,"option",6),d(24,"Seleccionar paciente"),o(),m(25,be,2,3,"option",7),o()(),a(26,"div")(27,"label",52),d(28,"M\xE9todo de Pago"),o(),a(29,"select",53),S("ngModelChange",function(n){u(e);let s=c();return w(s.newApp.paymentMethod,n)||(s.newApp.paymentMethod=n),g(n)}),a(30,"option",54),d(31,"Efectivo (En Cl\xEDnica)"),o(),a(32,"option",55),d(33,"Yape"),o(),a(34,"option",56),d(35,"Plin"),o(),a(36,"option",57),d(37,"Tarjeta de Cr\xE9dito"),o()()(),m(38,he,4,1,"div",58),a(39,"div")(40,"label",52),d(41,"Notas / Motivo"),o(),a(42,"textarea",59),S("ngModelChange",function(n){u(e);let s=c();return w(s.newApp.notes,n)||(s.newApp.notes=n),g(n)}),o()()()(),a(43,"div",60)(44,"button",61),f("click",function(){u(e);let n=c();return g(n.saveAppointment())}),d(45,"Confirmar Cita"),o(),a(46,"button",62),f("click",function(){u(e);let n=c();return g(n.closeModal())}),d(47,"Cancelar"),o()()()()()}if(r&2){let e=c();l(6),p("img",e.icons.Calendar),l(7),I(" ",e.selectedSlot==null?null:e.selectedSlot.date," "),l(4),I(" ",e.selectedSlot==null?null:e.selectedSlot.time," "),l(5),C("ngModel",e.newApp.patientId),l(3),p("ngForOf",e.patients()),l(4),C("ngModel",e.newApp.paymentMethod),l(9),p("ngIf",e.newApp.paymentMethod!=="CASH"),l(4),C("ngModel",e.newApp.notes),l(2),p("disabled",!e.newApp.patientId)}}var de=class r{appointmentsService=y(D);doctorService=y(re);specialtyService=y(Q);scheduleService=y(ae);patientsService=y(le);icons={ChevronLeft:G,ChevronRight:Y,Calendar:$,User:q,Clock:U,Plus:z};doctors=this.doctorService.doctors;specialties=this.specialtyService.specialties;patients=this.patientsService.patients;appointments=this.appointmentsService.appointments;selectedDoctorId=b("");selectedSpecialtyId=b("");currentDate=b(new Date);isModalOpen=!1;selectedSlot=null;newApp={patientId:"",notes:"",paymentMethod:"CASH",transactionId:""};weekDays=P(()=>{let i=this.getStartOfWeek(this.currentDate()),e=[];for(let t=0;t<7;t++){let n=new Date(i);n.setDate(i.getDate()+t),e.push({date:n,iso:n.toISOString().split("T")[0],dayName:n.toLocaleDateString("es-ES",{weekday:"short"}),dayNum:n.getDate()})}return e});timeSlots=Array.from({length:13},(i,e)=>`${(e+8).toString().padStart(2,"0")}:00`);getStartOfWeek(i){let e=new Date(i),t=e.getDay(),n=e.getDate()-t+(t===0?-6:1);return new Date(e.setDate(n))}changeWeek(i){let e=new Date(this.currentDate());e.setDate(e.getDate()+i*7),this.currentDate.set(e)}getSlotStatus(i,e,t){if(!this.selectedDoctorId()||!this.selectedSpecialtyId())return"unavailable";let n=new Date(i).getDay();return this.scheduleService.getSchedulesForDoctor(this.selectedDoctorId(),this.selectedSpecialtyId()).find(x=>x.dayOfWeek===n&&e>=x.startTime&&e<x.endTime)?this.appointments().find(x=>x.doctorId===this.selectedDoctorId()&&x.date===i&&x.startTime===e&&x.status!=="CANCELLED")?"booked":"available":"unavailable"}getAppointment(i,e){return this.appointments().find(t=>t.doctorId===this.selectedDoctorId()&&t.date===i&&t.startTime===e&&t.status!=="CANCELLED")}openBookingModal(i,e){this.selectedSlot={date:i,time:e},this.newApp={patientId:"",notes:"",paymentMethod:"CASH",transactionId:""},this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}saveAppointment(){if(this.selectedSlot&&this.newApp.patientId){let i=this.patients().find(e=>e.id===this.newApp.patientId);this.appointmentsService.addAppointment({doctorId:this.selectedDoctorId(),specialtyId:this.selectedSpecialtyId(),patientId:this.newApp.patientId,patientName:i?.fullName||"Desconocido",date:this.selectedSlot.date,startTime:this.selectedSlot.time,endTime:this.addMinutes(this.selectedSlot.time,30),notes:this.newApp.notes,paymentMethod:this.newApp.paymentMethod,paymentStatus:this.newApp.paymentMethod==="CASH"?"PENDING":"PAID",transactionId:this.newApp.transactionId}),this.closeModal()}}addMinutes(i,e){let[t,n]=i.split(":").map(Number),s=new Date;return s.setHours(t,n+e),`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=N({type:r,selectors:[["app-appointments-calendar"]],decls:27,vars:13,consts:[[1,"h-full","flex","flex-col"],[1,"bg-white","border-b","border-gray-200","px-6","py-4","flex","flex-col","md:flex-row","md:items-center","justify-between","gap-4"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-3"],[1,"block","w-48","rounded-md","border-gray-300","py-1.5","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","border","px-2",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"flex","items-center","bg-gray-100","rounded-lg","p-1"],[1,"p-1","hover:bg-white","hover:shadow","rounded-md","transition-all","text-gray-600",3,"click"],[1,"w-5","h-5",3,"img"],[1,"px-3","text-sm","font-medium","text-gray-900","min-w-[140px]","text-center"],[1,"flex-1","overflow-auto","bg-gray-50","p-6"],["class","h-full flex flex-col items-center justify-center text-gray-400",4,"ngIf"],["class","bg-white rounded-xl shadow border border-gray-200 overflow-hidden min-w-[800px]",4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto",4,"ngIf"],[3,"value"],[1,"h-full","flex","flex-col","items-center","justify-center","text-gray-400"],[1,"w-16","h-16","mb-4","opacity-50",3,"img"],[1,"text-lg","font-medium"],[1,"text-sm"],[1,"bg-white","rounded-xl","shadow","border","border-gray-200","overflow-hidden","min-w-[800px]"],[1,"grid","grid-cols-8","border-b","border-gray-200","bg-gray-50"],[1,"p-4","text-xs","font-semibold","text-gray-400","uppercase","tracking-wider","text-center","border-r","border-gray-200"],["class","p-4 text-center border-r border-gray-200 last:border-r-0",4,"ngFor","ngForOf"],["class","grid grid-cols-8 border-b border-gray-100 last:border-b-0 h-20",4,"ngFor","ngForOf"],[1,"p-4","text-center","border-r","border-gray-200","last:border-r-0"],[1,"text-xs","font-semibold","text-gray-500","uppercase"],[1,"text-lg","font-bold","text-gray-900"],[1,"grid","grid-cols-8","border-b","border-gray-100","last:border-b-0","h-20"],[1,"p-2","text-xs","font-medium","text-gray-500","text-center","border-r","border-gray-100","flex","items-center","justify-center","bg-gray-50/50"],["class","border-r border-gray-100 last:border-r-0 relative group p-1",4,"ngFor","ngForOf"],[1,"border-r","border-gray-100","last:border-r-0","relative","group","p-1"],[3,"ngSwitch"],["class","w-full h-full rounded-lg border-2 border-dashed border-gray-200 hover:border-blue-400 hover:bg-blue-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all text-blue-600",3,"click",4,"ngSwitchCase"],["class","w-full h-full bg-blue-100 border-l-4 border-blue-600 rounded p-2 overflow-hidden hover:shadow-md transition-shadow cursor-pointer",4,"ngSwitchCase"],["class","w-full h-full bg-gray-50/30",4,"ngSwitchDefault"],[1,"w-full","h-full","rounded-lg","border-2","border-dashed","border-gray-200","hover:border-blue-400","hover:bg-blue-50","flex","items-center","justify-center","opacity-0","group-hover:opacity-100","transition-all","text-blue-600",3,"click"],[1,"w-full","h-full","bg-blue-100","border-l-4","border-blue-600","rounded","p-2","overflow-hidden","hover:shadow-md","transition-shadow","cursor-pointer"],[1,"text-xs","font-bold","text-blue-800","truncate"],[1,"text-[10px]","text-blue-600","truncate","mt-0.5"],[1,"w-full","h-full","bg-gray-50/30"],[1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","min-h-full","items-end","justify-center","p-4","text-center","sm:items-center","sm:p-0"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","transition-opacity",3,"click"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg"],[1,"bg-blue-600","px-4","py-3","sm:px-6"],[1,"text-base","font-semibold","leading-6","text-white","flex","items-center","gap-2"],[1,"px-4","py-5","sm:p-6"],[1,"mb-4","bg-blue-50","p-3","rounded-md","border","border-blue-100"],[1,"text-sm","text-blue-800"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","border","px-2","shadow-sm","focus:border-blue-500","focus:ring-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],["value","CASH"],["value","YAPE"],["value","PLIN"],["value","CARD"],[4,"ngIf"],["rows","3",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","border","px-2","shadow-sm","focus:border-blue-500","focus:ring-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"bg-gray-50","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"inline-flex","w-full","justify-center","rounded-md","bg-blue-600","px-3","py-2","text-sm","font-semibold","text-white","shadow-sm","hover:bg-blue-500","sm:ml-3","sm:w-auto","disabled:opacity-50",3,"click","disabled"],["type","button",1,"mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","px-3","py-2","text-sm","font-semibold","text-gray-900","shadow-sm","ring-1","ring-inset","ring-gray-300","hover:bg-gray-50","sm:mt-0","sm:w-auto",3,"click"],["type","text","placeholder","Ej: 12345678",1,"mt-1","block","w-full","rounded-md","border-gray-300","py-2","border","px-2","shadow-sm","focus:border-blue-500","focus:ring-blue-500","sm:text-sm",3,"ngModelChange","ngModel"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),d(4,"Agenda de Citas"),o(),a(5,"p",3),d(6,"Gestiona los turnos y citas m\xE9dicas."),o()(),a(7,"div",4)(8,"select",5),f("ngModelChange",function(s){return t.selectedDoctorId.set(s)}),a(9,"option",6),d(10,"Filtrar por M\xE9dico"),o(),m(11,pe,2,2,"option",7),o(),a(12,"select",5),f("ngModelChange",function(s){return t.selectedSpecialtyId.set(s)}),a(13,"option",6),d(14,"Filtrar por Especialidad"),o(),m(15,ce,2,2,"option",7),o()(),a(16,"div",8)(17,"button",9),f("click",function(){return t.changeWeek(-1)}),_(18,"lucide-icon",10),o(),a(19,"span",11),d(20),o(),a(21,"button",9),f("click",function(){return t.changeWeek(1)}),_(22,"lucide-icon",10),o()()(),a(23,"div",12),m(24,me,6,1,"div",13)(25,ye,6,2,"div",14),o()(),m(26,Ce,48,9,"div",15)),e&2&&(l(8),p("ngModel",t.selectedDoctorId()),l(3),p("ngForOf",t.doctors()),l(),p("ngModel",t.selectedSpecialtyId()),l(3),p("ngForOf",t.specialties()),l(3),p("img",t.icons.ChevronLeft),l(2),L(" ",t.weekDays()[0].dayName," ",t.weekDays()[0].dayNum," - ",t.weekDays()[6].dayName," ",t.weekDays()[6].dayNum," "),l(2),p("img",t.icons.ChevronRight),l(2),p("ngIf",!t.selectedDoctorId()||!t.selectedSpecialtyId()),l(),p("ngIf",t.selectedDoctorId()&&t.selectedSpecialtyId()),l(),p("ngIf",t.isModalOpen))},dependencies:[B,V,W,j,H,R,oe,ne,ie,X,te,Z,ee,K,J],encapsulation:2})};export{de as AppointmentsCalendarComponent};
