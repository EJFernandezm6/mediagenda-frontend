import{a as ne}from"./chunk-KZXHYW2H.js";import{a as X}from"./chunk-FBFLQNJ5.js";import{a as ie}from"./chunk-VDOYPPVO.js";import{a as te,b as re}from"./chunk-FTFAWZSP.js";import{a as Z}from"./chunk-U7G55PT5.js";import{a as P}from"./chunk-XTHUABNB.js";import{b as G,d as q,g as J,l as Y,m as K,n as Q,u as U}from"./chunk-OABQPEKD.js";import{a as ee}from"./chunk-KR7YXPEX.js";import"./chunk-MZ3EZVY4.js";import{$ as F,Ab as M,Ad as A,Ba as l,Bb as h,Cb as W,Eb as S,Fb as x,Gb as v,Kd as B,Ra as V,Sd as z,Td as $,Va as T,Vb as k,W as u,aa as N,ad as j,ba as _,ca as E,cb as d,db as r,eb as n,fb as b,ia as I,mb as O,mc as R,nb as f,nc as L,ob as D,vc as H,zb as s}from"./chunk-2BMW4ZRB.js";function ae(c,t){if(c&1&&(r(0,"option",46),s(1),n()),c&2){let i=t.$implicit;d("value",i),l(),M(i)}}function se(c,t){if(c&1&&(r(0,"span",47),s(1),n()),c&2){let i=D();l(),h(" ",i.currentSchedules().length," turnos asignados ")}}function le(c,t){if(c&1&&(r(0,"tr")(1,"td",48)(2,"div",49)(3,"div",50),b(4,"lucide-icon",51),n(),r(5,"p",52),s(6,"No hay turnos programados para hoy"),n(),r(7,"p",53),s(8),n()()()()),c&2){let i=D();l(4),d("img",i.icons.Clock),l(4),h(" ",i.selectedDoctorId()?"Este especialista no tiene turnos asignados en las fechas futuras.":"Selecciona un especialista en el formulario superior para comenzar."," ")}}function de(c,t){if(c&1){let i=O();r(0,"tr",54)(1,"td",55)(2,"div",56)(3,"span",57),s(4),n(),r(5,"span",58),s(6),n()()(),r(7,"td",55)(8,"div",59),s(9),n()(),r(10,"td",60)(11,"div",61),s(12),n()(),r(13,"td",60)(14,"div",62),s(15),n()(),r(16,"td",63)(17,"button",64),f("click",function(){let a=F(i).$implicit,o=D();return N(o.remove(a))}),b(18,"lucide-icon",65),n()()()}if(c&2){let i=t.$implicit,e=D();l(4),M(e.selectedDoctorName()),l(2),h(" ",e.getSpecialtyName(i.specialtyId)," "),l(3),h(" ",e.getScheduleDisplay(i)," "),l(3),W(" ",e.formatTimeDisplay(i.startTime)," - ",e.formatTimeDisplay(i.endTime)," "),l(3),h(" ",e.calculateDuration(i)),l(3),d("img",e.icons.Trash2)}}var oe=class c{scheduleService=u(ne);doctorService=u(ee);specialtyService=u(Z);associationService=u(te);confirmService=u(P);configService=u(X);icons={Clock:j,Plus:A,Trash2:B};selectedDoctorId=I("");currentSchedules=k(()=>{let t=this.selectedDoctorId();if(!t)return[];let i=this.scheduleService.schedules(),e=new Date().toISOString().split("T")[0];return i.filter(a=>a.doctorId===t).filter(a=>a.date>=e).sort((a,o)=>a.date!==o.date?a.date.localeCompare(o.date):a.startTime.localeCompare(o.startTime))});formatTimeDisplay(t){return t?t.substring(0,5):""}formData={date:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"",specialtyId:"",weeksToRepeat:0};viewMode="list";get availableSpecialtiesForDoctor(){let t=this.selectedDoctorId();return t?this.associationService.getSpecialtiesForDoctor(t).map(e=>this.specialtyService.specialties().find(a=>a.specialtyId===e.specialtyId)).filter(e=>!!e):[]}get specialtyOptions(){return this.availableSpecialtiesForDoctor.map(t=>({id:t.specialtyId,label:t.name}))}getDayName(t){return[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Mi\xE9rcoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"S\xE1bado"},{id:0,name:"Domingo"}].find(e=>e.id===t)?.name||"Desconocido"}getSpecialtyName(t){return this.specialtyService.specialties().find(i=>i.specialtyId===t)?.name||""}selectedDoctorName=k(()=>{let t=this.selectedDoctorId();if(!t)return"";let i=this.doctorService.doctors().find(e=>e.id===t||e.doctorId===t);return i?i.fullName:"Especialista"});minDate=new Date().toISOString().split("T")[0];onDateChange(t){}getScheduleDisplay(t){if(t.date){let[i,e,a]=t.date.split("-").map(Number),o=new Date(i,e-1,a);return`${this.getDayName(o.getDay())} ${a}/${e}/${i}`}return"Fecha no v\xE1lida"}calculateDuration(t){if(!t.startTime||!t.endTime)return"-";let i=this.dateFromTime(t.startTime),a=this.dateFromTime(t.endTime).getTime()-i.getTime();if(a<=0)return"-";let o=Math.floor(a/6e4),p=Math.floor(o/60),m=o%60;return p>0&&m>0?`${p}h ${m}m`:p>0?`${p}h`:`${m}m`}validEndTimes=I([]);updateValidEndTimes(){let t=this.selectedDoctorId(),i=this.formData.specialtyId,e=this.formData.startTime;if(!t||!i||!e){this.validEndTimes.set([]);return}let o=this.associationService.associations().find(C=>C.doctorId===t&&C.specialtyId===i)?.durationMinutes||30,p=[],m=this.dateFromTime(e),w=this.configService.settings().clinicCloseTime||"20:00",y=this.dateFromTime(w);for(m.setMinutes(m.getMinutes()+o);m<=y;)p.push(this.timeFromDate(m)),m.setMinutes(m.getMinutes()+o);this.validEndTimes.set(p),p.includes(this.formData.endTime)||(this.formData.endTime=p[0])}dateFromTime(t){let[i,e]=t.split(":").map(Number),a=new Date;return a.setHours(i,e,0,0),a}timeFromDate(t){return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}onStartTimeChange(){this.updateValidEndTimes()}onSpecialtyChange(t){this.formData.specialtyId=t,this.updateValidEndTimes()}onDoctorSelectionChange(t){if(this.selectedDoctorId.set(t),t){let i=this.availableSpecialtiesForDoctor;this.formData.specialtyId=i.length>0?i[0].specialtyId:"",this.updateValidEndTimes()}else this.formData.specialtyId="",this.validEndTimes.set([])}saveSchedule(){let t=this.selectedDoctorId();if(t&&this.formData.specialtyId&&this.formData.endTime){let i=g=>g.length===5?`${g}:00`:g,e=[],[a,o,p]=this.formData.date.split("-").map(Number),m=new Date(a,o-1,p,12,0,0),w=1+this.formData.weeksToRepeat;for(let g=0;g<w;g++){let y=new Date(m);y.setDate(m.getDate()+g*7);let C=[y.getFullYear(),(y.getMonth()+1).toString().padStart(2,"0"),y.getDate().toString().padStart(2,"0")].join("-");e.push({specialtyId:this.formData.specialtyId,date:C,startTime:i(this.formData.startTime),endTime:i(this.formData.endTime)})}this.scheduleService.addSchedule(t,e).subscribe({next:()=>{this.scheduleService.refreshSchedules({doctorId:t}),this.formData.startTime="09:00",this.formData.endTime="",this.formData.weeksToRepeat=0,this.updateValidEndTimes()},error:g=>{console.error("Error saving schedule",g),alert("Error al guardar el turno. Verifique los datos.")}})}}async remove(t){await this.confirmService.confirm({title:"Eliminar Turno",message:"\xBFEst\xE1s seguro de que deseas eliminar este turno de atenci\xF3n?",confirmText:"Eliminar",cancelText:"Cancelar"})&&t.id&&this.scheduleService.removeSchedule(t.id,t.doctorId).subscribe({error:e=>console.error("Error deleting schedule",e)})}static \u0275fac=function(i){return new(i||c)};static \u0275cmp=V({type:c,selectors:[["app-schedule-config"]],decls:82,vars:23,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8","bg-gray-50","min-h-screen"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"bg-white","shadow-sm","rounded-xl","border","border-gray-200","overflow-hidden"],[1,"p-6","border-b","border-gray-200","bg-white"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"space-y-5"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-12","gap-5","items-end"],[1,"lg:col-span-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"block","w-full",3,"selectionChanged"],["placeholder","Seleccione especialidad...","displayMode","default",3,"ngModelChange","options","ngModel","disabled"],["type","date",1,"block","w-full","border","border-gray-300","rounded-lg","shadow-sm","py-2.5","px-3","focus:outline-none","focus:ring-primary","focus:border-primary","sm:text-sm","disabled:bg-gray-100","disabled:text-gray-400",3,"ngModelChange","ngModel","min","disabled"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-12","gap-5","items-end","pb-2"],[1,"lg:col-span-6","flex","items-center","gap-4"],[1,"w-full"],["type","time",1,"block","w-full","border","border-gray-300","rounded-lg","shadow-sm","py-2.5","px-3","focus:outline-none","focus:ring-primary","focus:border-primary","sm:text-sm","disabled:bg-gray-100","disabled:text-gray-400",3,"ngModelChange","ngModel","disabled"],[1,"text-gray-400","font-bold","self-end","pb-3","px-1"],[1,"w-full","relative"],[1,"block","w-full","pl-3","pr-8","py-2.5","sm:text-sm","border-gray-300","focus:outline-none","focus:ring-primary","focus:border-primary","rounded-lg","border","bg-white","shadow-sm","disabled:bg-gray-100","disabled:text-gray-400","appearance-none",3,"ngModelChange","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none","absolute","inset-y-0","right-0","top-6","flex","items-center","px-3","text-gray-400"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"lg:col-span-3"],[1,"relative"],[3,"ngValue"],[1,"pointer-events-none","absolute","inset-y-0","right-0","flex","items-center","px-3","text-gray-400"],[1,"w-full","h-[42px]","inline-flex","items-center","justify-center","px-4","border","border-transparent","text-sm","font-medium","rounded-lg","shadow-sm","text-white","bg-primary","hover:bg-primary","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","duration-200",3,"click","disabled"],[1,"w-4","h-4","mr-2",3,"img"],[1,"bg-white"],[1,"px-6","py-4","border-b","border-gray-200","bg-gray-50","flex","justify-between","items-center"],[1,"text-lg","font-medium","text-gray-900"],["class","text-sm py-1 px-3 bg-primary text-primary rounded-full font-medium",4,"ngIf"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["scope","col",1,"w-[30%]","px-6","py-3.5","text-left","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider","bg-gray-50","border-b","border-gray-200"],["scope","col",1,"w-[25%]","px-6","py-3.5","text-left","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider","bg-gray-50","border-b","border-gray-200"],["scope","col",1,"w-[20%]","px-6","py-3.5","text-center","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider","bg-gray-50","border-b","border-gray-200"],["scope","col",1,"w-[15%]","px-6","py-3.5","text-center","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider","bg-gray-50","border-b","border-gray-200"],["scope","col",1,"w-[10%]","px-6","py-3.5","text-center","text-xs","font-semibold","text-gray-500","uppercase","tracking-wider","bg-gray-50","border-b","border-gray-200"],[1,"bg-white","divide-y","divide-gray-200"],[4,"ngIf"],["class","hover:bg-primary/50 hover:shadow-sm outline-none focus-within:bg-gray-50 transition-all duration-200 group border-b border-gray-100 last:border-0 relative z-0 hover:z-10",4,"ngFor","ngForOf"],[3,"value"],[1,"text-sm","py-1","px-3","bg-primary","text-primary","rounded-full","font-medium"],["colspan","5",1,"px-6","py-12","text-center"],[1,"flex","flex-col","items-center","justify-center"],[1,"bg-gray-100","p-4","rounded-full","mb-4"],[1,"w-8","h-8","text-gray-400",3,"img"],[1,"text-gray-900","font-medium","text-lg"],[1,"text-gray-500","text-sm","mt-1","max-w-sm","mx-auto"],[1,"hover:bg-primary/50","hover:shadow-sm","outline-none","focus-within:bg-gray-50","transition-all","duration-200","group","border-b","border-gray-100","last:border-0","relative","z-0","hover:z-10"],[1,"px-6","py-5","whitespace-nowrap"],[1,"flex","flex-col"],[1,"text-sm","font-semibold","text-gray-900","group-hover:text-primary","transition-colors"],[1,"inline-flex","items-center","mt-1.5","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-primary","border","border-primary","text-primary","w-fit"],[1,"text-sm","text-gray-700","font-medium","flex","items-center"],[1,"px-6","py-5","whitespace-nowrap","text-center"],[1,"text-sm","text-gray-700","bg-gray-100","px-3.5","py-1.5","rounded-lg","inline-block","font-medium","border","border-gray-200","shadow-sm"],[1,"text-sm","text-gray-500","font-medium","bg-gray-50","inline-block","px-3","py-1","rounded-full","border","border-gray-100"],[1,"px-6","py-5","whitespace-nowrap","text-center","text-sm","font-medium"],["title","Eliminar turno",1,"text-red-400","hover:text-red-700","bg-red-50","hover:bg-red-100","p-2.5","rounded-lg","transition-all","duration-200","inline-flex","items-center","opacity-70","group-hover:opacity-100","ring-1","ring-red-100",3,"click"],[1,"w-4","h-4",3,"img"]],template:function(i,e){i&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),s(3,"Gesti\xF3n de Turnos y Horarios"),n(),r(4,"p",3),s(5,"Define los d\xEDas y horas de atenci\xF3n por especialista y especialidad."),n()(),r(6,"div",4)(7,"div",5)(8,"h2",6),s(9,"Registrar Nuevo Turno"),n(),r(10,"div",7)(11,"div",8)(12,"div",9)(13,"label",10),s(14,"Especialista"),n(),r(15,"app-doctor-selector",11),f("selectionChanged",function(o){return e.onDoctorSelectionChange(o)}),n()(),r(16,"div",9)(17,"label",10),s(18,"Especialidad"),n(),r(19,"app-searchable-select",12),v("ngModelChange",function(o){return x(e.formData.specialtyId,o)||(e.formData.specialtyId=o),o}),f("ngModelChange",function(o){return e.onSpecialtyChange(o.toString())}),n()(),r(20,"div",9)(21,"label",10),s(22,"Fecha de atenci\xF3n"),n(),r(23,"input",13),v("ngModelChange",function(o){return x(e.formData.date,o)||(e.formData.date=o),o}),f("ngModelChange",function(o){return e.onDateChange(o)}),n()()(),r(24,"div",14)(25,"div",15)(26,"div",16)(27,"label",10),s(28,"Desde"),n(),r(29,"input",17),v("ngModelChange",function(o){return x(e.formData.startTime,o)||(e.formData.startTime=o),o}),f("ngModelChange",function(){return e.onStartTimeChange()}),n()(),r(30,"span",18),s(31,"-"),n(),r(32,"div",19)(33,"label",10),s(34,"Hasta"),n(),r(35,"select",20),v("ngModelChange",function(o){return x(e.formData.endTime,o)||(e.formData.endTime=o),o}),T(36,ae,2,2,"option",21),n(),r(37,"div",22),_(),r(38,"svg",23),b(39,"path",24),n()()()(),E(),r(40,"div",25)(41,"label",10),s(42,"Repetir asignaci\xF3n:"),n(),r(43,"div",26)(44,"select",20),v("ngModelChange",function(o){return x(e.formData.weeksToRepeat,o)||(e.formData.weeksToRepeat=o),o}),r(45,"option",27),s(46,"Solo esta fecha"),n(),r(47,"option",27),s(48,"Repetir por 1 mes"),n(),r(49,"option",27),s(50,"Repetir por 2 meses"),n(),r(51,"option",27),s(52,"Repetir por 3 meses"),n()(),r(53,"div",28),_(),r(54,"svg",23),b(55,"path",24),n()()()(),E(),r(56,"div",25)(57,"button",29),f("click",function(){return e.saveSchedule()}),b(58,"lucide-icon",30),s(59," Asignar Turno "),n()()()()(),r(60,"div",31)(61,"div",32)(62,"h3",33),s(63),n(),T(64,se,2,1,"span",34),n(),r(65,"div",35)(66,"table",36)(67,"thead",37)(68,"tr")(69,"th",38),s(70," Especialista"),n(),r(71,"th",39),s(72," Fecha"),n(),r(73,"th",40),s(74," Rango Horario"),n(),r(75,"th",41),s(76," Duraci\xF3n"),n(),r(77,"th",42),s(78," Acciones"),n()()(),r(79,"tbody",43),T(80,le,9,2,"tr",44)(81,de,19,7,"tr",45),n()()()()()()),i&2&&(l(19),d("options",e.specialtyOptions),S("ngModel",e.formData.specialtyId),d("disabled",!e.selectedDoctorId()),l(4),S("ngModel",e.formData.date),d("min",e.minDate)("disabled",!e.selectedDoctorId()),l(6),S("ngModel",e.formData.startTime),d("disabled",!e.selectedDoctorId()),l(6),S("ngModel",e.formData.endTime),d("disabled",!e.selectedDoctorId()),l(),d("ngForOf",e.validEndTimes()),l(8),S("ngModel",e.formData.weeksToRepeat),d("disabled",!e.selectedDoctorId()),l(),d("ngValue",0),l(2),d("ngValue",4),l(2),d("ngValue",8),l(2),d("ngValue",12),l(6),d("disabled",!e.selectedDoctorId()||!e.formData.specialtyId||!e.formData.endTime),l(),d("img",e.icons.Plus),l(5),h(" ",e.selectedDoctorName()?"Horarios Registrados - "+e.selectedDoctorName():"Horarios Registrados"," "),l(),d("ngIf",e.selectedDoctorId()&&e.currentSchedules().length>0),l(16),d("ngIf",!e.selectedDoctorId()||e.currentSchedules().length===0),l(),d("ngForOf",e.currentSchedules()))},dependencies:[H,R,L,U,K,Q,G,Y,q,J,$,z,ie,re],encapsulation:2})};export{oe as ScheduleConfigComponent};
