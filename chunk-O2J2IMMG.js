import{a as U}from"./chunk-TTQE23E7.js";import{a as R}from"./chunk-ZCVXFZUO.js";import{b as $,c as B,d as z,f as J,g as G,h as q,j as K}from"./chunk-M3MBMLMX.js";import{a as H}from"./chunk-5H6ZWCOK.js";import{a as Q}from"./chunk-GLSC72EF.js";import{Fa as k,Fb as F,Gb as N,Ib as O,Ja as b,Pa as c,Qa as a,Ra as o,S as v,Sa as _,Va as C,Wa as g,X as u,Xa as m,Y as p,_b as W,cb as d,db as S,ea as E,eb as I,fb as V,hb as D,ib as w,jb as T,lc as A,sa as l,sb as M,sc as L,xc as j,yc as P}from"./chunk-XRB76YFL.js";function Y(s,t){if(s&1&&(a(0,"option",22),d(1),o()),s&2){let e=t.$implicit;c("value",e.id),l(),S(e.fullName)}}function Z(s,t){if(s&1&&(a(0,"span",23),d(1),o()),s&2){let e=m();l(),I(" ",e.currentSchedules().length," turnos asignados ")}}function ee(s,t){if(s&1){let e=C();a(0,"li",24)(1,"div",25)(2,"div",26),d(3),o(),a(4,"div")(5,"span",27),d(6),o(),a(7,"span",28),d(8),o()()(),a(9,"button",29),g("click",function(){let n=u(e).$implicit,r=m();return p(r.remove(n))}),_(10,"lucide-icon",30),o()()}if(s&2){let e=t.$implicit,i=m();l(3),I(" ",i.getScheduleDisplay(e)," "),l(3),V("",e.startTime," - ",e.endTime),l(2),S(i.getSpecialtyName(e.specialtyId)),l(2),c("img",i.icons.Trash2)}}function te(s,t){if(s&1&&(a(0,"li",31),_(1,"lucide-icon",32),a(2,"p"),d(3,"Selecciona un especialista para ver y configurar sus horarios de atenci\xF3n."),o()()),s&2){let e=m();l(),c("img",e.icons.Clock)}}function ie(s,t){if(s&1){let e=C();a(0,"li",31)(1,"p"),d(2,"No hay turnos asignados para este especialista."),o(),a(3,"button",33),g("click",function(){u(e);let n=m();return p(n.openAddModal())}),d(4,"Agregar el primer turno"),o()()}}function ne(s,t){if(s&1&&(a(0,"option",22),d(1),o()),s&2){let e=t.$implicit;c("value",e.id),l(),S(e.name)}}function oe(s,t){if(s&1&&(a(0,"option",22),d(1),o()),s&2){let e=t.$implicit;c("value",e),l(),S(e)}}function ae(s,t){if(s&1){let e=C();a(0,"div",34)(1,"div",35)(2,"div",36),g("click",function(){u(e);let n=m();return p(n.closeModal())}),o(),a(3,"span",37),d(4,"\u200B"),o(),a(5,"div",38)(6,"div",39)(7,"button",40),g("click",function(){u(e);let n=m();return p(n.closeModal())}),a(8,"span",41),d(9,"Cerrar"),o(),_(10,"lucide-icon",42),o()(),a(11,"div",43)(12,"div",44),_(13,"lucide-icon",45),o(),a(14,"div",46)(15,"h3",47),d(16,"Asignar Turno de Atenci\xF3n"),o(),a(17,"div",48)(18,"div")(19,"label",49),d(20,"Fecha del Turno"),o(),a(21,"input",50),T("ngModelChange",function(n){u(e);let r=m();return w(r.modalData.date,n)||(r.modalData.date=n),p(n)}),g("ngModelChange",function(n){u(e);let r=m();return p(r.onDateChange(n))}),o()(),a(22,"div")(23,"label",49),d(24,"Especialidad"),o(),a(25,"select",51),g("ngModelChange",function(n){u(e);let r=m();return p(r.onSpecialtyChange(n))}),b(26,ne,2,2,"option",10),o()(),a(27,"div",52)(28,"div")(29,"label",49),d(30,"Hora Inicio"),o(),a(31,"input",53),T("ngModelChange",function(n){u(e);let r=m();return w(r.modalData.startTime,n)||(r.modalData.startTime=n),p(n)}),g("ngModelChange",function(){u(e);let n=m();return p(n.onStartTimeChange())}),o()(),a(32,"div")(33,"label",49),d(34,"Hora Fin"),o(),a(35,"select",54),T("ngModelChange",function(n){u(e);let r=m();return w(r.modalData.endTime,n)||(r.modalData.endTime=n),p(n)}),b(36,oe,2,2,"option",10),o(),a(37,"p",55),d(38,"Seg\xFAn duraci\xF3n de cita"),o()()()()()(),a(39,"div",56)(40,"button",57),g("click",function(){u(e);let n=m();return p(n.saveSchedule())}),d(41," Guardar Turno "),o(),a(42,"button",58),g("click",function(){u(e);let n=m();return p(n.closeModal())}),d(43," Cancelar "),o()()()()()}if(s&2){let e=m();l(10),c("img",e.icons.Plus),l(3),c("img",e.icons.Clock),l(8),D("ngModel",e.modalData.date),l(4),c("ngModel",e.modalData.specialtyId),l(),c("ngForOf",e.availableSpecialtiesForDoctor),l(5),D("ngModel",e.modalData.startTime),l(4),D("ngModel",e.modalData.endTime),l(),c("ngForOf",e.validEndTimes())}}var X=class s{scheduleService=v(U);doctorService=v(Q);specialtyService=v(H);associationService=v(R);icons={Clock:W,Plus:A,Trash2:L};doctors=M(()=>{let t=this.doctorService.doctors(),e=this.associationService.associations();return t.filter(i=>e.some(n=>n.doctorId===i.id))});selectedDoctorId=E("");currentSchedules=M(()=>{let t=this.selectedDoctorId();return t?this.scheduleService.schedules().filter(i=>i.doctorId===t):[]});weekDays=M(()=>{let t=new Date,e=t.getDay(),i=t.getDate()-e+(e===0?-6:1),n=new Date(t.setDate(i)),r=[],h=["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"];for(let x=1;x<=6;x++){let y=new Date(n);y.setDate(n.getDate()+(x-1)),r.push({id:x,name:h[x],dateLabel:y.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})})}let f=new Date(n);return f.setDate(n.getDate()+6),r.push({id:0,name:h[0],dateLabel:f.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}),r});isModalOpen=!1;modalData={dayOfWeek:1,date:"",startTime:"09:00",endTime:"",specialtyId:""};viewMode="list";get availableSpecialtiesForDoctor(){let t=this.selectedDoctorId();return t?this.associationService.getSpecialtiesForDoctor(t).map(i=>this.specialtyService.specialties().find(n=>n.id===i.specialtyId)).filter(i=>!!i):[]}getDayName(t){return[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Mi\xE9rcoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"S\xE1bado"},{id:0,name:"Domingo"}].find(i=>i.id===t)?.name||"Desconocido"}getSpecialtyName(t){return this.specialtyService.specialties().find(e=>e.id===t)?.name||""}onDateChange(t){if(t){let e=new Date(t),[i,n,r]=t.split("-").map(Number),h=new Date(i,n-1,r);this.modalData.dayOfWeek=h.getDay()}}getScheduleDisplay(t){if(t.date){let[e,i,n]=t.date.split("-").map(Number),r=new Date(e,i-1,n);return`${this.getDayName(r.getDay())} ${n}/${i}/${e}`}return`Todos los ${this.getDayName(t.dayOfWeek)}s`}validEndTimes=E([]);updateValidEndTimes(){let t=this.selectedDoctorId(),e=this.modalData.specialtyId,i=this.modalData.startTime;if(!t||!e||!i){this.validEndTimes.set([]);return}let r=this.associationService.associations().find(y=>y.doctorId===t&&y.specialtyId===e)?.durationMinutes||30,h=[],f=this.dateFromTime(i),x=new Date(f);x.setHours(23,59,0,0),f.setMinutes(f.getMinutes()+r);for(let y=0;y<16&&!(f>x);y++)h.push(this.timeFromDate(f)),f.setMinutes(f.getMinutes()+r);this.validEndTimes.set(h),h.includes(this.modalData.endTime)||(this.modalData.endTime=h[0])}dateFromTime(t){let[e,i]=t.split(":").map(Number),n=new Date;return n.setHours(e,i,0,0),n}timeFromDate(t){return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}onStartTimeChange(){this.updateValidEndTimes()}onSpecialtyChange(t){this.modalData.specialtyId=t,this.updateValidEndTimes()}openAddModal(){if(!this.selectedDoctorId())return;let t=this.availableSpecialtiesForDoctor[0]?.id||"",e=new Date().toISOString().split("T")[0];this.modalData={dayOfWeek:new Date().getDay(),date:e,startTime:"09:00",endTime:"",specialtyId:t},this.updateValidEndTimes(),this.isModalOpen=!0}saveSchedule(){let t=this.selectedDoctorId();t&&this.modalData.specialtyId&&this.modalData.endTime&&(this.scheduleService.addSchedule({doctorId:t,specialtyId:this.modalData.specialtyId,dayOfWeek:this.modalData.dayOfWeek,date:this.modalData.date,startTime:this.modalData.startTime,endTime:this.modalData.endTime}),this.closeModal())}closeModal(){this.isModalOpen=!1}remove(t){this.scheduleService.removeSchedule(t)}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=k({type:s,selectors:[["app-schedule-config"]],decls:29,vars:9,consts:[[1,"px-4","py-6","sm:px-6","lg:px-8"],[1,"mb-8"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-700"],[1,"flex","flex-col","gap-8","h-[calc(100vh-140px)]"],[1,"bg-white","shadow","rounded-lg","p-6","border","border-gray-100","flex","items-center","gap-6"],[1,"flex-1"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"block","w-full","rounded-md","border-gray-300","py-2","pl-3","pr-10","text-base","focus:border-blue-500","focus:outline-none","focus:ring-blue-500","sm:text-sm","border",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"flex-none","pt-6"],[1,"inline-flex","items-center","px-4","py-2","border","border-transparent","text-sm","font-medium","rounded-md","shadow-sm","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-4","h-4","mr-2",3,"img"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","border","border-gray-100","flex-1","overflow-y-auto"],[1,"px-6","py-4","border-b","border-gray-200","bg-gray-50","flex","justify-between","items-center"],[1,"text-lg","font-medium","leading-6","text-gray-900"],["class","text-sm text-gray-500",4,"ngIf"],["role","list",1,"divide-y","divide-gray-200"],["class","px-6 py-4 hover:bg-gray-50 flex justify-between items-center transition-colors",4,"ngFor","ngForOf"],["class","px-6 py-12 text-center text-gray-400",4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto","aria-labelledby","modal-title","role","dialog","aria-modal","true",4,"ngIf"],[3,"value"],[1,"text-sm","text-gray-500"],[1,"px-6","py-4","hover:bg-gray-50","flex","justify-between","items-center","transition-colors"],[1,"flex","items-center","gap-4"],[1,"bg-blue-100","p-2","rounded-lg","text-blue-600","font-bold","w-32","text-center","text-sm"],[1,"text-gray-900","font-medium","text-lg","block"],[1,"block","text-sm","text-gray-500"],["title","Eliminar turno",1,"text-gray-400","hover:text-red-600","p-2","rounded-full","hover:bg-red-50","transition-all",3,"click"],[1,"w-5","h-5",3,"img"],[1,"px-6","py-12","text-center","text-gray-400"],[1,"w-12","h-12","mx-auto","mb-3","opacity-20",3,"img"],[1,"mt-2","text-blue-600","hover:underline","font-medium",3,"click"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","items-end","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity",3,"click"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"relative","inline-block","align-bottom","bg-white","rounded-lg","px-4","pt-5","pb-4","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full","sm:p-6"],[1,"absolute","top-0","right-0","pt-4","pr-4"],["type","button",1,"bg-white","rounded-md","text-gray-400","hover:text-gray-500","focus:outline-none",3,"click"],[1,"sr-only"],[1,"w-6","h-6","rotate-45",3,"img"],[1,"sm:flex","sm:items-start"],[1,"mx-auto","flex-shrink-0","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-blue-100","sm:mx-0","sm:h-10","sm:w-10"],[1,"h-6","w-6","text-blue-600",3,"img"],[1,"mt-3","text-center","sm:mt-0","sm:ml-4","sm:text-left","w-full"],["id","modal-title",1,"text-lg","leading-6","font-medium","text-gray-900"],[1,"mt-4","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700"],["type","date",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-4"],["type","time",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"mt-1","block","w-full","pl-3","pr-10","py-2","text-base","border-gray-300","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","sm:text-sm","rounded-md","border","bg-white",3,"ngModelChange","ngModel"],[1,"mt-1","text-xs","text-gray-500"],[1,"mt-5","sm:mt-4","sm:flex","sm:flex-row-reverse"],["type","button",1,"w-full","inline-flex","justify-center","rounded-md","border","border-transparent","shadow-sm","px-4","py-2","bg-blue-600","text-base","font-medium","text-white","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:ml-3","sm:w-auto","sm:text-sm",3,"click"],["type","button",1,"mt-3","w-full","inline-flex","justify-center","rounded-md","border","border-gray-300","shadow-sm","px-4","py-2","bg-white","text-base","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:mt-0","sm:w-auto","sm:text-sm",3,"click"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"Turnos de Atenci\xF3n"),o(),a(4,"p",3),d(5,"Define los d\xEDas y horas de atenci\xF3n por especialista y especialidad."),o()(),a(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),d(10,"Seleccionar Especialista"),o(),a(11,"select",8),g("ngModelChange",function(r){return i.selectedDoctorId.set(r)}),a(12,"option",9),d(13,"Seleccionar especialista"),o(),b(14,Y,2,2,"option",10),o()(),a(15,"div",11)(16,"button",12),g("click",function(){return i.openAddModal()}),_(17,"lucide-icon",13),d(18," Agregar Turno "),o()()(),a(19,"div",14)(20,"div",15)(21,"h3",16),d(22,"Horarios Configurados"),o(),b(23,Z,2,1,"span",17),o(),a(24,"ul",18),b(25,ee,11,5,"li",19)(26,te,4,1,"li",20)(27,ie,5,0,"li",20),o()()(),b(28,ae,44,8,"div",21),o()),e&2&&(l(11),c("ngModel",i.selectedDoctorId()),l(3),c("ngForOf",i.doctors()),l(2),c("disabled",!i.selectedDoctorId()),l(),c("img",i.icons.Plus),l(6),c("ngIf",i.selectedDoctorId()),l(2),c("ngForOf",i.currentSchedules()),l(),c("ngIf",!i.selectedDoctorId()),l(),c("ngIf",i.selectedDoctorId()&&i.currentSchedules().length===0),l(),c("ngIf",i.isModalOpen))},dependencies:[O,F,N,K,G,q,$,J,B,z,P,j],encapsulation:2})};export{X as ScheduleConfigComponent};
